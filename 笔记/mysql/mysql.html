<!doctype html><html lang="zh-CN" dir="ltr"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>M946i</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.1.4">
    <link rel="preload stylesheet" href="/assets/style.Gf09Od1L.css" as="style">
    
    <script type="module" src="/assets/app.BSDhOcNX.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.Bnrxiqtl.js">
    <link rel="modulepreload" href="/assets/chunks/framework.DshHJP7F.js">
    <link rel="modulepreload" href="/assets/笔记_mysql_mysql.md.MiKbH4rO.lean.js">
    <meta name="theme-color" content="#ffffff">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" href="/logo.svg" type="image/svg+xml">
    <link rel="alternate icon" href="/favicon.ico" type="image/png" sizes="16x16">
    <meta name="author" content="">
    <meta name="keywords" content="markdown, knowledge-base, 知识库, vitepress, obsidian, notebook, notes">
    <meta property="og:title" content="M946i">
    <meta property="og:image" content="https://M946i.github.io/og.png">
    <meta property="og:description" content="A VitePress site">
    <meta property="og:site_name" content="M946i">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:creator" content="">
    <meta name="twitter:image" content="https://M946i.github.io/og.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#927baf">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="msapplication-TileColor" content="#603cba">
    <script defer data-domain="nolebase.ayaka.io" data-api="/api/v1/page-external-data/submit" src="/assets/page-external-data/js/script.js"></script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  
<meta property="og:type" content="website">
<meta property="og:image" content="https://M946i.github.io/%E7%AC%94%E8%AE%B0%5Cmysql%5Cog-mysql.png">
<meta name="twitter:image" content="https://M946i.github.io/%E7%AC%94%E8%AE%B0%5Cmysql%5Cog-mysql.png">
</head>
  <body>
    <div id="app"><div class="Layout" data-v-387679bd=""><!--[--><!--]--><!--[--><span tabindex="-1" data-v-caba6d17=""></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-caba6d17=""> Skip to content </a><!--]--><!----><header class="VPNav" data-v-387679bd="" data-v-8a61a508=""><div class="VPNavBar has-sidebar top" data-v-8a61a508="" data-v-11bca7f1=""><div class="wrapper" data-v-11bca7f1=""><div class="container" data-v-11bca7f1=""><div class="title" data-v-11bca7f1=""><div class="VPNavBarTitle has-sidebar" data-v-11bca7f1="" data-v-ae40f8e7=""><a class="title" href="/" data-v-ae40f8e7=""><!--[--><!--]--><!----><span data-v-ae40f8e7="">M946i</span><!--[--><!--]--></a></div></div><div class="content" data-v-11bca7f1=""><div class="content-body" data-v-11bca7f1=""><!--[--><!--]--><div class="VPNavBarSearch search" data-v-11bca7f1=""><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-11bca7f1="" data-v-caf2bb3b=""><span id="main-nav-aria-label" class="visually-hidden" data-v-caf2bb3b="">Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-caf2bb3b="" data-v-32cf7004=""><!--[--><span data-v-32cf7004="">主页</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/笔记/" tabindex="0" data-v-caf2bb3b="" data-v-32cf7004=""><!--[--><span data-v-32cf7004="">笔记</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/toc.html" tabindex="0" data-v-caf2bb3b="" data-v-32cf7004=""><!--[--><span data-v-32cf7004="">最近更新</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-11bca7f1="" data-v-f4d4b3cc=""><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-f4d4b3cc="" data-v-3100b362="" data-v-5ccea8ad=""><span class="check" data-v-5ccea8ad=""><span class="icon" data-v-5ccea8ad=""><!--[--><span class="vpi-sun sun" data-v-3100b362=""></span><span class="vpi-moon moon" data-v-3100b362=""></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-11bca7f1="" data-v-37a05552="" data-v-1ab87178=""><!--[--><a class="VPSocialLink no-icon" href="https://github.com/M946i" aria-label="github" target="_blank" rel="noopener" data-v-1ab87178="" data-v-743f0048=""><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://discord.com/invite/fSHxNEgh" aria-label="discord" target="_blank" rel="noopener" data-v-1ab87178="" data-v-743f0048=""><span class="vpi-social-discord"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-11bca7f1="" data-v-bb92af35="" data-v-0d506e26=""><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-0d506e26=""><span class="vpi-more-horizontal icon" data-v-0d506e26=""></span></button><div class="menu" data-v-0d506e26=""><div class="VPMenu" data-v-0d506e26="" data-v-f79a0ba0=""><!----><!--[--><!--[--><!----><div class="group" data-v-bb92af35=""><div class="item appearance" data-v-bb92af35=""><p class="label" data-v-bb92af35="">切换主题</p><div class="appearance-action" data-v-bb92af35=""><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-bb92af35="" data-v-3100b362="" data-v-5ccea8ad=""><span class="check" data-v-5ccea8ad=""><span class="icon" data-v-5ccea8ad=""><!--[--><span class="vpi-sun sun" data-v-3100b362=""></span><span class="vpi-moon moon" data-v-3100b362=""></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb92af35=""><div class="item social-links" data-v-bb92af35=""><div class="VPSocialLinks social-links-list" data-v-bb92af35="" data-v-1ab87178=""><!--[--><a class="VPSocialLink no-icon" href="https://github.com/M946i" aria-label="github" target="_blank" rel="noopener" data-v-1ab87178="" data-v-743f0048=""><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://discord.com/invite/fSHxNEgh" aria-label="discord" target="_blank" rel="noopener" data-v-1ab87178="" data-v-743f0048=""><span class="vpi-social-discord"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--[--><!--[--><div class="VPFlyout VPNolebaseEnhancedReadabilitiesMenu VPNolebaseEnhancedReadabilitiesMenuFlyout" aria-label="阅读增强" role="menuitem" data-v-0d506e26=""><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-0d506e26=""><span class="text" data-v-0d506e26=""><span class="i-icon-park-outline:book-open option-icon" data-v-0d506e26=""></span><!----><span class="vpi-chevron-down text-icon" data-v-0d506e26=""></span></span></button><div class="menu" data-v-0d506e26=""><div class="VPMenu" data-v-0d506e26="" data-v-f79a0ba0=""><!----><!--[--><!--]--></div></div></div><!--[--><button h-full="" ws-nowrap="" px3="" text-sm="" font-medium="" text="$vp-c-text-1" class="!cursor-wait" disabled><span flex="" items-center="" space-x-1=""><span class="i-octicon:share-16"></span><span>分享此页</span></span></button><div class="bg-$vp-c-divider-light" mx2="" block="" h-24px="" w-1px="" md:hidden=""></div><!--]--><!--]--><!--]--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-11bca7f1="" data-v-aed20ed9=""><span class="container" data-v-aed20ed9=""><span class="top" data-v-aed20ed9=""></span><span class="middle" data-v-aed20ed9=""></span><span class="bottom" data-v-aed20ed9=""></span></span></button></div></div></div></div><div class="divider" data-v-11bca7f1=""><div class="divider-line" data-v-11bca7f1=""></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-387679bd="" data-v-559f8140=""><div class="container" data-v-559f8140=""><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-559f8140=""><span class="vpi-align-left menu-icon" data-v-559f8140=""></span><span class="menu-text" data-v-559f8140="">Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-559f8140="" data-v-1a64c097=""><button data-v-1a64c097="">Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-387679bd="" data-v-a8d5b892=""><div class="curtain" data-v-a8d5b892=""></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-a8d5b892=""><span class="visually-hidden" id="sidebar-aria-label" data-v-a8d5b892=""> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-a8d5b892=""><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a8d5b892="" data-v-f4a4c1b1=""><div class="item" role="button" tabindex="0" data-v-f4a4c1b1=""><div class="indicator" data-v-f4a4c1b1=""></div><h2 class="text" data-v-f4a4c1b1="">JUC</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-f4a4c1b1=""><span class="vpi-chevron-right caret-icon" data-v-f4a4c1b1=""></span></div></div><div class="items" data-v-f4a4c1b1=""><!--[--><div class="VPSidebarItem level-1 is-link" data-v-f4a4c1b1=""><div class="item" data-v-f4a4c1b1=""><div class="indicator" data-v-f4a4c1b1=""></div><a class="VPLink link link" href="/%E7%AC%94%E8%AE%B0/JUC/JUC.html" data-v-f4a4c1b1=""><!--[--><p class="text" data-v-f4a4c1b1="">JUC</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-a8d5b892=""><section class="VPSidebarItem level-0 collapsible has-active" data-v-a8d5b892="" data-v-f4a4c1b1=""><div class="item" role="button" tabindex="0" data-v-f4a4c1b1=""><div class="indicator" data-v-f4a4c1b1=""></div><h2 class="text" data-v-f4a4c1b1="">mysql</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-f4a4c1b1=""><span class="vpi-chevron-right caret-icon" data-v-f4a4c1b1=""></span></div></div><div class="items" data-v-f4a4c1b1=""><!--[--><div class="VPSidebarItem level-1 is-link" data-v-f4a4c1b1=""><div class="item" data-v-f4a4c1b1=""><div class="indicator" data-v-f4a4c1b1=""></div><a class="VPLink link link" href="/%E7%AC%94%E8%AE%B0/mysql/mysql.html" data-v-f4a4c1b1=""><!--[--><p class="text" data-v-f4a4c1b1="">mysql</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-387679bd="" data-v-aea003d8=""><div class="VPDoc has-sidebar has-aside" data-v-aea003d8="" data-v-4e5e6fe5=""><!--[--><!--[--><!--[--><!--[--><!--]--><!--]--><!--]--><!--]--><div class="container" data-v-4e5e6fe5=""><div class="aside" data-v-4e5e6fe5=""><div class="aside-curtain" data-v-4e5e6fe5=""></div><div class="aside-container" data-v-4e5e6fe5=""><div class="aside-content" data-v-4e5e6fe5=""><div class="VPDocAside" data-v-4e5e6fe5="" data-v-09261324=""><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" role="navigation" data-v-09261324="" data-v-b51366c6=""><div class="content" data-v-b51366c6=""><div class="outline-marker" data-v-b51366c6=""></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-b51366c6="">页面大纲</div><ul class="VPDocOutlineItem root" data-v-b51366c6="" data-v-15096a49=""><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-09261324=""></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-4e5e6fe5=""><div class="content-container" data-v-4e5e6fe5=""><!--[--><!--]--><main class="main" data-v-4e5e6fe5=""><div style="position:relative;" class="vp-doc _%E7%AC%94%E8%AE%B0_mysql_mysql" data-v-4e5e6fe5=""><div><h1 id="" tabindex="-1"><img src="/assets/%E4%B8%8B%E8%BD%BD.2YCtXSbG.png" alt="背景"> <a class="header-anchor" href="#" aria-label="Permalink to &#x22;![背景](./下载.png)&#x22;">​</a></h1><div my-4=""><div class="grid grid-cols-[180px_auto] gap-1 <sm:grid-cols-[120px_auto]"><!--[--><!--[--><div transition="all ease-in-out" flex="" items-start="" text="zinc-400 dark:zinc-500 sm <sm:xs" duration-250=""><div transition="all ease-in-out" min-h="8 <sm:7" px="2 <sm:1" py="2 <sm:1" w-full="" flex="" cursor-pointer="" items-center="" bg="hover:zinc-100 dark:hover:zinc-800" rounded-md="" duration-250=""><div i-icon-park-outline:add-text="" mr-1=""></div><span overflow-hidden="" text-ellipsis="" whitespace-nowrap="">字数</span></div></div><div cursor-pointer="" transition="all ease-in-out" min-h="8 <sm:7" px="2 <sm:1" py="1.5 <sm:1" flex="~ row wrap" items-center="" gap-1="" rounded-md="" text="sm <sm:xs" bg="hover:zinc-100 dark:hover:zinc-800" duration-250=""><div class="vp-nolebase-page-property" data-page-property="value" data-page-property-type="dynamic" data-page-property-dynamic-type="word-count" w-full="" inline-flex="" items-center=""><span>16671 字</span></div></div><!--]--><!--[--><div transition="all ease-in-out" flex="" items-start="" text="zinc-400 dark:zinc-500 sm <sm:xs" duration-250=""><div transition="all ease-in-out" min-h="8 <sm:7" px="2 <sm:1" py="2 <sm:1" w-full="" flex="" cursor-pointer="" items-center="" bg="hover:zinc-100 dark:hover:zinc-800" rounded-md="" duration-250=""><div i-icon-park-outline:timer="" mr-1=""></div><span overflow-hidden="" text-ellipsis="" whitespace-nowrap="">阅读时间</span></div></div><div cursor-pointer="" transition="all ease-in-out" min-h="8 <sm:7" px="2 <sm:1" py="1.5 <sm:1" flex="~ row wrap" items-center="" gap-1="" rounded-md="" text="sm <sm:xs" bg="hover:zinc-100 dark:hover:zinc-800" duration-250=""><div class="vp-nolebase-page-property" data-page-property="value" data-page-property-type="dynamic" data-page-property-dynamic-type="reading-time" w-full="" inline-flex="" items-center=""><span>67 分钟</span></div></div><!--]--><!--]--></div></div><h1 id="连接数据库" tabindex="-1">连接数据库 <a class="header-anchor" href="#连接数据库" aria-label="Permalink to &#x22;连接数据库&#x22;">​</a></h1><pre><code>mysql -h ip -P port -u user -p

password
</code></pre><h2 id="ddl" tabindex="-1">DDL <a class="header-anchor" href="#ddl" aria-label="Permalink to &#x22;DDL&#x22;">​</a></h2><pre><code>show databases; -- 显示所有数据库

select database(); -- 查询当前数据库

create database [if not exists] 数据库名 [default charset 字符集] [collate 排序规则]; -- 创建数据库

drop database [if exist]; -- 删除数据库

use 数据库名; -- 使用数据库

show tables; -- 查询当前数据库所有表

desc 表名; -- 查询表结构

show create table 表名; -- 查询指定表建表语句

create table 表名(

    column_name column_type

    -- id int unsigned not null comment '编号'

);
-- 创建表

alter table 表名 add 字段名 类型(长度) [comment 注释] [约束]; -- 添加字段

alter table 表名 modify 字段名 新数据类型(长度); -- 修改字段数据类型

alter table change 旧字段名 新字段名 类型(长度) [comment 注释] [约束]; -- 修改字段名及字段数据类型

alter table drop 字段名; -- 删除字段

alter table 表名 rename to 新表名; -- 修改表名

drop table [if exist] 表名; -- 删除表

truncate table 表名; -- 删除并重建表
</code></pre><h2 id="dml" tabindex="-1">DML <a class="header-anchor" href="#dml" aria-label="Permalink to &#x22;DML&#x22;">​</a></h2><pre><code>insert into 表名(字段1,字段2,....) values(值1,值2,...); -- 指定字段添加数据

insert into 表名 values(值1,值2,...); -- 给全部字段添加数据

insert into 表名(字段1,字段2,....) values(值1,值2,...),(值1,值2,...),...(值1,值2,...),(值1,值2,...); -- 批量添加指定字段数据

insert into 表名 values(值1,值2,...),(值1,值2,...),...(值1,值2,...),(值1,值2,...); -- 批量添加全部字段数据

update 表名 set 字段1=值1,字段2=值2,...[where 条件]; -- 更新字段数据类型

delete from 表名 [where 条件]; -- 删除数据
</code></pre><h2 id="dql" tabindex="-1">DQL <a class="header-anchor" href="#dql" aria-label="Permalink to &#x22;DQL&#x22;">​</a></h2><pre><code>select distinct 字段 from 表名 where 条件列表 group by 分组字段列表 having 分组后条件列表 order by 排序字段列表 desc/asc  limit 分页参数;//条件查询

select 字段1,字段2,字段3...from 表名; -- 查询多个字段

select * from 表名;//

select 字段1 [as 别名1],字段2 [别名2],... from 表名; -- 设置别名

select  distinct 字段列表 from 表名; -- 查询 去重

select 字段列表 from 表名 where 条件列表; -- 条件 ( >  >=  &#x3C;  &#x3C;=  =  (&#x3C;>  !=)  between...(小)and...(大)  in(...)(多选一)    like    is null  (and &#x26;&#x26;) (or ||)  (not !) )
</code></pre><p>聚合函数</p><pre><code>count sum min max avg

select count/sum/min/max/avg(字段名) from 表名 ...
</code></pre><p>执行顺序</p><pre><code>from-where-group by-having-select-order by-limit
</code></pre><h2 id="dcl" tabindex="-1">DCL <a class="header-anchor" href="#dcl" aria-label="Permalink to &#x22;DCL&#x22;">​</a></h2><pre><code>use mysql; -- 使用mysql数据库

select * from user; -- 查询用户

create user '用户名'@'主机名' identified by '密码'; -- 创建用户

alter user '用户名'@'主机名' identified with mysql_native_password by '新密码'; -- 更改用户密码

drop user '用户名'@'主机名'; -- 删除用户


show grants for '用户名'@'主机名'; -- 查询权限

grant 权限名 on 数据库.表名 to '用户名'@'主机名'; -- 授权

revoke 权限名 on 数据库.表名 from '用户名'@'主机名'; -- 撤销权限

concat(S1,S2,...Sn)  -- 字符串拼接，将s1，s2，...sn拼接成一个字符

lower(str)  -- 小写

upper(str)  -- 大写

lpad(str,n,pad)  -- 左填充pad

rpad(str,n,pad)  -- 右填充pad

trim(str)  -- 去除头部尾部空格

substring(str,start,len)  -- start->start+len字符串截取

ceil(x) -- 向上取整

floor(x)  -- 向下取整

mod(x,y)  -- x/y的余数

rand() -- 返回(0,1)之间的随机数

round(x,y)  -- 求x四舍五入的值，保留y位小数


curdate() -- 返回当前日期

curtime() -- 返回当前时间

now() -- 返回当前时间日期

year(date)  -- 获取日期中的年

month(date)  -- 获取日期中的月

day(date)   -- 获取日期中的日

date_add(date,interval expr type)

datediff(date1,date2) //返回date1到date2的天数

if(value,t,f)  //value为true 返回 t 否则返回 f

ifnull(value1,value2) //value1为不为空 返回value1 否则 返回value2

case when [var1] then [res1]...else [default] end  -- var1为true 返回res1 否则 返回default默认值(固定值)

select case when id = 1 then 1 else 2 end;

case [expr] when [var1] then [res1] ... else [default] end -- 非固定

select case id when 1 then 1 else 2 end;
</code></pre><h2 id="约束" tabindex="-1">约束 <a class="header-anchor" href="#约束" aria-label="Permalink to &#x22;约束&#x22;">​</a></h2><pre><code>非空约束 not null

唯一约束 unique

主键约束 primary key

默认约束 default [默认为1]

检查约束 check

外键约束 foreign key
</code></pre><h2 id="多表关系" tabindex="-1">多表关系 <a class="header-anchor" href="#多表关系" aria-label="Permalink to &#x22;多表关系&#x22;">​</a></h2><pre><code>一对多：在多的一方设置外键，关联一的一方的主键

多对多：建立中间表，中间表包含两个外键，关联两张表的主键

一对一：用于表结构拆分，在其中任何一方设置外键（UNIQUE），关联另一方的主键
</code></pre><h2 id="多表查询" tabindex="-1">多表查询 <a class="header-anchor" href="#多表查询" aria-label="Permalink to &#x22;多表查询&#x22;">​</a></h2><h2 id="内连接-交集部分" tabindex="-1">内连接 [交集部分] <a class="header-anchor" href="#内连接-交集部分" aria-label="Permalink to &#x22;内连接 [交集部分]&#x22;">​</a></h2><p>隐式内连接</p><pre><code>select 字段列表 from 表1,表2 where 条件...;
</code></pre><p>显示内连接</p><pre><code>select 字段列表 from 表1 [inner] join 表2 on 条件列表...;
-- [inner]可省略
</code></pre><h2 id="外连接" tabindex="-1">外连接 <a class="header-anchor" href="#外连接" aria-label="Permalink to &#x22;外连接&#x22;">​</a></h2><p>左外连接</p><pre><code>select 字段名称 from 表1 left [outer] join 表2 on 条件...;
-- [outer] 可省略
</code></pre><p>右外连接</p><pre><code>select 字段名称 from 表1 right [outer] join 表2 on 条件...;
-- [outer] 可省略
</code></pre><h2 id="自连接" tabindex="-1">自连接 <a class="header-anchor" href="#自连接" aria-label="Permalink to &#x22;自连接&#x22;">​</a></h2><pre><code>select 字段名称 from 表A 别名A join 表A 别名B on 条件...;
-- 自连接查询，可以是内连接查询，也可以是外连接查询。
</code></pre><h2 id="联合查询" tabindex="-1">联合查询 <a class="header-anchor" href="#联合查询" aria-label="Permalink to &#x22;联合查询&#x22;">​</a></h2><pre><code>select 字段名称 from 表A ...

    union [ALL]

select 字段名称 from 表B ...;
-- 上下合并 查询字段的数量和类型必须相同 union ALL直接合并 union 去重
</code></pre><h2 id="子查询-嵌套查询" tabindex="-1">子查询 [嵌套查询] <a class="header-anchor" href="#子查询-嵌套查询" aria-label="Permalink to &#x22;子查询 [嵌套查询]&#x22;">​</a></h2><pre><code>select * from 表1 where column1 = (select column1 from 表2);
-- 子查询外部语句可以是insert/update/delete/select的任何一个。
</code></pre><h3 id="根据子查询结果不同-分为" tabindex="-1">根据子查询结果不同，分为: <a class="header-anchor" href="#根据子查询结果不同-分为" aria-label="Permalink to &#x22;根据子查询结果不同，分为:&#x22;">​</a></h3><pre><code>标量子查询（子查询结果为单个值）

列子查询（子查询结果为一列）

行子查询（子查询结果为一行）

表子查询（子查询结果为多行多列）
</code></pre><h3 id="标量子查询" tabindex="-1">标量子查询 <a class="header-anchor" href="#标量子查询" aria-label="Permalink to &#x22;标量子查询&#x22;">​</a></h3><pre><code>=、&#x3C;>、>、>=、&#x3C;、&#x3C;=
</code></pre><h3 id="列子查询" tabindex="-1">列子查询 <a class="header-anchor" href="#列子查询" aria-label="Permalink to &#x22;列子查询&#x22;">​</a></h3><pre><code>IN -- 在指定的集合范围内，多选一

NOT IN -- 不在指定的集合范围之内

ANY -- 子查询返回列表中，有任意一个满足即可

SOME -- 与ANY等同，使用SOME的地方可以使用ANY

ALL -- 子查询返回列表的所有值都必须满足
</code></pre><h3 id="行子查询" tabindex="-1">行子查询 <a class="header-anchor" href="#行子查询" aria-label="Permalink to &#x22;行子查询&#x22;">​</a></h3><pre><code>=、&#x3C;>、IN、NOT IN
</code></pre><h3 id="表子查询" tabindex="-1">表子查询 <a class="header-anchor" href="#表子查询" aria-label="Permalink to &#x22;表子查询&#x22;">​</a></h3><pre><code>IN
</code></pre><h2 id="事务" tabindex="-1">事务 <a class="header-anchor" href="#事务" aria-label="Permalink to &#x22;事务&#x22;">​</a></h2><h3 id="-1" tabindex="-1"><a class="header-anchor" href="#-1" aria-label="Permalink to &#x22;&#x22;">​</a></h3><h4 id="事务-是一组操作的集合-它是一个不可分割的工作单位-事务会吧所有的操作作为一个整体一起想系统提交或撤销操作请求-即这些操作要么同时成功-要么同时失败。" tabindex="-1">事务 是一组操作的集合，它是一个不可分割的工作单位，事务会吧所有的操作作为一个整体一起想系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败。 <a class="header-anchor" href="#事务-是一组操作的集合-它是一个不可分割的工作单位-事务会吧所有的操作作为一个整体一起想系统提交或撤销操作请求-即这些操作要么同时成功-要么同时失败。" aria-label="Permalink to &#x22;事务 是一组操作的集合，它是一个不可分割的工作单位，事务会吧所有的操作作为一个整体一起想系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败。&#x22;">​</a></h4><h3 id="-2" tabindex="-1"><a class="header-anchor" href="#-2" aria-label="Permalink to &#x22;&#x22;">​</a></h3><h3 id="事务操作" tabindex="-1">事务操作 <a class="header-anchor" href="#事务操作" aria-label="Permalink to &#x22;事务操作&#x22;">​</a></h3><pre><code>select @@autocommit;

set @@autocommit = 0;

-- 查看/设置事务提交方式

commit;

-- 提交事务

rollback;

-- 回滚事务
</code></pre><h3 id="事务四大特性" tabindex="-1">事务四大特性 <a class="header-anchor" href="#事务四大特性" aria-label="Permalink to &#x22;事务四大特性&#x22;">​</a></h3><pre><code>原子性:事务是不可分割的最小操作单元，要么全部成功，要么全部失败。
一致性:事务完成时，必须使所有的数据都保持一致的状态。
隔离性:数据库系统提供隔离机制，保证事务在不受外部并发操作影响的独立环境下运行。
持久性:事务一旦提交或回滚，它对数据库中的数据的改变就是永久的。
</code></pre><h3 id="并发事务问题" tabindex="-1">并发事务问题 <a class="header-anchor" href="#并发事务问题" aria-label="Permalink to &#x22;并发事务问题&#x22;">​</a></h3><pre><code>脏读:一个事务读到另一个事务还没有提交的数据。
不可重复读:一个事务先后读取同一条记录，但两次读取的数据不同，称之为不可重复读。
幻读:一个事务按照条件查询数据时，没有对应的数据行，但是在插入数据时，又发现这行数据已经存在，好像出现了”幻影“。
</code></pre><h3 id="事务隔离级别" tabindex="-1">事务隔离级别 <a class="header-anchor" href="#事务隔离级别" aria-label="Permalink to &#x22;事务隔离级别&#x22;">​</a></h3><p><!--[--><img class="nolebase-enhanced-img absolute inset-0 z-1 bg-black/10" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAJCAYAAABT2S4KAAAEvElEQVR4AQCBAH7/AMA6I//BOyP/wj0l/8Q/J//HQiv/yUUu/8xIMf/NSjP/zEs0/8lJMv/ERC7/vj4o/7Y3If+wMRv/qy0X/6osFf+rLRf/sDIb/7Y3If+8PSf/wUIr/8RELf/EQyz/wkEq/789Jv+8OSL/ujcf/7o2Hv+7Nh//vTgg/8A6Iv/BOyP/AIEAfv8AxlpH/8ZbR//IXEn/yl9M/81iT//QZlP/02pX/9VtWv/Vblv/02xa/85pVv/IY1H/wl1L/7xYRv+3VEL/tlNB/7hVQ/+8WUf/wl9N/8hkUv/MaFb/z2pY/89pV//NZlT/yWJQ/8ZeTP/EXEn/xFtI/8VcSf/IXUr/yl9M/8thTv8AgQB+/wDOjYH/z46C/9GQhP/Tk4f/15eL/9qckP/eoJX/4aSY/+Kmm//ippv/36SZ/9qglf/Um5D/z5eM/8yUif/Lk4j/zZWK/9GZjv/WnpT/26OY/9+nnP/hqJ3/4Kab/92jmP/an5T/1puP/9WYjf/Ul4z/1piN/9ibj//bnZH/3J6S/wCBAH7/ANfCvf/Yw77/2sXA/93IxP/hzcj/5dLO/+rY0//u3dn/8eDc//Hi3v/w4d3/7N/b/+jb2P/k2NT/4dXS/+DV0v/i19T/5tvY/+rf3P/u5OD/8ebj//Lm4//x5OH/7eHd/+rc2f/m2NX/5dbS/+XW0v/n19P/6trW/+3c2P/u3tr/AIEAfv8A3+fn/9/o6P/h6ur/5O7u/+jy8//t+Pn/8/7///f////7/////f////z////6////9v////P////w////8P////H////0////+P////v////9/////f////v////3////8/////D////v////8P////P////2////+f////v///8AgQB+/wDi8/X/4/T2/+X3+P/o+vz/7P////H////2////+//////////////////////////8////+f////b////1////9v////n////8/////v/////////+/////P////j////0////8v////H////z////9/////v//////////////wCBAH7/AOPr6//k6+v/5e3t/+fw8f/r9fX/7/r7//T////5/////f///////////////f////r////3////9P////P////z////9f////f////5////+f////j////1////8f///+7////s////7P///+/////0////+f////3/////////AIEAfv8A4djV/+LZ1v/j2tf/5d3a/+jh3v/s5uP/8evp//Xx7//49vT/+vn3//r6+f/4+fj/9ff2//H19P/u8/L/7PLx/+zy8v/t9PT/7/b2//D39//w9/f/7vb2/+vz8//n7+//5ezs/+Pq6v/k6+v/6O7u/+3z8//z+fn/+P7+//v///8BgQB+/wDgysX/4crF/+LMx//jzsn/5tLN/+rW0v/u3Nf/8uHd//Xm4v/26OX/9unm//To5f/w5uP/7OTh/+nh3//n4N7/5uDe/+fi4P/o4+H/6eXi/+nk4v/n4+H/5ODe/+Hc2v/e2df/3djW/9/Z1//j3dv/6ePg/+/p5v/07uz/9/Hv/1YJzBzZsPKyAAAAAElFTkSuQmCC" width="1222" height="310" style="aspect-ratio:1222 / 310;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAJCAYAAABT2S4KAAAEvElEQVR4AQCBAH7/AMA6I//BOyP/wj0l/8Q/J//HQiv/yUUu/8xIMf/NSjP/zEs0/8lJMv/ERC7/vj4o/7Y3If+wMRv/qy0X/6osFf+rLRf/sDIb/7Y3If+8PSf/wUIr/8RELf/EQyz/wkEq/789Jv+8OSL/ujcf/7o2Hv+7Nh//vTgg/8A6Iv/BOyP/AIEAfv8AxlpH/8ZbR//IXEn/yl9M/81iT//QZlP/02pX/9VtWv/Vblv/02xa/85pVv/IY1H/wl1L/7xYRv+3VEL/tlNB/7hVQ/+8WUf/wl9N/8hkUv/MaFb/z2pY/89pV//NZlT/yWJQ/8ZeTP/EXEn/xFtI/8VcSf/IXUr/yl9M/8thTv8AgQB+/wDOjYH/z46C/9GQhP/Tk4f/15eL/9qckP/eoJX/4aSY/+Kmm//ippv/36SZ/9qglf/Um5D/z5eM/8yUif/Lk4j/zZWK/9GZjv/WnpT/26OY/9+nnP/hqJ3/4Kab/92jmP/an5T/1puP/9WYjf/Ul4z/1piN/9ibj//bnZH/3J6S/wCBAH7/ANfCvf/Yw77/2sXA/93IxP/hzcj/5dLO/+rY0//u3dn/8eDc//Hi3v/w4d3/7N/b/+jb2P/k2NT/4dXS/+DV0v/i19T/5tvY/+rf3P/u5OD/8ebj//Lm4//x5OH/7eHd/+rc2f/m2NX/5dbS/+XW0v/n19P/6trW/+3c2P/u3tr/AIEAfv8A3+fn/9/o6P/h6ur/5O7u/+jy8//t+Pn/8/7///f////7/////f////z////6////9v////P////w////8P////H////0////+P////v////9/////f////v////3////8/////D////v////8P////P////2////+f////v///8AgQB+/wDi8/X/4/T2/+X3+P/o+vz/7P////H////2////+//////////////////////////8////+f////b////1////9v////n////8/////v/////////+/////P////j////0////8v////H////z////9/////v//////////////wCBAH7/AOPr6//k6+v/5e3t/+fw8f/r9fX/7/r7//T////5/////f///////////////f////r////3////9P////P////z////9f////f////5////+f////j////1////8f///+7////s////7P///+/////0////+f////3/////////AIEAfv8A4djV/+LZ1v/j2tf/5d3a/+jh3v/s5uP/8evp//Xx7//49vT/+vn3//r6+f/4+fj/9ff2//H19P/u8/L/7PLx/+zy8v/t9PT/7/b2//D39//w9/f/7vb2/+vz8//n7+//5ezs/+Pq6v/k6+v/6O7u/+3z8//z+fn/+P7+//v///8BgQB+/wDgysX/4crF/+LMx//jzsn/5tLN/+rW0v/u3Nf/8uHd//Xm4v/26OX/9unm//To5f/w5uP/7OTh/+nh3//n4N7/5uDe/+fi4P/o4+H/6eXi/+nk4v/n4+H/5ODe/+Hc2v/e2df/3djW/9/Z1//j3dv/6ePg/+/p5v/07uz/9/Hv/1YJzBzZsPKyAAAAAElFTkSuQmCC" data-src="/assets/level.oBoZI5cL.jpg" loading="lazy" alt="" width="1222" height="310" style="aspect-ratio:1222 / 310;"><!--]--></p><pre><code>-- 查看事务隔离级别

select @@transaction_isolation;

-- 设置事务隔离级别

set [session|global] transaction isolaction level {read uncommitted | read committed | repe}atable read | serializable}
</code></pre><h2 id="存储引擎" tabindex="-1">存储引擎 <a class="header-anchor" href="#存储引擎" aria-label="Permalink to &#x22;存储引擎&#x22;">​</a></h2><p><!--[--><img class="nolebase-enhanced-img absolute inset-0 z-1 bg-black/10" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAOCAYAAABO3B6yAAAHWklEQVR4AQCBAH7/APr29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/AIEAfv8A+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P8AgQB+/wD69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0/wCBAH7/APr29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/AIEAfv8A+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P8AgQB+/wD69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0/wCBAH7/APr29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/AIEAfv8A+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P8AgQB+/wD69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0/wCBAH7/APr29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/AIEAfv8A+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P8AgQB+/wD69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0/wCBAH7/APr29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/AYEAfv8A+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P9gX82bDB+7UgAAAABJRU5ErkJggg==" width="1628" height="777" style="aspect-ratio:1628 / 777;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAOCAYAAABO3B6yAAAHWklEQVR4AQCBAH7/APr29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/AIEAfv8A+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P8AgQB+/wD69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0/wCBAH7/APr29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/AIEAfv8A+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P8AgQB+/wD69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0/wCBAH7/APr29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/AIEAfv8A+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P8AgQB+/wD69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0/wCBAH7/APr29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/AIEAfv8A+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P8AgQB+/wD69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0/wCBAH7/APr29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/AYEAfv8A+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P/69vT/+vb0//r29P9gX82bDB+7UgAAAABJRU5ErkJggg==" data-src="/assets/MySQL_architecture.BUEAZatI.jpg" loading="lazy" alt="" width="1628" height="777" style="aspect-ratio:1628 / 777;"><!--]--></p><h2 id="存储引擎简介" tabindex="-1">存储引擎简介 <a class="header-anchor" href="#存储引擎简介" aria-label="Permalink to &#x22;存储引擎简介&#x22;">​</a></h2><h3 id="在创建表时-指定存储引擎" tabindex="-1">在创建表时，指定存储引擎 <a class="header-anchor" href="#在创建表时-指定存储引擎" aria-label="Permalink to &#x22;在创建表时，指定存储引擎&#x22;">​</a></h3><pre><code>create table 表名
(

    字段1 字段1类型 [comment 字段1注释],

    ......

    字段n 字段n类型 [comment 字段n注释]

)engine = innodb [comment 表注释]
</code></pre><h3 id="查看当前数据库支持的存储引擎" tabindex="-1">查看当前数据库支持的存储引擎 <a class="header-anchor" href="#查看当前数据库支持的存储引擎" aria-label="Permalink to &#x22;查看当前数据库支持的存储引擎&#x22;">​</a></h3><pre><code>show engines;
</code></pre><h2 id="存储引擎特点" tabindex="-1">存储引擎特点 <a class="header-anchor" href="#存储引擎特点" aria-label="Permalink to &#x22;存储引擎特点&#x22;">​</a></h2><h3 id="innodb" tabindex="-1">InnoDB <a class="header-anchor" href="#innodb" aria-label="Permalink to &#x22;InnoDB&#x22;">​</a></h3><p>介绍</p><pre><code>InnoDB是一种兼顾高可靠性和高性能的通用存储引擎，在MySQL5.5之后，InnoDB是默认的MySQL存储引擎。
</code></pre><p>特点</p><pre><code>DML操作遵循ACID模型，支持事务;
行级锁，提高并发访问性能;
支持外键FOREIGNKEY约束，保证数据的完整性和正确性;
</code></pre><p>文件</p><pre><code>xxx.ibd:xxx代表的是表名，innoDB引擎的每一张表都会对应这样一个空间文件，存储该表的表结构（frm、sdi）、数据和索引。
参数：innodb_file_per_table

show variables like 'innodb_file_per_table';
</code></pre><p><!--[--><img class="nolebase-enhanced-img absolute inset-0 z-1 bg-black/10" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAOCAYAAABO3B6yAAAHWklEQVR4AQCBAH7/AOLguf/l4rz/6ebB/+3ryP/x8M//9PPV//X02f/09N3/8vLf/+/w4P/t7uL/6+3l/+vu6f/r7+7/7PDy/+3y9v/s8vj/6/H5/+nv+f/n7ff/5ez2/+Tr9f/k6/X/5u33/+nw+f/s9Pz/8Pj///P7///2/f//9/////j////5////AIEAfv8A4d62/+Pguf/n5L7/7OnF//DuzP/z8dL/9PLX//Py2v/x8Nz/7u7d/+vs3//q6+L/6evm/+rt6//r7u//7O/z/+vv9f/q7/b/6O32/+br9P/k6fP/4+jy/+Pp8v/l6/T/6O72/+zx+f/v9fz/8/n+//X7///3/f//+P7///j+//8AgQB+/wDf2rH/4dy0/+Xguf/p5cD/7urH//Dtzf/x7tH/8O7U/+7s1v/r6tj/6eja/+fn3f/n5+H/6Ojl/+nq6f/p6+3/6evw/+jq8P/m6PD/5Obu/+Lk7f/h5Oz/4eTs/+Pm7v/m6fD/6u3z/+7x9v/y9Pn/9Pf7//b5/P/3+vz/+Pr9/wCBAH7/ANvVqv/d2K3/4dyz/+Xhuf/q5cD/7OjG/+3pyv/s6c3/6ufP/+fl0f/l49P/5OLW/+Ti2v/k497/5uTi/+bl5v/m5uj/5eXp/+Pj6f/h4ef/39/m/97e5f/f3uX/4eDn/+Tj6f/o5+z/7evv//Dv8v/z8vT/9fP1//b19v/39fb/AIEAfv8A1tGj/9jTpv/c16z/4Nyy/+Tguf/n47//6OTD/+fjxv/l4sj/49/K/+DdzP/f3M//393T/+De1//i39v/4uDf/+Pg4f/i3+L/4N3h/97b4P/c2d7/29jd/9zY3v/e2t//4t3i/+bh5f/q5uj/7unr//Hs7f/07u//9e/v//Xw8P8AgQB+/wDPzJ3/0c+g/9XSpv/a16z/3tuz/+Heuf/i373/4d/A/9/dwv/d28T/29nG/9rYyf/a2M3/29nR/93a1f/e29n/3tvb/93a3P/b2Nv/2dba/9jT2P/X0tf/2NPX/9vV2f/e2Nv/49zf/+jh4v/s5OX/7+fo//Lq6f/z6+r/9Ozr/wCBAH7/AMfJmf/Jy5z/zc+h/9LUqP/W2K7/2du0/9rcuf/a3Lz/2Nq+/9bYwP/U1sL/1NXF/9TVyf/W1s3/19jS/9nY1f/Z2Nj/2dfY/9fV1//V0tb/09DU/9PP0//Uz9P/19HV/9vV1//f2dv/5N3f/+nh4v/t5OT/7+fm//Ho5//y6ef/AIEAfv8AvsiX/8HKmv/Ezp//ydKm/83XrP/R2bL/0tu3/9Lauv/Q2Lz/z9a+/83VwP/N1MT/ztTI/9DWzP/S19H/09jV/9TY1//U1tf/0tTW/9DR1f/Pz9P/zs3S/9DO0v/S0NP/19PW/9zX2v/h3N3/5uDh/+rj5P/s5uX/7ufm/+/o5/8AgQB+/wC1yJf/t8qa/7vOn//A0qb/xdet/8jas//J27f/ytu7/8jZvf/H17//xtbC/8bVxf/I1sr/ytfO/8zZ0//O2df/z9nZ/8/Y2f/N1dj/zNLW/8rQ1f/KztP/y8/T/87R1f/T1Nj/2Njb/93d3//i4eP/5uXm/+nn6P/r6en/7Onp/wCBAH7/AKzJmf+uy5z/ss+h/7fUqP+82K//v9y1/8Hduv/C3b3/wdvA/8Daw//A2cX/wNjJ/8LZzv/E2tP/x9zX/8nd2//K3d3/ytve/8nZ3f/H1tv/xtPZ/8bR1//H0df/ytPZ/8/X3P/U29//2uDj/9/k5//j5+r/5urs/+js7f/p7O7/AIEAfv8Ao8yd/6bOoP+q0qX/r9es/7Tbs/+33rn/uuC+/7rgwv+638X/ud3H/7ncyv+63M7/vd3T/7/f2P/D4N3/xeHh/8bh4//G4OT/xd3j/8Ta4f/C197/wtXd/8TV3f/H197/y9rh/9Hf5f/X4+n/3Ojs/+Dr7//k7vL/5vDz/+fw8/8AgQB+/wCczqD/n9Gj/6PVqf+o2bD/rd63/7Hhvf+z48L/tOPG/7Tiyf+04cz/tODP/7bg1P+44tn/u+Pe/7/l4//B5uf/w+bp/8Pk6v/C4un/wN7n/7/b5P+/2uP/wdnj/8Tb5P/J3uf/zuPq/9Tn7v/Z7PL/3u/1/+Hy9//j9Pn/5PX5/wCBAH7/AJfRpP+Z06f/ntes/6Pcs/+o4Lr/rOTA/6/mxv+w5sr/sOXN/7Dk0P+x5NT/suTY/7Xl3f+55+P/vOno/7/q7P/B6u7/wejv/8Dl7v++4uv/vd/p/73d6P+/3ef/wt/p/8fi6//M5u//0uvz/9jv9//c8/r/4PX8/+L3/f/j+P7/AYEAfv8AlNKl/5fUqP+b2K7/oN21/6bivP+q5cL/rOfI/67ozP+u58//rubS/6/l1v+x5tv/tOfg/7fp5f+76+v/vuzv/7/s8f/A6vH/v+fw/73k7v+84ez/vN/q/77f6v/B4Ov/xuTu/8vo8v/R7Pb/1/H5/9v1/P/f9///4fn//+L6//+0lzdWrPECTAAAAABJRU5ErkJggg==" width="1506" height="644" style="aspect-ratio:1506 / 644;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAOCAYAAABO3B6yAAAHWklEQVR4AQCBAH7/AOLguf/l4rz/6ebB/+3ryP/x8M//9PPV//X02f/09N3/8vLf/+/w4P/t7uL/6+3l/+vu6f/r7+7/7PDy/+3y9v/s8vj/6/H5/+nv+f/n7ff/5ez2/+Tr9f/k6/X/5u33/+nw+f/s9Pz/8Pj///P7///2/f//9/////j////5////AIEAfv8A4d62/+Pguf/n5L7/7OnF//DuzP/z8dL/9PLX//Py2v/x8Nz/7u7d/+vs3//q6+L/6evm/+rt6//r7u//7O/z/+vv9f/q7/b/6O32/+br9P/k6fP/4+jy/+Pp8v/l6/T/6O72/+zx+f/v9fz/8/n+//X7///3/f//+P7///j+//8AgQB+/wDf2rH/4dy0/+Xguf/p5cD/7urH//Dtzf/x7tH/8O7U/+7s1v/r6tj/6eja/+fn3f/n5+H/6Ojl/+nq6f/p6+3/6evw/+jq8P/m6PD/5Obu/+Lk7f/h5Oz/4eTs/+Pm7v/m6fD/6u3z/+7x9v/y9Pn/9Pf7//b5/P/3+vz/+Pr9/wCBAH7/ANvVqv/d2K3/4dyz/+Xhuf/q5cD/7OjG/+3pyv/s6c3/6ufP/+fl0f/l49P/5OLW/+Ti2v/k497/5uTi/+bl5v/m5uj/5eXp/+Pj6f/h4ef/39/m/97e5f/f3uX/4eDn/+Tj6f/o5+z/7evv//Dv8v/z8vT/9fP1//b19v/39fb/AIEAfv8A1tGj/9jTpv/c16z/4Nyy/+Tguf/n47//6OTD/+fjxv/l4sj/49/K/+DdzP/f3M//393T/+De1//i39v/4uDf/+Pg4f/i3+L/4N3h/97b4P/c2d7/29jd/9zY3v/e2t//4t3i/+bh5f/q5uj/7unr//Hs7f/07u//9e/v//Xw8P8AgQB+/wDPzJ3/0c+g/9XSpv/a16z/3tuz/+Heuf/i373/4d/A/9/dwv/d28T/29nG/9rYyf/a2M3/29nR/93a1f/e29n/3tvb/93a3P/b2Nv/2dba/9jT2P/X0tf/2NPX/9vV2f/e2Nv/49zf/+jh4v/s5OX/7+fo//Lq6f/z6+r/9Ozr/wCBAH7/AMfJmf/Jy5z/zc+h/9LUqP/W2K7/2du0/9rcuf/a3Lz/2Nq+/9bYwP/U1sL/1NXF/9TVyf/W1s3/19jS/9nY1f/Z2Nj/2dfY/9fV1//V0tb/09DU/9PP0//Uz9P/19HV/9vV1//f2dv/5N3f/+nh4v/t5OT/7+fm//Ho5//y6ef/AIEAfv8AvsiX/8HKmv/Ezp//ydKm/83XrP/R2bL/0tu3/9Lauv/Q2Lz/z9a+/83VwP/N1MT/ztTI/9DWzP/S19H/09jV/9TY1//U1tf/0tTW/9DR1f/Pz9P/zs3S/9DO0v/S0NP/19PW/9zX2v/h3N3/5uDh/+rj5P/s5uX/7ufm/+/o5/8AgQB+/wC1yJf/t8qa/7vOn//A0qb/xdet/8jas//J27f/ytu7/8jZvf/H17//xtbC/8bVxf/I1sr/ytfO/8zZ0//O2df/z9nZ/8/Y2f/N1dj/zNLW/8rQ1f/KztP/y8/T/87R1f/T1Nj/2Njb/93d3//i4eP/5uXm/+nn6P/r6en/7Onp/wCBAH7/AKzJmf+uy5z/ss+h/7fUqP+82K//v9y1/8Hduv/C3b3/wdvA/8Daw//A2cX/wNjJ/8LZzv/E2tP/x9zX/8nd2//K3d3/ytve/8nZ3f/H1tv/xtPZ/8bR1//H0df/ytPZ/8/X3P/U29//2uDj/9/k5//j5+r/5urs/+js7f/p7O7/AIEAfv8Ao8yd/6bOoP+q0qX/r9es/7Tbs/+33rn/uuC+/7rgwv+638X/ud3H/7ncyv+63M7/vd3T/7/f2P/D4N3/xeHh/8bh4//G4OT/xd3j/8Ta4f/C197/wtXd/8TV3f/H197/y9rh/9Hf5f/X4+n/3Ojs/+Dr7//k7vL/5vDz/+fw8/8AgQB+/wCczqD/n9Gj/6PVqf+o2bD/rd63/7Hhvf+z48L/tOPG/7Tiyf+04cz/tODP/7bg1P+44tn/u+Pe/7/l4//B5uf/w+bp/8Pk6v/C4un/wN7n/7/b5P+/2uP/wdnj/8Tb5P/J3uf/zuPq/9Tn7v/Z7PL/3u/1/+Hy9//j9Pn/5PX5/wCBAH7/AJfRpP+Z06f/ntes/6Pcs/+o4Lr/rOTA/6/mxv+w5sr/sOXN/7Dk0P+x5NT/suTY/7Xl3f+55+P/vOno/7/q7P/B6u7/wejv/8Dl7v++4uv/vd/p/73d6P+/3ef/wt/p/8fi6//M5u//0uvz/9jv9//c8/r/4PX8/+L3/f/j+P7/AYEAfv8AlNKl/5fUqP+b2K7/oN21/6bivP+q5cL/rOfI/67ozP+u58//rubS/6/l1v+x5tv/tOfg/7fp5f+76+v/vuzv/7/s8f/A6vH/v+fw/73k7v+84ez/vN/q/77f6v/B4Ov/xuTu/8vo8v/R7Pb/1/H5/9v1/P/f9///4fn//+L6//+0lzdWrPECTAAAAABJRU5ErkJggg==" data-src="/assets/Logical_storage_structure.B6ySlM50.jpg" loading="lazy" alt="" width="1506" height="644" style="aspect-ratio:1506 / 644;"><!--]--> -- 区:1M-64页-页:16k</p><h3 id="myisam" tabindex="-1">MyISAM <a class="header-anchor" href="#myisam" aria-label="Permalink to &#x22;MyISAM&#x22;">​</a></h3><p>介绍</p><pre><code>MyISAM是MySQL早期的默认存储引擎。
</code></pre><p>特点</p><pre><code>不支持事务，不支持外键
支持表锁，不支持行锁
访问速度快
</code></pre><p>文件</p><pre><code>xxx.sdi: 存储表结构信息
xxx.MYD: 存储数据
xxx.MYI: 存储索引
</code></pre><h3 id="memory" tabindex="-1">Memory <a class="header-anchor" href="#memory" aria-label="Permalink to &#x22;Memory&#x22;">​</a></h3><p>介绍</p><pre><code>Memory引擎的表数据时存储再内存中的，由于收到硬件影响、或断电问题的影响，只能将这些表作为临时表或缓存表使用。
</code></pre><p>特点</p><pre><code>内存存放
hash索引(默认)
</code></pre><p>文件</p><pre><code>xxx.sdi: 存储表结构信息
</code></pre><p><!--[--><img class="nolebase-enhanced-img absolute inset-0 z-1 bg-black/10" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAOCAYAAABO3B6yAAAHWklEQVR4AQCBAH7/ANqXjv/Zl43/2JaM/9aUi//Vk4r/1JOJ/9STiv/VlIv/1paM/9eXjv/YmZD/2puR/9uck//cnZT/3Z+W/9+gl//gopn/4qSb/+OlnP/jpZz/46Sb/+Gimf/fn5b/3JyT/9uakf/amZD/25qR/96ck//ioJb/5qSa/+mnnf/rqZ//AIEAfv8A252U/9udlP/Zm5L/2JqR/9aZkP/VmJD/1ZmQ/9aakf/Xm5L/2J2U/9melv/aoJf/26GY/9yimv/do5v/36Wd/+Gnnv/iqKD/46mh/+Spof/jqKD/4aae/9+km//doZj/25+W/9uelf/cn5b/3qGY/+KlnP/mqJ//6aui/+utpP8AgQB+/wDeqKD/3qef/9ymnv/bpZ3/2aOc/9ijm//Yo5v/2KSc/9mlnf/app//26eg/9ypof/cqqP/3auk/96spf/grab/4a+o/+Oxqv/ksqv/5LKr/+Sxqv/ir6j/4K2l/96qo//cqKH/26eg/9yooP/fqqL/462m/+axqf/qtKz/67au/wCBAH7/AOK2sP/hta//4LSu/96zrf/dsav/3LGr/9uwq//bsav/3LKs/9yzrf/dtK7/3bWv/961sP/etrH/37ey/+C5s//iurX/5Ly3/+W9uP/lvrj/5b23/+O7tv/hubP/37aw/920rv/ds63/3bOu/+C1sP/jubP/57y2/+q/uf/swbv/AIEAfv8A58XB/+bFwf/kw7//48K+/+HBvf/gwLz/37+8/9/AvP/fwL3/38G9/+DCvv/gwr//4MO//+DDwP/hxMH/4sXC/+PHxP/lycX/5srH/+fLx//nysf/5cjF/+PGw//hw8D/38G+/97AvP/fwL3/4cK//+TFwf/oycX/68vI/+zNyf8AgQB+/wDr1NL/6tTR/+nS0P/n0c//5dDN/+TPzP/jzsz/487M/+PPzf/jz83/4s/O/+LQzv/i0M7/4tDP/+LRz//j0tH/5dTS/+fW1P/o19b/6djW/+nX1v/n1tT/5dTS/+PRz//hz83/4M3M/+DNzP/iz83/5dLQ/+jV0//r19X/7dnX/wCBAH7/AO/h4P/u4N//7N/e/+ve3f/p3Nz/6Nvb/+fb2v/m29r/5tvb/+bb2//l3Nv/5dzb/+Tc2//k3Nz/5dzc/+be3v/n39//6eHh/+vj4//r5OT/6+Tk/+ri4v/o4OD/5t3d/+Pb2//i2dn/4tnZ/+Ta2v/m3Nz/6d/f/+zi4f/t4+P/AIEAfv8A8erq//Hp6v/v6On/7ufn/+zm5v/r5eX/6uXl/+rl5f/p5eX/6eXm/+jl5v/o5eb/5+Xm/+fl5v/n5uf/6Ofo/+rp6v/s6+z/7e3u/+7u7//u7u//7ezt/+vq6//o5+j/5uTm/+Tj5P/k4uP/5ePk/+fl5v/q5+j/7Onq/+3q6/8AgQB+/wDz7/D/8u/v//Hu7v/w7e3/7uzs/+3r7P/t6+z/7Ovs/+zr7P/s6+3/6+vt/+rr7f/q6+3/6evt/+rs7v/r7e//7O/x/+7y8//w9Pb/8fX3//L19//w9PX/7vHz/+vu8P/p6+3/5+nr/+bo6v/m6Or/6Orr/+rs7f/s7u//7e/w/wCBAH7/APTx8v/z8PH/8u/w//Hu7//w7u//7+3u/+7t7//u7u//7u7w/+7v8P/t7/D/7e/w/+zv8P/s7/H/7PDy/+3x8//v8/X/8fb4//P4+v/1+fv/9fn8//T4+v/x9vj/7vP1/+vv8f/p7e//6Ovt/+jr7f/p7O7/6u7w/+zv8f/t8PL/AIEAfv8A9PDw//Pv8P/y7u//8e7u//Dt7v/w7e7/8O3u//Du7//w7/D/8O/x/+/w8f/v8PH/7vDx/+7w8v/v8fP/8PP1//L19//0+Pr/9vr8//j8/v/4/P7/9/v9//T4+v/x9ff/7fHz/+vu8P/p7O7/6ezu/+ns7v/r7u//7O/x/+3w8f8AgQB+/wDz7e3/8+3t//Ls7P/x6+z/8evs//Dr7P/w7O3/8O3u//Hu7//x7u//8e/w//Dv8P/w8PH/8PDx//Dx8//y8/X/9Pb3//b4+v/5+/z/+vz+//r9/v/5+/3/9/n6//P19//v8fP/7O7w/+rs7f/p6+z/6uvt/+vs7v/s7e//7e7v/wCBAH7/APPq6v/y6ur/8unp//Hp6f/w6en/8Onp//Dq6v/x6+z/8ezt//Lt7v/y7u//8e7v//Hv8P/x7/D/8vHy//Pz9P/29fb/+Pj5//v7/P/8/P7//P3+//v7/f/4+fr/9fX2//Hx8v/t7e//6+vs/+rq6//q6uv/6+rs/+zr7f/t7O3/AYEAfv8A8uno//Lo6P/x6Oj/8ejn//Do5//w6Oj/8enp//Hq6v/y6+z/8uzt//Lt7v/y7u7/8u7v//Lv8P/z8PH/9PLz//f19v/5+Pn/+/r8//38/f/9/P7//Pv8//n4+f/19Pb/8fDy/+7t7v/r6uv/6unq/+rp6v/r6er/7Orr/+3r7P/Yfzdzxx++igAAAABJRU5ErkJggg==" width="1513" height="712" style="aspect-ratio:1513 / 712;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAOCAYAAABO3B6yAAAHWklEQVR4AQCBAH7/ANqXjv/Zl43/2JaM/9aUi//Vk4r/1JOJ/9STiv/VlIv/1paM/9eXjv/YmZD/2puR/9uck//cnZT/3Z+W/9+gl//gopn/4qSb/+OlnP/jpZz/46Sb/+Gimf/fn5b/3JyT/9uakf/amZD/25qR/96ck//ioJb/5qSa/+mnnf/rqZ//AIEAfv8A252U/9udlP/Zm5L/2JqR/9aZkP/VmJD/1ZmQ/9aakf/Xm5L/2J2U/9melv/aoJf/26GY/9yimv/do5v/36Wd/+Gnnv/iqKD/46mh/+Spof/jqKD/4aae/9+km//doZj/25+W/9uelf/cn5b/3qGY/+KlnP/mqJ//6aui/+utpP8AgQB+/wDeqKD/3qef/9ymnv/bpZ3/2aOc/9ijm//Yo5v/2KSc/9mlnf/app//26eg/9ypof/cqqP/3auk/96spf/grab/4a+o/+Oxqv/ksqv/5LKr/+Sxqv/ir6j/4K2l/96qo//cqKH/26eg/9yooP/fqqL/462m/+axqf/qtKz/67au/wCBAH7/AOK2sP/hta//4LSu/96zrf/dsav/3LGr/9uwq//bsav/3LKs/9yzrf/dtK7/3bWv/961sP/etrH/37ey/+C5s//iurX/5Ly3/+W9uP/lvrj/5b23/+O7tv/hubP/37aw/920rv/ds63/3bOu/+C1sP/jubP/57y2/+q/uf/swbv/AIEAfv8A58XB/+bFwf/kw7//48K+/+HBvf/gwLz/37+8/9/AvP/fwL3/38G9/+DCvv/gwr//4MO//+DDwP/hxMH/4sXC/+PHxP/lycX/5srH/+fLx//nysf/5cjF/+PGw//hw8D/38G+/97AvP/fwL3/4cK//+TFwf/oycX/68vI/+zNyf8AgQB+/wDr1NL/6tTR/+nS0P/n0c//5dDN/+TPzP/jzsz/487M/+PPzf/jz83/4s/O/+LQzv/i0M7/4tDP/+LRz//j0tH/5dTS/+fW1P/o19b/6djW/+nX1v/n1tT/5dTS/+PRz//hz83/4M3M/+DNzP/iz83/5dLQ/+jV0//r19X/7dnX/wCBAH7/AO/h4P/u4N//7N/e/+ve3f/p3Nz/6Nvb/+fb2v/m29r/5tvb/+bb2//l3Nv/5dzb/+Tc2//k3Nz/5dzc/+be3v/n39//6eHh/+vj4//r5OT/6+Tk/+ri4v/o4OD/5t3d/+Pb2//i2dn/4tnZ/+Ta2v/m3Nz/6d/f/+zi4f/t4+P/AIEAfv8A8erq//Hp6v/v6On/7ufn/+zm5v/r5eX/6uXl/+rl5f/p5eX/6eXm/+jl5v/o5eb/5+Xm/+fl5v/n5uf/6Ofo/+rp6v/s6+z/7e3u/+7u7//u7u//7ezt/+vq6//o5+j/5uTm/+Tj5P/k4uP/5ePk/+fl5v/q5+j/7Onq/+3q6/8AgQB+/wDz7/D/8u/v//Hu7v/w7e3/7uzs/+3r7P/t6+z/7Ovs/+zr7P/s6+3/6+vt/+rr7f/q6+3/6evt/+rs7v/r7e//7O/x/+7y8//w9Pb/8fX3//L19//w9PX/7vHz/+vu8P/p6+3/5+nr/+bo6v/m6Or/6Orr/+rs7f/s7u//7e/w/wCBAH7/APTx8v/z8PH/8u/w//Hu7//w7u//7+3u/+7t7//u7u//7u7w/+7v8P/t7/D/7e/w/+zv8P/s7/H/7PDy/+3x8//v8/X/8fb4//P4+v/1+fv/9fn8//T4+v/x9vj/7vP1/+vv8f/p7e//6Ovt/+jr7f/p7O7/6u7w/+zv8f/t8PL/AIEAfv8A9PDw//Pv8P/y7u//8e7u//Dt7v/w7e7/8O3u//Du7//w7/D/8O/x/+/w8f/v8PH/7vDx/+7w8v/v8fP/8PP1//L19//0+Pr/9vr8//j8/v/4/P7/9/v9//T4+v/x9ff/7fHz/+vu8P/p7O7/6ezu/+ns7v/r7u//7O/x/+3w8f8AgQB+/wDz7e3/8+3t//Ls7P/x6+z/8evs//Dr7P/w7O3/8O3u//Hu7//x7u//8e/w//Dv8P/w8PH/8PDx//Dx8//y8/X/9Pb3//b4+v/5+/z/+vz+//r9/v/5+/3/9/n6//P19//v8fP/7O7w/+rs7f/p6+z/6uvt/+vs7v/s7e//7e7v/wCBAH7/APPq6v/y6ur/8unp//Hp6f/w6en/8Onp//Dq6v/x6+z/8ezt//Lt7v/y7u//8e7v//Hv8P/x7/D/8vHy//Pz9P/29fb/+Pj5//v7/P/8/P7//P3+//v7/f/4+fr/9fX2//Hx8v/t7e//6+vs/+rq6//q6uv/6+rs/+zr7f/t7O3/AYEAfv8A8uno//Lo6P/x6Oj/8ejn//Do5//w6Oj/8enp//Hq6v/y6+z/8uzt//Lt7v/y7u7/8u7v//Lv8P/z8PH/9PLz//f19v/5+Pn/+/r8//38/f/9/P7//Pv8//n4+f/19Pb/8fDy/+7t7v/r6uv/6unq/+rp6v/r6er/7Orr/+3r7P/Yfzdzxx++igAAAABJRU5ErkJggg==" data-src="/assets/sd.CUAkMIZE.png" loading="lazy" alt="" width="1513" height="712" style="aspect-ratio:1513 / 712;"><!--]--></p><h2 id="存储引擎选择" tabindex="-1">存储引擎选择 <a class="header-anchor" href="#存储引擎选择" aria-label="Permalink to &#x22;存储引擎选择&#x22;">​</a></h2><h3 id="在选择存储引擎时-应该根据应用系统的特点选择合适的存储引擎。对于复杂的应用系统-还可以根据实际情况选择多种存储引擎进行组合。" tabindex="-1">在选择存储引擎时，应该根据应用系统的特点选择合适的存储引擎。对于复杂的应用系统，还可以根据实际情况选择多种存储引擎进行组合。 <a class="header-anchor" href="#在选择存储引擎时-应该根据应用系统的特点选择合适的存储引擎。对于复杂的应用系统-还可以根据实际情况选择多种存储引擎进行组合。" aria-label="Permalink to &#x22;在选择存储引擎时，应该根据应用系统的特点选择合适的存储引擎。对于复杂的应用系统，还可以根据实际情况选择多种存储引擎进行组合。&#x22;">​</a></h3><pre><code>InnoDB: 是MySQL的默认存储引擎，支持事务、外键。如果是应用对事物的完整性有比较高的要求，再并发条件下要求数据一致性，数据操作除了插入和查询之外，还包含很多的更新、删除操作，那么InnoDB存储引擎是比较合适的选择。

MyISAM: 如果应用是以读操作和插入操作为主，只有很少的更新和删除操作，并且事务的完整性、并发性要求不是很高，那么选择这个存储引擎是非常合适的。

MEMORY: 将所用数据保存再内存中，访问速度快，通常用于临时表及缓存。MEMORY的缺陷就是对表的大小有限制，太大的表无法缓存在内存中，而且无法保证数据的安全性。
</code></pre><h2 id="mysql安装-linux版" tabindex="-1">MySQL安装(linux版) <a class="header-anchor" href="#mysql安装-linux版" aria-label="Permalink to &#x22;MySQL安装(linux版)&#x22;">​</a></h2><pre><code>密码等级

政策             执行的测试

0或者LOW         长度

1或者MEDIUM      长度；数字、小写/大写和特殊字符

2或者STRONG      长度；数字、小写/大写和特殊字符；字典文件

设置密码等级

set global validate_password.policy = 0;

设置密码长度

set global validate_password.length = 4;
</code></pre><h2 id="索引" tabindex="-1">索引 <a class="header-anchor" href="#索引" aria-label="Permalink to &#x22;索引&#x22;">​</a></h2><h3 id="索引概述" tabindex="-1">索引概述 <a class="header-anchor" href="#索引概述" aria-label="Permalink to &#x22;索引概述&#x22;">​</a></h3><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>介绍</span></span>
<span class="line"><span></span></span>
<span class="line"><span>索引（index）是帮助MySQL高效获取数据的数据结构（有序）。在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。</span></span></code></pre></div><h3 id="演示" tabindex="-1">演示 <a class="header-anchor" href="#演示" aria-label="Permalink to &#x22;演示&#x22;">​</a></h3><img src="https://m946i.github.io/mysql/wsy.png" alt="wsy" style="zoom:80%;"><img src="https://m946i.github.io/mysql/ysy.png" alt="ysy" style="zoom:80%;"><h5 id="优缺点" tabindex="-1">优缺点 <a class="header-anchor" href="#优缺点" aria-label="Permalink to &#x22;优缺点&#x22;">​</a></h5><table><thead><tr><th style="text-align:center;">优势</th><th style="text-align:center;">劣势</th></tr></thead><tbody><tr><td style="text-align:center;">提高数据检索的效率，降低数据库的IO成本</td><td style="text-align:center;">索引列也是要占用空间的</td></tr><tr><td style="text-align:center;">通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗</td><td style="text-align:center;">索引大大提高了查询效率，同时却也降低更新表的速度，如对表进行INSERT、UPDATE、DELETE时，效率降低。</td></tr></tbody></table><h3 id="索引结构" tabindex="-1">索引结构 <a class="header-anchor" href="#索引结构" aria-label="Permalink to &#x22;索引结构&#x22;">​</a></h3><p>MySQL的索引是在存储引擎层实现的，不同的存储引擎有不同的结构，包含以下几种：</p><table><thead><tr><th style="text-align:center;">索引结构</th><th style="text-align:center;">描述</th></tr></thead><tbody><tr><td style="text-align:center;">B+Tree索引</td><td style="text-align:center;">最常见的索引类型，大部分都支持B+树索引</td></tr><tr><td style="text-align:center;">Hash索引</td><td style="text-align:center;">底层数据结构是用哈希表实现的，只有精确匹配索引列的查询才有效，不支持范围查询</td></tr><tr><td style="text-align:center;">R-Tree（空间索引）</td><td style="text-align:center;">空间索引是MyISAM引擎的一个特殊索引类型，主要用于地理数据类型，通常使用较少</td></tr><tr><td style="text-align:center;">Full-text（全文索引）</td><td style="text-align:center;">是一种通过建立倒排序索引，快速匹配文档的方式。类似于Lucene，Solr，ES</td></tr></tbody></table><ul><li><p>B-Tree（<strong>多路</strong>平衡查找树）</p><p>以一颗最大度数（max-degree）为5（5阶）的b-tree为例（每个节点最多存储4个key，5个指针）：<!--[--><img class="nolebase-enhanced-img absolute inset-0 z-1 bg-black/10" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAJCAYAAABT2S4KAAAEvElEQVR4AQCBAH7/AOnj5v/p4+b/6ePm/+nj5//p4+f/6OPn/+jj5//n4+j/5+To/+fk6P/m5On/5uTp/+bk6f/l5On/5eTp/+Xk6f/m5On/5uTp/+bk6P/n5Oj/5+Tn/+jk5//p5Ob/6eTm/+rk5f/q5OX/6+Tk/+zj5P/s4+P/7OPj/+3j4//t4+P/AIEAfv8A5eTq/+Xk6v/k5Or/5OTq/+Tk6v/j5ev/4+Xr/+Pl6//i5ev/4uXs/+Ll7P/h5ez/4eXs/+Hl7P/h5ez/4eXs/+Hl7P/i5ez/4uXr/+Pl6//j5er/5OXq/+Xl6f/l5ej/5uXo/+fl5//n5Of/6OTm/+jk5v/p5Ob/6eTl/+nk5f8AgQB+/wDd5+//3efv/93n7//c5/D/3Ofw/9zn8P/b5/D/2+fx/9vn8f/b5/H/2ufx/9rn8f/a5/H/2ufx/9rn8f/a5/H/2+fx/9vn8P/c5/D/3Ofv/93n7//e5+7/3+bu/9/m7f/g5uz/4ebs/+Lm6//i5uv/4+bq/+Pm6v/k5ur/5OXp/wCBAH7/ANXp9f/V6fX/1en1/9Xp9f/U6fX/1On1/9Tp9f/U6fb/0+n2/9Pp9v/T6fb/0+n2/9Pp9v/T6fb/1On2/9Tp9f/V6fX/1en1/9bp9P/X6fP/2Ojz/9jo8v/Z6PH/2ujx/9vo8P/c5+//3efv/93n7v/e5+7/3+ft/9/n7f/f5+3/AIEAfv8A0Ov4/9Dr+P/P6/j/z+v4/8/r+P/P6/j/z+v4/8/r+f/P6/n/z+v5/8/r+f/P6/n/z+v4/9Dr+P/Q6/j/0ev4/9Hq9//S6vb/0+r2/9Tq9f/V6fT/1un0/9fp8//Y6fL/2ejx/9ro8P/b6PD/3Ojv/9zo7//d6O7/3efu/93n7v8AgQB+/wDO7fj/zu34/87t+P/O7fj/zu34/87t+P/O7fj/zuz4/87s+P/O7Pj/zuz4/8/s+P/P7Pj/0Oz3/9Dr9//R6/b/0uv2/9Pr9f/U6vT/1er0/9bq8//X6fL/2Onx/9rp8P/b6e//3Oju/93o7v/e6O3/3ujt/9/o7P/f5+z/4Ofs/wCBAH7/ANDt9f/Q7fX/0O31/9Dt9f/Q7fX/0O31/9Dt9f/Q7fX/0e31/9Ht9f/R7PX/0uz1/9Ls9P/T7PT/1Oz0/9Xr8//W6/L/1+vx/9jq8f/Z6vD/2unv/9zp7v/d6e3/3ujs/+Do6//h6Or/4ufp/+Pn6f/k5+j/5Ofo/+Xn5//l5+f/AIEAfv8A1O3y/9Tt8v/U7fL/1O3y/9Tt8v/U7fL/1O3y/9Tt8v/V7fH/1ezx/9Xs8f/W7PH/1uzw/9fr8P/Y6+//2evv/9rq7v/c6u3/3ers/97p6//g6er/4ejp/+Po6P/k6Of/5efm/+fn5f/o5+T/6ebk/+nm4//q5uP/6+bi/+vm4v8BgQB+/wDW7e//1u3v/9bt7//X7e//1+3v/9ft7//X7e//1+3v/9fs7//Y7O//2Ozu/9ns7v/Z6+7/2uvt/9vr7f/c6uz/3err/9/q6v/g6en/4uno/+Po5//l6Ob/5ufl/+jn5P/p5+P/6ubi/+vm4f/s5uH/7eXg/+7l4P/u5d//7+Xf/4bUKAgcce6BAAAAAElFTkSuQmCC" width="1139" height="339" style="aspect-ratio:1139 / 339;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAJCAYAAABT2S4KAAAEvElEQVR4AQCBAH7/AOnj5v/p4+b/6ePm/+nj5//p4+f/6OPn/+jj5//n4+j/5+To/+fk6P/m5On/5uTp/+bk6f/l5On/5eTp/+Xk6f/m5On/5uTp/+bk6P/n5Oj/5+Tn/+jk5//p5Ob/6eTm/+rk5f/q5OX/6+Tk/+zj5P/s4+P/7OPj/+3j4//t4+P/AIEAfv8A5eTq/+Xk6v/k5Or/5OTq/+Tk6v/j5ev/4+Xr/+Pl6//i5ev/4uXs/+Ll7P/h5ez/4eXs/+Hl7P/h5ez/4eXs/+Hl7P/i5ez/4uXr/+Pl6//j5er/5OXq/+Xl6f/l5ej/5uXo/+fl5//n5Of/6OTm/+jk5v/p5Ob/6eTl/+nk5f8AgQB+/wDd5+//3efv/93n7//c5/D/3Ofw/9zn8P/b5/D/2+fx/9vn8f/b5/H/2ufx/9rn8f/a5/H/2ufx/9rn8f/a5/H/2+fx/9vn8P/c5/D/3Ofv/93n7//e5+7/3+bu/9/m7f/g5uz/4ebs/+Lm6//i5uv/4+bq/+Pm6v/k5ur/5OXp/wCBAH7/ANXp9f/V6fX/1en1/9Xp9f/U6fX/1On1/9Tp9f/U6fb/0+n2/9Pp9v/T6fb/0+n2/9Pp9v/T6fb/1On2/9Tp9f/V6fX/1en1/9bp9P/X6fP/2Ojz/9jo8v/Z6PH/2ujx/9vo8P/c5+//3efv/93n7v/e5+7/3+ft/9/n7f/f5+3/AIEAfv8A0Ov4/9Dr+P/P6/j/z+v4/8/r+P/P6/j/z+v4/8/r+f/P6/n/z+v5/8/r+f/P6/n/z+v4/9Dr+P/Q6/j/0ev4/9Hq9//S6vb/0+r2/9Tq9f/V6fT/1un0/9fp8//Y6fL/2ejx/9ro8P/b6PD/3Ojv/9zo7//d6O7/3efu/93n7v8AgQB+/wDO7fj/zu34/87t+P/O7fj/zu34/87t+P/O7fj/zuz4/87s+P/O7Pj/zuz4/8/s+P/P7Pj/0Oz3/9Dr9//R6/b/0uv2/9Pr9f/U6vT/1er0/9bq8//X6fL/2Onx/9rp8P/b6e//3Oju/93o7v/e6O3/3ujt/9/o7P/f5+z/4Ofs/wCBAH7/ANDt9f/Q7fX/0O31/9Dt9f/Q7fX/0O31/9Dt9f/Q7fX/0e31/9Ht9f/R7PX/0uz1/9Ls9P/T7PT/1Oz0/9Xr8//W6/L/1+vx/9jq8f/Z6vD/2unv/9zp7v/d6e3/3ujs/+Do6//h6Or/4ufp/+Pn6f/k5+j/5Ofo/+Xn5//l5+f/AIEAfv8A1O3y/9Tt8v/U7fL/1O3y/9Tt8v/U7fL/1O3y/9Tt8v/V7fH/1ezx/9Xs8f/W7PH/1uzw/9fr8P/Y6+//2evv/9rq7v/c6u3/3ers/97p6//g6er/4ejp/+Po6P/k6Of/5efm/+fn5f/o5+T/6ebk/+nm4//q5uP/6+bi/+vm4v8BgQB+/wDW7e//1u3v/9bt7//X7e//1+3v/9ft7//X7e//1+3v/9fs7//Y7O//2Ozu/9ns7v/Z6+7/2uvt/9vr7f/c6uz/3err/9/q6v/g6en/4uno/+Po5//l6Ob/5ufl/+jn5P/p5+P/6ubi/+vm4f/s5uH/7eXg/+7l4P/u5d//7+Xf/4bUKAgcce6BAAAAAElFTkSuQmCC" data-src="/assets/image-20231216154207872.Cz6gh1Wi.png" loading="lazy" alt="" width="1139" height="339" style="aspect-ratio:1139 / 339;"><!--]--><a class="VPNolebaseInlinePreviewLink" relative="" href="https://www.cs.usfca.edu/~galles/visualization/BTree.html" target="_blank" rel="noreferrer" data-v-0925c8fc=""><!--[-->B树<!--]--><!----><!----></a></p></li><li><p>B+Tree</p><p>以一颗最大度数（max-degree）为4（4阶）的b+tree为例：<!--[--><img class="nolebase-enhanced-img absolute inset-0 z-1 bg-black/10" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAJCAYAAABT2S4KAAAEvElEQVR4AQCBAH7/AOrn4v/q5+L/6efi/+nn4//o5+T/5+fl/+bn5v/l5+f/4+fo/+Lo6f/h6Or/4Ojr/+Do6//f6Oz/3+js/9/o7P/f6Ov/4Ojr/+Ho6v/i6On/4+jo/+To5v/m6OX/6Ojj/+no4f/r6OD/7Ojf/+7o3f/v6Nz/7+jb//Do2//w6Nr/AIEAfv8A6Obk/+jm5f/n5uX/5ubm/+bn5//l5+j/4+fp/+Ln6v/h5+v/4Ofs/9/n7f/e5+3/3efu/93n7v/d5+//3efu/93n7v/e5+3/3+ft/+Dn7P/h5+r/4ufp/+Tn5//m5+b/5+fk/+nn4//q5+H/7Ofg/+3n3//t597/7ufd/+7n3f8AgQB+/wDk5un/5Obp/+Pm6v/j5ur/4ubr/+Hm7P/g5u3/3ubu/93m7//c5vD/2+bx/9rm8v/a5vL/2ebz/9nn8//Z5/P/2ufz/9rn8v/b5/H/3Ofw/93m7//f5u3/4ebs/+Lm6v/k5un/5ebn/+fm5v/o5uT/6ebj/+rm4v/r5uL/6+bi/wCBAH7/AODl7v/f5e7/3+Xu/97m7//d5vD/3Obx/9vm8v/a5vP/2eb0/9jm9f/X5vb/1ub2/9bm9//V5vf/1eb3/9Xm9//W5vf/1ub2/9fm9f/Y5vT/2ubz/9vm8v/d5vD/3ubu/+Dm7f/i5uv/4+Xq/+Xl6f/m5ej/5+Xn/+fl5v/o5eb/AIEAfv8A3Obx/9zm8f/b5vH/2+by/9rm8//Z5vT/2Ob1/9fm9v/W5vf/1eb4/9Tm+f/T5vn/0ub6/9Lm+v/S5vr/0ub6/9Lm+v/T5vn/1Ob4/9Xm9//X5vb/2Ob0/9rm8//c5vH/3ebw/9/m7v/g5u3/4ubr/+Pm6v/k5en/5OXp/+Xl6f8AgQB+/wDa6PH/2ejx/9no8v/Y6PP/2Ojz/9fo9P/W6PX/1Oj2/9Po9//S6Pj/0uj5/9Ho+v/Q6Pr/0Oj7/9Do+//Q6Pv/0ej6/9Ho+v/S6Pn/1Oj4/9Xn9v/W5/X/2Ofz/9rn8v/c5/D/3efu/9/n7f/g5+z/4efr/+Ln6v/j5+n/4+fp/wCBAH7/ANnq8P/Y6vD/2Orx/9fq8f/X6vL/1urz/9Xq9P/U6vX/0+r2/9Lq9//R6vj/0Or4/9Dq+f/P6vn/z+r5/8/q+f/Q6vn/0er4/9Lq9//T6vb/1On1/9bp8//Y6fL/2unw/9vp7v/d6e3/3+nr/+Dp6v/h6On/4ujo/+Po6P/j6Of/AIEAfv8A2ezu/9js7v/Y7O7/1+zv/9fs8P/W7PH/1ezy/9Ts8//T7PT/0uz1/9Hs9v/Q7Pb/0Oz3/8/s9//P7Pf/0Oz3/9Ds9//R7Pb/0uz1/9Pr9P/V6/P/1uvx/9jr7//a6+7/3Ovs/93r6//f6+n/4Oro/+Lq5//j6ub/4+rl/+Pq5f8BgQB+/wDZ7uz/2e7t/9ju7f/Y7u7/1+7u/9bu7//V7vD/1O7x/9Pu8v/S7vP/0e70/9Dt9f/Q7fX/0O32/9Dt9v/Q7fX/0e31/9Ht9P/S7fP/1O3y/9Xt8f/X7O//2ezu/9rs7P/c7Ov/3uzp/9/s6P/h7Ob/4uvl/+Pr5P/k6+T/5Ovj/7OdKBn3Np6tAAAAAElFTkSuQmCC" width="1612" height="493" style="aspect-ratio:1612 / 493;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAJCAYAAABT2S4KAAAEvElEQVR4AQCBAH7/AOrn4v/q5+L/6efi/+nn4//o5+T/5+fl/+bn5v/l5+f/4+fo/+Lo6f/h6Or/4Ojr/+Do6//f6Oz/3+js/9/o7P/f6Ov/4Ojr/+Ho6v/i6On/4+jo/+To5v/m6OX/6Ojj/+no4f/r6OD/7Ojf/+7o3f/v6Nz/7+jb//Do2//w6Nr/AIEAfv8A6Obk/+jm5f/n5uX/5ubm/+bn5//l5+j/4+fp/+Ln6v/h5+v/4Ofs/9/n7f/e5+3/3efu/93n7v/d5+//3efu/93n7v/e5+3/3+ft/+Dn7P/h5+r/4ufp/+Tn5//m5+b/5+fk/+nn4//q5+H/7Ofg/+3n3//t597/7ufd/+7n3f8AgQB+/wDk5un/5Obp/+Pm6v/j5ur/4ubr/+Hm7P/g5u3/3ubu/93m7//c5vD/2+bx/9rm8v/a5vL/2ebz/9nn8//Z5/P/2ufz/9rn8v/b5/H/3Ofw/93m7//f5u3/4ebs/+Lm6v/k5un/5ebn/+fm5v/o5uT/6ebj/+rm4v/r5uL/6+bi/wCBAH7/AODl7v/f5e7/3+Xu/97m7//d5vD/3Obx/9vm8v/a5vP/2eb0/9jm9f/X5vb/1ub2/9bm9//V5vf/1eb3/9Xm9//W5vf/1ub2/9fm9f/Y5vT/2ubz/9vm8v/d5vD/3ubu/+Dm7f/i5uv/4+Xq/+Xl6f/m5ej/5+Xn/+fl5v/o5eb/AIEAfv8A3Obx/9zm8f/b5vH/2+by/9rm8//Z5vT/2Ob1/9fm9v/W5vf/1eb4/9Tm+f/T5vn/0ub6/9Lm+v/S5vr/0ub6/9Lm+v/T5vn/1Ob4/9Xm9//X5vb/2Ob0/9rm8//c5vH/3ebw/9/m7v/g5u3/4ubr/+Pm6v/k5en/5OXp/+Xl6f8AgQB+/wDa6PH/2ejx/9no8v/Y6PP/2Ojz/9fo9P/W6PX/1Oj2/9Po9//S6Pj/0uj5/9Ho+v/Q6Pr/0Oj7/9Do+//Q6Pv/0ej6/9Ho+v/S6Pn/1Oj4/9Xn9v/W5/X/2Ofz/9rn8v/c5/D/3efu/9/n7f/g5+z/4efr/+Ln6v/j5+n/4+fp/wCBAH7/ANnq8P/Y6vD/2Orx/9fq8f/X6vL/1urz/9Xq9P/U6vX/0+r2/9Lq9//R6vj/0Or4/9Dq+f/P6vn/z+r5/8/q+f/Q6vn/0er4/9Lq9//T6vb/1On1/9bp8//Y6fL/2unw/9vp7v/d6e3/3+nr/+Dp6v/h6On/4ujo/+Po6P/j6Of/AIEAfv8A2ezu/9js7v/Y7O7/1+zv/9fs8P/W7PH/1ezy/9Ts8//T7PT/0uz1/9Hs9v/Q7Pb/0Oz3/8/s9//P7Pf/0Oz3/9Ds9//R7Pb/0uz1/9Pr9P/V6/P/1uvx/9jr7//a6+7/3Ovs/93r6//f6+n/4Oro/+Lq5//j6ub/4+rl/+Pq5f8BgQB+/wDZ7uz/2e7t/9ju7f/Y7u7/1+7u/9bu7//V7vD/1O7x/9Pu8v/S7vP/0e70/9Dt9f/Q7fX/0O32/9Dt9v/Q7fX/0e31/9Ht9P/S7fP/1O3y/9Xt8f/X7O//2ezu/9rs7P/c7Ov/3uzp/9/s6P/h7Ob/4uvl/+Pr5P/k6+T/5Ovj/7OdKBn3Np6tAAAAAElFTkSuQmCC" data-src="/assets/image-20231216160422110.D2m6Dvfv.png" loading="lazy" alt="" width="1612" height="493" style="aspect-ratio:1612 / 493;"><!--]--><a class="VPNolebaseInlinePreviewLink" relative="" href="https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html" target="_blank" rel="noreferrer" data-v-0925c8fc=""><!--[-->B+树<!--]--><!----><!----></a></p><p>相对于B-Tree区别：</p><ul><li><p>所有的数据都会出现在叶子节点</p></li><li><p>叶子节点形成一个单向链表</p></li><li><p>MySQL索引数据结构对经典的B+Tree进行优化。在原B+Tree的基础上，增加一个指向相邻叶子节点的链表指针，就形成了带有顺序指针的B+Tree，提高区间访问的性能。</p></li></ul></li><li><p>Hash</p><p>哈希表索引就是采用一定的hash算法，将键值换算成新的hash值，映射到对应的槽位上，然后存储在hash表中。</p><p>如果两个（或多个）键值，映射到一个相同的槽位上，他们就产生了hash冲突（也称hash碰撞），可以通过链表来解决。</p><p>Hash索引的特点</p><ol><li>Hash索引只能用于对等比较（=，in)，不支持范围查询（between, >, &#x3C;, ...）</li><li>无法利用索引完成排序操作</li><li>查询效率高，通常只需要一次检索就可以了，效率通常要高于B+tree索引</li></ol><p>存储引擎支持</p><p>在MySQL中，支持hash索引的是Memory引擎，而InnoDB中具有自适应hash功能，hash索引是存储引擎根据B+Tree索引在指定条件下自动构建的。</p></li></ul><h3 id="索引分类" tabindex="-1">索引分类 <a class="header-anchor" href="#索引分类" aria-label="Permalink to &#x22;索引分类&#x22;">​</a></h3><table><thead><tr><th style="text-align:center;">分类</th><th style="text-align:center;">含义</th><th style="text-align:center;">特点</th><th style="text-align:center;">关键字</th></tr></thead><tbody><tr><td style="text-align:center;">主键索引</td><td style="text-align:center;">针对于表中主键创建的索引</td><td style="text-align:center;">默认自动创建，只能有一个</td><td style="text-align:center;">PRIMARY</td></tr><tr><td style="text-align:center;">唯一索引</td><td style="text-align:center;">避免同一个表中某数据列中的值重复</td><td style="text-align:center;">可以有多个</td><td style="text-align:center;">UNIQUE</td></tr><tr><td style="text-align:center;">常规索引</td><td style="text-align:center;">快速定位特定数据</td><td style="text-align:center;">可以有多个</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">全文索引</td><td style="text-align:center;">全文索引查找的是文本中的关键字，而不是比较索引中的值</td><td style="text-align:center;">可以有多个</td><td style="text-align:center;">FULLTEXT</td></tr></tbody></table><p>在InnoDB存储引擎中，根据索引的存储形式，又可以分为以下两种：</p><table><thead><tr><th style="text-align:center;">分类</th><th style="text-align:center;">含义</th><th style="text-align:center;">特点</th></tr></thead><tbody><tr><td style="text-align:center;">聚集索引（Clustered Index）</td><td style="text-align:center;">将数据存储与索引放到了一块，索引结构的叶子节点保存了行数据</td><td style="text-align:center;">必须有，而且只有一个</td></tr><tr><td style="text-align:center;">二级索引（Secondary Index）</td><td style="text-align:center;">将数据与索引分开存储，索引结构的叶子节点关联的是对应的主键</td><td style="text-align:center;">可以存在多个</td></tr></tbody></table><p>聚集索引选取规则：</p><ul><li>如果存在主键，主键索引就是聚集索引。</li><li>如果不存在主键，将使用第一个唯一索引（UNIQUE）索引作为聚集索引。</li><li>如果表没有主键，或没有合适的唯一索引，则InnoDB会自动生成一个rowid作为隐藏的聚集索引。</li></ul><h3 id="索引语法" tabindex="-1">索引语法 <a class="header-anchor" href="#索引语法" aria-label="Permalink to &#x22;索引语法&#x22;">​</a></h3><ul><li><p>创建索引</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>CREATE [UNIQUE|FULLTEXT] INDEX index_name ON table_name (index_col_name,...);</span></span></code></pre></div></li><li><p>查看索引</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>SHOW INDEX FROM table_name;</span></span></code></pre></div></li><li><p>删除索引</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>DROP INDEX index_name ON table_name;</span></span></code></pre></div></li></ul><h3 id="sql性能分析" tabindex="-1">SQL性能分析 <a class="header-anchor" href="#sql性能分析" aria-label="Permalink to &#x22;SQL性能分析&#x22;">​</a></h3><ul><li><p>SQL执行频率</p><p>MySQL客户端连接成功后，通过show [session|global] status命令可以提供服务器 状态信息。通过如下指令，可以查看当前数据库的INSERT、UPDATE、DELETE、SELECT的访问频次：</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>SHOW GLOBAL STATUS LIKE 'Com_______';</span></span></code></pre></div></li><li><p>慢查询日志</p><p>慢查询日志记录了所有执行时间超过指定参数（long_query_time,单位：秒，默认10秒）的所有SQL语句的日志。</p><p>MySQL的慢查询日志默认没有开启，需要在MySQL的配置文件（/etc/my.conf）中配置如下信息：</p><div class="language-config vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">config</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#开启MySQL慢日志开关</span></span>
<span class="line"><span>show_query_log=1</span></span>
<span class="line"><span>#设置慢日志的时间为2秒，SQL语句执行时间超过2秒，就会视为慢查询，记录慢查询日志</span></span>
<span class="line"><span>long_query_time=2</span></span></code></pre></div><p>配置完毕之后，通过以下指令重启MySQL服务器进行测试，查看慢日志文件中记录的信息/var/lib/mysql/localhost-show.log。</p></li><li><p>profile详情</p><p>show profile能够在做SQL优化时帮助我们了解时间都耗费到哪里去了。通过have_profiling参数，能够看到当前MySQL是否支持profile操作：</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>SELECT @@have_profiling;</span></span></code></pre></div><p>默认profile是关闭的，可以通过set语句在session/global级别开启profiling：</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>SET profiling=1;</span></span></code></pre></div><p>执行一系列的业务SQL操作，然后通过如下指令查看指令的执行耗时：</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#查看每一条SQL的耗时基本情况</span></span>
<span class="line"><span>show prifiles;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#查看指定query_id的SQL语句各个阶段的耗时情况</span></span>
<span class="line"><span>show profile for query query_id;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#查看指定query_id的SQL语句CPU的使用情况</span></span>
<span class="line"><span>show profile cpu for query query_id;</span></span></code></pre></div></li><li><p>explain执行计划</p><p>EXPLAIN或者DESC命令获取MySQL如何执行SELECT语句的信息，包括在SELECT语句执行过程中表如何连接和连接的顺序。</p><p>语法：</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># 直接在select语句之前加上关键字explain/desc</span></span>
<span class="line"><span>EXPLAIN SELECT 字段列表 FROM 表明 WHERE 条件;</span></span></code></pre></div><p>EXPLAIN执行计划各字段的含义：</p><ul><li><p>id</p><p>select 查询的序号，表示查询中执行select子句或者是操作表的顺序（id相同，执行顺序从上到下；id不同，值越大，越先执行）。</p></li><li><p>select_type</p><p>表示SELECT的类型，常见的取值有SIMPLE（简单表，即不使用表连接或者子查询）、PRIMARY（主查询，即外层的查询）、UNION（UNION中的第二个或者后面的查询语句）、SUBQUERY（SELECT/WHERE之后包含了子查询）等</p></li><li><p>type</p><p>表示连接类型，性能由好到差的连接类型为NULL、system、const、eq_ref、ref、range、index、all。</p></li><li><p>possible_key</p><p>显示可能应用在这张表的索引，一个或多个。</p></li><li><p>Key</p><p>实际使用的索引，如果为NULL，则没有使用索引。</p></li><li><p>Key_len</p><p>表示索引中使用的字节数，该值为索引字段最大可能长度，并非实际使用长度，在不损失精确性的前提下，长度越短越好。</p></li><li><p>rows</p><p>MySQL认为必须要执行查询的行数，在InnoDB引擎中的表中，是一个估计值，可能并不总是准确的。</p></li><li><p>filtered</p><p>查询返回结果的行数占读取行数的百分比，filtered的值越大越好。</p></li></ul></li></ul><h3 id="索引使用" tabindex="-1">索引使用 <a class="header-anchor" href="#索引使用" aria-label="Permalink to &#x22;索引使用&#x22;">​</a></h3><ul><li><p>验证索引效率</p><p>在未建立索引之前，执行如下SQL语句，查看SQL的耗时。</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>SELECT * FROM tb_sku WHERE sn='10000003145001';</span></span></code></pre></div><p>针对字段创建索引</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>create index idx_sn on tb_sku(sn);</span></span></code></pre></div><p>然后再次执行相同的SQL语句，再次查看SQL的耗时。</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>SELECT * FROM tb_sku WHERE sn='10000003145001';</span></span></code></pre></div></li><li><p>最左前缀法则</p><p>如果索引了多列（联合索引），要遵守最左前缀法则。最左前缀法则指的是查询从索引的 最左列开始，并且不跳过索引中的列。</p><p>如果跳跃某一列，<strong>索引将部分失效（后面的字段索引失效）</strong></p></li><li><p>范围查询</p><p>联合索引中，出现范围查询(>,&#x3C;)，<strong>范围查询右侧的列索引失效</strong></p></li><li><p>索引列运算</p><p>不要在索引列上进行运算操作，<strong>索引将失效</strong>。</p></li><li><p>字符串不加引号</p><p>字符串类型字段使用时，不加引号，<strong>索引将失效</strong>。</p></li><li><p>模糊查询</p><p>如果仅仅是尾部模糊匹配，索引不会失效。如果是头部模糊匹配，索引失效。</p></li><li><p>or连接的条件</p><p>用or分割开的条件，如果or前的条件中的所有列有索引，而后面的列中没有索引，那么涉及的索引都不会被用到。</p></li><li><p>数据分布影响</p><p>如果MySQL评估使用索引比全表更慢，则不使用索引。</p></li><li><p>SQL提示</p><p>SQL提示，是优化数据库的一个重要手段，简单来说，就是在SQL语句中加入一些人为的提示来达到优化操作的目的。</p><p>use index:</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>explain select * from table_name use index(index_name) where &#x3C;条件>;</span></span></code></pre></div><p>ignore index:</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>explain select * from table_name ignore index(index_name) where &#x3C;条件>;</span></span></code></pre></div><p>force index:</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>explain select * from table_name force index(index_name) where &#x3C;条件>;</span></span></code></pre></div></li><li><p>覆盖索引</p><p>尽量使用覆盖索引（查询使用了索引，并且需要返回的列，在该索引中已经全部能够找到），减少select *。</p><div class="language-tex vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">using index condition : 查找使用了索引，但是需要回表查询</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">using where;using index : 查找使用了索引，但是需要的数据都在索引列中能找到，所以不需要回表查询数据</span></span></code></pre></div><p><!--[--><img class="nolebase-enhanced-img absolute inset-0 z-1 bg-black/10" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAOCAYAAABO3B6yAAAHWklEQVR4AQCBAH7/AMWagf/JnoX/z6WN/9etl//ft6H/5r+r/+vGtP/uy7v/787A//DRxf/x1cr/89jQ//bd1//5497//Ojl///s6v//7u3//u7u//vs7f/26er/8uXm/+3h4v/q3+D/6t7f/+vf3//t4uH/8ebl//Xq6P/57uv//PHu//7z8P//9PH/AIEAfv8Axp2E/8mhiP/QqJD/17GZ/9+6pP/mwq7/68m2/+7Ovf/w0cP/8NTH//HXzP/z29L/9uDZ//nl3//86ub//u7r///w7v/+8O//+u7u//br6//x5ub/7ePj/+rg4P/p4N//6uHf/+zj4f/w5+T/9Ovo//jv6//78u7//fTw//718f8AgQB+/wDHpIn/y6iO/9Gvlf/Zt5//4MCp/+fJs//sz7v/79TC//DXx//x2sv/8tzQ//Pg1v/15Nz/+Oni//zu6P/+8u3//vTw//308f/58e//9e7s//Dp6P/s5uT/6ePh/+ji3//o4+D/6+Xh/+7p5P/y7ej/9vDr//nz7f/79e///Pbw/wCBAH7/AMmtkf/NsZX/07id/9rApv/iybD/6dG6/+7Xwv/w3Mj/8d/N//Lh0f/y49X/8+ba//Xq4P/47+b/+/Ps//338P/9+PP//Pjz//j28f/08u7/7+3p/+rp5f/n5uL/5uXg/+fm4P/p6OL/7ezk//Hv5//08+r/9/Xt//n37v/6+O//AIEAfv8AzLea/8+7nv/Vwqb/3cqv/+XTuf/r28L/8OHK//Ll0P/z59T/8+nY//Pr2//07uD/9vHl//j16//7+fD//Pz0//3+9v/7/fb/+Pr0//P28P/u8uv/6u3m/+bq4//l6eH/5urh/+js4v/r7+X/7/Ln//L16v/1+Oz/9/ru//j77/8AgQB+/wDPwqT/0sao/9jMsP/g1Ln/593D/+7ky//y6tP/9O7Y//Xw3P/08d//9PLi//X15v/2+Or/+Pvv//v/9P/8//j//P/6//v/+f/3//b/8/ry/+727f/p8ej/5u7l/+Xt4//m7eL/6O/j/+vy5f/u9ej/8vjq//T67P/2/O7/9/3u/wCBAH7/ANPMr//Wz7P/3Na6/+Pew//r5sz/8e3V//Xz3P/39uD/9/fk//b45v/2+en/9vvs//f98P/5//T/+//4//z//P/8//3/+//8//f/+f/z/vX/7vnw/+r16//n8ef/5vDl/+bw5P/p8uX/7PTn/+/36f/y+uv/9f3t//f+7v/4/+//AIEAfv8A19S5/9rYvf/g3sT/5+bN/+/u1v/09d7/+Prk//r86f/6/uv/+f7t//j+7//3//H/+P/1//r/+f/8//z//f////3////8////+P/8//T/9//v+/L/6/ft/+n06f/o8uf/6PLm/+v05//u9+n/8frr//X87f/3/+//+f/w//r/8P8AgQB+/wDb28P/397G/+Tkzf/s7Nb/8/Te//j65v/8/+z//f/w//z/8v/7//P/+v/1//n/9v/6//n/+//8//3////+/////v////3////6//7/9v/6//H89f/u+PD/6/Xs/+v06f/s9On/7vbp//H46//1++3/+P7v//v/8f/9//L//f/y/wCBAH7/AODfy//j48//6enV//Dw3v/2+Ob//P7t////8/////b////4//7/+f/8//n/+//7//v//f/9/////v////////////////////z////4//z/9Pz3//H48v/v9u7/7vTs//D16//y9+z/9vnu//n88P/9//L////z////9P////X/AIEAfv8A5OLS/+fl1f/s69z/8/Pk//r67P////P////4////+/////z////9//7//f/9//7//f////7//////////////////////////v////v//v/3/Pn/9Pj0//L18f/y9O7/9PXu//f37//7+vD//vzy////9P////b////3////9/8AgQB+/wDn5Nf/6ufa//Dt4f/29On//fvx////+P////z//////////////////////////////////////////////////////////////////f////r7+v/39/b/9vXy//b08P/49fD/+/fx///68////fX////3////+P////n////6/wCBAH7/AOnk2v/s6N7/8u3k//n17P///PT////7/////////////////////////////////////////////////////////////////////////v///Pr8//r29//59PT/+fPy//v08v/+9/P///n0///99/////n////6////+/////z/AYEAfv8A6uXc/+7o3//z7ub/+vXu///89f////z////////////////////////////////////////////////////////////////////////9///9+fz/+/b4//r09f/78/P//fTz///29P//+fX///34////+v////v////8/////f9b6ZzLNhFisAAAAABJRU5ErkJggg==" width="1527" height="678" style="aspect-ratio:1527 / 678;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAOCAYAAABO3B6yAAAHWklEQVR4AQCBAH7/AMWagf/JnoX/z6WN/9etl//ft6H/5r+r/+vGtP/uy7v/787A//DRxf/x1cr/89jQ//bd1//5497//Ojl///s6v//7u3//u7u//vs7f/26er/8uXm/+3h4v/q3+D/6t7f/+vf3//t4uH/8ebl//Xq6P/57uv//PHu//7z8P//9PH/AIEAfv8Axp2E/8mhiP/QqJD/17GZ/9+6pP/mwq7/68m2/+7Ovf/w0cP/8NTH//HXzP/z29L/9uDZ//nl3//86ub//u7r///w7v/+8O//+u7u//br6//x5ub/7ePj/+rg4P/p4N//6uHf/+zj4f/w5+T/9Ovo//jv6//78u7//fTw//718f8AgQB+/wDHpIn/y6iO/9Gvlf/Zt5//4MCp/+fJs//sz7v/79TC//DXx//x2sv/8tzQ//Pg1v/15Nz/+Oni//zu6P/+8u3//vTw//308f/58e//9e7s//Dp6P/s5uT/6ePh/+ji3//o4+D/6+Xh/+7p5P/y7ej/9vDr//nz7f/79e///Pbw/wCBAH7/AMmtkf/NsZX/07id/9rApv/iybD/6dG6/+7Xwv/w3Mj/8d/N//Lh0f/y49X/8+ba//Xq4P/47+b/+/Ps//338P/9+PP//Pjz//j28f/08u7/7+3p/+rp5f/n5uL/5uXg/+fm4P/p6OL/7ezk//Hv5//08+r/9/Xt//n37v/6+O//AIEAfv8AzLea/8+7nv/Vwqb/3cqv/+XTuf/r28L/8OHK//Ll0P/z59T/8+nY//Pr2//07uD/9vHl//j16//7+fD//Pz0//3+9v/7/fb/+Pr0//P28P/u8uv/6u3m/+bq4//l6eH/5urh/+js4v/r7+X/7/Ln//L16v/1+Oz/9/ru//j77/8AgQB+/wDPwqT/0sao/9jMsP/g1Ln/593D/+7ky//y6tP/9O7Y//Xw3P/08d//9PLi//X15v/2+Or/+Pvv//v/9P/8//j//P/6//v/+f/3//b/8/ry/+727f/p8ej/5u7l/+Xt4//m7eL/6O/j/+vy5f/u9ej/8vjq//T67P/2/O7/9/3u/wCBAH7/ANPMr//Wz7P/3Na6/+Pew//r5sz/8e3V//Xz3P/39uD/9/fk//b45v/2+en/9vvs//f98P/5//T/+//4//z//P/8//3/+//8//f/+f/z/vX/7vnw/+r16//n8ef/5vDl/+bw5P/p8uX/7PTn/+/36f/y+uv/9f3t//f+7v/4/+//AIEAfv8A19S5/9rYvf/g3sT/5+bN/+/u1v/09d7/+Prk//r86f/6/uv/+f7t//j+7//3//H/+P/1//r/+f/8//z//f////3////8////+P/8//T/9//v+/L/6/ft/+n06f/o8uf/6PLm/+v05//u9+n/8frr//X87f/3/+//+f/w//r/8P8AgQB+/wDb28P/397G/+Tkzf/s7Nb/8/Te//j65v/8/+z//f/w//z/8v/7//P/+v/1//n/9v/6//n/+//8//3////+/////v////3////6//7/9v/6//H89f/u+PD/6/Xs/+v06f/s9On/7vbp//H46//1++3/+P7v//v/8f/9//L//f/y/wCBAH7/AODfy//j48//6enV//Dw3v/2+Ob//P7t////8/////b////4//7/+f/8//n/+//7//v//f/9/////v////////////////////z////4//z/9Pz3//H48v/v9u7/7vTs//D16//y9+z/9vnu//n88P/9//L////z////9P////X/AIEAfv8A5OLS/+fl1f/s69z/8/Pk//r67P////P////4////+/////z////9//7//f/9//7//f////7//////////////////////////v////v//v/3/Pn/9Pj0//L18f/y9O7/9PXu//f37//7+vD//vzy////9P////b////3////9/8AgQB+/wDn5Nf/6ufa//Dt4f/29On//fvx////+P////z//////////////////////////////////////////////////////////////////f////r7+v/39/b/9vXy//b08P/49fD/+/fx///68////fX////3////+P////n////6/wCBAH7/AOnk2v/s6N7/8u3k//n17P///PT////7/////////////////////////////////////////////////////////////////////////v///Pr8//r29//59PT/+fPy//v08v/+9/P///n0///99/////n////6////+/////z/AYEAfv8A6uXc/+7o3//z7ub/+vXu///89f////z////////////////////////////////////////////////////////////////////////9///9+fz/+/b4//r09f/78/P//fTz///29P//+fX///34////+v////v////8/////f9b6ZzLNhFisAAAAABJRU5ErkJggg==" data-src="/assets/image-20231219152549915.BH4gnev_.png" loading="lazy" alt="" width="1527" height="678" style="aspect-ratio:1527 / 678;"><!--]--></p><p><!--[--><img class="nolebase-enhanced-img absolute inset-0 z-1 bg-black/10" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAOCAYAAABO3B6yAAAHWklEQVR4AQCBAH7/ANGmlv/SqZn/1q2d/9qyo//fuKr/5L6y/+jEuf/sy8H/8NDI//TW0P/43df//OPf///q5///8O////b2///7/P///v/////////+////+/////j8//v0+P/38fX/9O/z//Lu8v/y7/L/9PHz//bz9v/59vj/+/n7//37/f/+/P7/AIEAfv8A0amY/9Ormv/Wr5//2rSl/9+6rP/kwLP/6Ma6/+zMwf/w0sj/89jP//fd1//75N///+rm///w7v//9vX///r6///9/v///v////7////7/f/++Pr/+vX3//by9P/z8PH/8e/w//Lw8f/z8fL/9fT1//j3+P/7+vr//fz8//79/f8AgQB+/wDSr5v/1LGe/9e0ov/buaf/37+u/+TFtf/oyrz/69DC/+7Vyf/x2s//9d/W//jl3f/86+X///Hs///28v//+vj///37///+/f///fz///v6//v49//39fT/8/Lx//Hw7//w8O//8PHv//Lz8f/09fP/9/n2//r8+f/8/vv//f/8/wCBAH7/ANS2oP/WuKL/2Lum/9zAq//gxbL/5Mq4/+jPvv/q1MT/7djK//Dd0P/y4tb/9efc//js4//88en///bv///69P///fj///75///9+f/8+/f/+Pj0//T18f/w8u7/7vHt/+7x7P/u8u3/8PTv//P38v/2+/X/+f73//v/+f/8//v/AIEAfv8A1r+m/9jAqP/axKz/3six/+HNtv/l0bz/6NbC/+rZx//s3cz/7uHR//Dl1v/y6dz/9e3h//jy5//69+3//Prx//399P/9/fX/+/31//j78//0+PH/8PXu/+7z6//s8ur/7PLq/+3z6//v9u3/8vnw//X98//4//b/+//4//z/+f8AgQB+/wDZyK3/2smv/93Ms//g0Lf/49S8/+bYwf/p3Mb/6t/L/+viz//t5dP/7ujX//Dr3P/y7+H/9PPm//f36//4+u//+f3y//n98//3/PL/9Pvx//H47v/u9uv/6/Tp/+rz6P/q8+j/7PXp/+746//y++7/9f/y//j/9P/7//f//P/4/wCBAH7/ANzQtf/e0rf/4NW6/+PYv//m3MP/6N/I/+rjzP/r5dD/7OfT/+3p1v/t69r/7+7e//Dx4v/y9eb/9Pjr//b77v/3/fH/9v3x//X98f/y++//7/nt/+326v/q9ej/6vTn/+r05//s9uj/7/nr//L87v/2//H/+f/0//v/9v/9//f/AIEAfv8A4Ni+/+HZv//k3MP/5t/G/+njy//r5s//7enS/+3q1v/u7Nj/7u3b/+7v3v/v8eH/8PTk//L36P/0+uz/9fzv//b+8f/1/vL/9P3x//L77//v+e3/7ffq/+v16P/q9ef/6/Xn/+336f/w+uv/8/3u//f/8f/6//T//f/2//7/9/8AgQB+/wDk3sb/5eDI/+fiy//q5c//7enT/+/r1v/w7tr/8O/c//Dw3v/w8eD/8PLj//D05f/x9uj/8/ns//X77//2/fL/9//z//b/9P/1/vP/8/zx//H67//v+Oz/7fbq/+z26f/t9un/7/jq//L77P/2/u//+f/y//3/9P////f////4/wCBAH7/AOjjzv/p5ND/6+fT/+7q1v/w7dr/8vDe//Ty4f/08+P/9PTl//P05//z9ej/8/br//T47f/2+/D/9/3z//n/9v/5//f/+f/3//j/9v/2/fT/9Pvy//H57//w9+3/8Pbr//D36//y+Oz/9fvu//n+8f/8//P////2////+P////n/AIEAfv8A7OfV/+3o1//v6tr/8u3d//Tx4f/28+X/9/Xn//j26v/39+v/9/ft//b47v/3+fD/+Prz//n89f/6/vj//P/6//3/+//8//v/+//6//n++P/3/PX/9fny//T48P/z9+7/9Pfu//b47//4+/D//P7z////9f////f////5////+v8AgQB+/wDv6dv/8Ord//Lt4P/18OP/9/Pn//n16v/79+3/+/jv//v58f/6+fL/+vrz//r79f/7/Pf//P76//7//P////7///////////////7//f/8//v9+f/5+vb/9/jz//f38f/39/H/+fjx//z68////fX////3////+f////v////8/wCBAH7/APHq3//y6+H/9O7k//fx5//69Ov//Pfv//358f/9+vP//fr1//379v/9+/f//fz5//79+/////7//////////////////////////////////v38//z7+f/6+fb/+ff0//r38//8+PP//vr0///99v////j////6/////P////3/AYEAfv8A8uvh//Ps4//17+b/+PLp//v17f/99/H//vnz///79v//+/f//vv4//78+f/+/Pv///79/////////////////////////////////////////v3//fv6//z59//79/X/+/f0//349P//+vX///z3////+f////v////9/////f/GCJ9FAT/O2gAAAABJRU5ErkJggg==" width="1529" height="682" style="aspect-ratio:1529 / 682;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAOCAYAAABO3B6yAAAHWklEQVR4AQCBAH7/ANGmlv/SqZn/1q2d/9qyo//fuKr/5L6y/+jEuf/sy8H/8NDI//TW0P/43df//OPf///q5///8O////b2///7/P///v/////////+////+/////j8//v0+P/38fX/9O/z//Lu8v/y7/L/9PHz//bz9v/59vj/+/n7//37/f/+/P7/AIEAfv8A0amY/9Ormv/Wr5//2rSl/9+6rP/kwLP/6Ma6/+zMwf/w0sj/89jP//fd1//75N///+rm///w7v//9vX///r6///9/v///v////7////7/f/++Pr/+vX3//by9P/z8PH/8e/w//Lw8f/z8fL/9fT1//j3+P/7+vr//fz8//79/f8AgQB+/wDSr5v/1LGe/9e0ov/buaf/37+u/+TFtf/oyrz/69DC/+7Vyf/x2s//9d/W//jl3f/86+X///Hs///28v//+vj///37///+/f///fz///v6//v49//39fT/8/Lx//Hw7//w8O//8PHv//Lz8f/09fP/9/n2//r8+f/8/vv//f/8/wCBAH7/ANS2oP/WuKL/2Lum/9zAq//gxbL/5Mq4/+jPvv/q1MT/7djK//Dd0P/y4tb/9efc//js4//88en///bv///69P///fj///75///9+f/8+/f/+Pj0//T18f/w8u7/7vHt/+7x7P/u8u3/8PTv//P38v/2+/X/+f73//v/+f/8//v/AIEAfv8A1r+m/9jAqP/axKz/3six/+HNtv/l0bz/6NbC/+rZx//s3cz/7uHR//Dl1v/y6dz/9e3h//jy5//69+3//Prx//399P/9/fX/+/31//j78//0+PH/8PXu/+7z6//s8ur/7PLq/+3z6//v9u3/8vnw//X98//4//b/+//4//z/+f8AgQB+/wDZyK3/2smv/93Ms//g0Lf/49S8/+bYwf/p3Mb/6t/L/+viz//t5dP/7ujX//Dr3P/y7+H/9PPm//f36//4+u//+f3y//n98//3/PL/9Pvx//H47v/u9uv/6/Tp/+rz6P/q8+j/7PXp/+746//y++7/9f/y//j/9P/7//f//P/4/wCBAH7/ANzQtf/e0rf/4NW6/+PYv//m3MP/6N/I/+rjzP/r5dD/7OfT/+3p1v/t69r/7+7e//Dx4v/y9eb/9Pjr//b77v/3/fH/9v3x//X98f/y++//7/nt/+326v/q9ej/6vTn/+r05//s9uj/7/nr//L87v/2//H/+f/0//v/9v/9//f/AIEAfv8A4Ni+/+HZv//k3MP/5t/G/+njy//r5s//7enS/+3q1v/u7Nj/7u3b/+7v3v/v8eH/8PTk//L36P/0+uz/9fzv//b+8f/1/vL/9P3x//L77//v+e3/7ffq/+v16P/q9ef/6/Xn/+336f/w+uv/8/3u//f/8f/6//T//f/2//7/9/8AgQB+/wDk3sb/5eDI/+fiy//q5c//7enT/+/r1v/w7tr/8O/c//Dw3v/w8eD/8PLj//D05f/x9uj/8/ns//X77//2/fL/9//z//b/9P/1/vP/8/zx//H67//v+Oz/7fbq/+z26f/t9un/7/jq//L77P/2/u//+f/y//3/9P////f////4/wCBAH7/AOjjzv/p5ND/6+fT/+7q1v/w7dr/8vDe//Ty4f/08+P/9PTl//P05//z9ej/8/br//T47f/2+/D/9/3z//n/9v/5//f/+f/3//j/9v/2/fT/9Pvy//H57//w9+3/8Pbr//D36//y+Oz/9fvu//n+8f/8//P////2////+P////n/AIEAfv8A7OfV/+3o1//v6tr/8u3d//Tx4f/28+X/9/Xn//j26v/39+v/9/ft//b47v/3+fD/+Prz//n89f/6/vj//P/6//3/+//8//v/+//6//n++P/3/PX/9fny//T48P/z9+7/9Pfu//b47//4+/D//P7z////9f////f////5////+v8AgQB+/wDv6dv/8Ord//Lt4P/18OP/9/Pn//n16v/79+3/+/jv//v58f/6+fL/+vrz//r79f/7/Pf//P76//7//P////7///////////////7//f/8//v9+f/5+vb/9/jz//f38f/39/H/+fjx//z68////fX////3////+f////v////8/wCBAH7/APHq3//y6+H/9O7k//fx5//69Ov//Pfv//358f/9+vP//fr1//379v/9+/f//fz5//79+/////7//////////////////////////////////v38//z7+f/6+fb/+ff0//r38//8+PP//vr0///99v////j////6/////P////3/AYEAfv8A8uvh//Ps4//17+b/+PLp//v17f/99/H//vnz///79v//+/f//vv4//78+f/+/Pv///79/////////////////////////////////////////v3//fv6//z59//79/X/+/f0//349P//+vX///z3////+f////v////9/////f/GCJ9FAT/O2gAAAABJRU5ErkJggg==" data-src="/assets/image-20231219152708308.headAhwB.png" loading="lazy" alt="" width="1529" height="682" style="aspect-ratio:1529 / 682;"><!--]--></p><p><!--[--><img class="nolebase-enhanced-img absolute inset-0 z-1 bg-black/10" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAOCAYAAABO3B6yAAAHWklEQVR4AQCBAH7/AM6slP/PrZb/0K+Y/9Kxm//TtJ//1Laj/9a5p//YvKz/2sGy/97Huv/kzsP/6tbN//Lf2P/46OL//e7q///z8P//9fP//vTy//rx8P/17ez/8Onp/+3m5v/r5eT/6+Xk/+zm5f/t6Ob/7unn/+/q5//v6uf/7unm/+3p5f/t6OT/AIEAfv8A0bGZ/9Gymv/Ts5z/1Laf/9W4o//Wuqb/2L2r/9nAr//cxLX/38q9/+XRxf/r2c//8uHa//jp4//98Ov///Tx///28//+9fP/+vLx//Xu7f/w6un/7efm/+vm5f/r5uX/7Ojm/+3p5//u6+j/7+vo/+/r6P/u6+b/7erl/+3p5f8AgQB+/wDVuaD/1rqi/9e8pP/Yvqf/2cCq/9rCrf/bxLH/3Me2/97Ku//hz8L/5tbK/+zd0//y5d3/+O3m//3z7f//9/L///j1//339P/59PL/9PDu//Ds6v/t6uj/6+nm/+vp5v/s6uf/7uzo/+/t6f/v7un/7+7p/+7t5//u7Ob/7ezm/wCBAH7/ANvEq//bxaz/3Mau/93Isf/eyrT/38y3/9/Ouv/g0L7/4tPC/+TXyP/o3ND/7ePY//Pq4f/58en//ffw///69f//+/b//Pr2//j38//z8+//7+/s/+zt6f/r7Oj/6+zo/+zt6P/u7+r/7/Hq//Dx6v/w8er/7/Dp/+7v5//t7ub/AIEAfv8A4dC3/+LRuP/i0rr/49S8/+TVv//k18H/5NjE/+Xax//l3Mv/59/Q/+vk1v/v6t7/9PDm//n27f/8+/P//v73//7++P/7/ff/9/n0//P18f/v8u3/7PDq/+vv6f/s7+n/7fHq/+/y6//w9Oz/8fTs//D06//v8+n/7vLo/+3x5/8AgQB+/wDn3ML/59zD/+jexf/p38j/6uHK/+rizP/q4s7/6ePR/+nl1P/r59j/7evd//Hw5P/19er/+frx//z+9v/+//n//f/6//r/+f/3/Pb/8vjy/+/07v/s8uz/7PLq/+zy6v/u9Ov/7/Xs//H27P/x9uz/8fbr/+/06f/u8+j/7fLn/wCBAH7/AOzlzf/s5s7/7efQ/+7p0v/v6tT/7+vW/+7r2P/t69n/7ezc/+7u3//w8eP/8/Xp//b57//6/vT//P/5//3/+//8//z/+v/6//b99//y+fP/7/bv/+307P/s8+v/7fTr/+/17P/w9+z/8ffs//L37P/x9ur/7/Xo/+7z5v/t8uX/AIEAfv8A7+zV//Dt1v/x7tj/8vDa//Lx3P/y8d7/8vLf//Hy4f/w8uL/8PPl//L16f/0+e3/9/zy//r/9//9//v//f/9//z//f/6//v/9v73//P68//v9+//7vXt/+306//u9ev/8Pbr//H37P/y9+v/8vfq//H16P/v8+b/7vLk/+3x4v8AgQB+/wDx8Nr/8vHc//Py3f/08+D/9fXi//X15P/09eX/8/Xm//P15//z9ur/9Pjt//b68f/4/vX/+//5//3//P/+//7//f/9//r/+//3/ff/8/rz//D27//v9O3/7vTr/+/06//x9ev/8vbq//P26v/y9ej/8fPl/+/w4v/t7uD/7O3f/wCBAH7/APHw3f/y8d//9PPh//X14//29uX/9vfn//b36P/19+n/9Pfr//T37P/1+e//9/vz//n+9//8//r//v/9//7//v/9//3/+//7//j89//0+PP/8vXv//Dz7P/w8ur/8fLp//Lz6f/z8+j/8/Pn//Lx5f/w7+L/7uze/+zq3P/r6Nr/AIEAfv8A8e/e//Lw4P/z8uL/9fTk//b15//29un/9vfq//b26//19u3/9ffu//b48f/4+vT/+v33//3/+//+//3////+//7//f/8/vr/+fr2//X38v/z8+7/8fHr//Hw6f/y8Oj/8/Dn//Tw5v/07+T/8u3h//Dq3v/t59r/6+XX/+rj1f8AgQB+/wDv7d7/8O7f//Lv4v/08uT/9fPn//b16f/29ev/9vXs//b17f/29u//9/fx//j59P/7+/j//f77/////f////7////9//38+v/6+Pb/9/Xx//Tx7f/z7+r/8u7o//Pt5//07eX/9O3k//Ts4v/y6d7/8Oba/+3j1v/q4NP/6N7R/wCBAH7/AO7q3f/v69//8e3h//Pv5P/18ef/9vPp//b06//29Oz/9vTt//b07//39vH/+fj0//v6+P/+/Pv///79///+/f///fz//fr5//r39f/38/H/9fDt//Tt6f/z7Of/9Ovl//Xr5P/16uL/9Ong//Lm3P/v49j/7N/T/+nc0P/o2s7/AYEAfv8A7end/+7q3v/w7OH/8u7k//Tw5v/18un/9vPr//bz7P/28+3/9vTv//f18f/59/T/+/n4//78+v///f3///79///8/P/++vn/+/b1//jy8P/27+z/9Ozp//Tr5//06uX/9erj//Xp4f/0597/8uTb/+/h1v/s3dL/6drO/+fYzP9vX4wls/X+/wAAAABJRU5ErkJggg==" width="1518" height="714" style="aspect-ratio:1518 / 714;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAOCAYAAABO3B6yAAAHWklEQVR4AQCBAH7/AM6slP/PrZb/0K+Y/9Kxm//TtJ//1Laj/9a5p//YvKz/2sGy/97Huv/kzsP/6tbN//Lf2P/46OL//e7q///z8P//9fP//vTy//rx8P/17ez/8Onp/+3m5v/r5eT/6+Xk/+zm5f/t6Ob/7unn/+/q5//v6uf/7unm/+3p5f/t6OT/AIEAfv8A0bGZ/9Gymv/Ts5z/1Laf/9W4o//Wuqb/2L2r/9nAr//cxLX/38q9/+XRxf/r2c//8uHa//jp4//98Ov///Tx///28//+9fP/+vLx//Xu7f/w6un/7efm/+vm5f/r5uX/7Ojm/+3p5//u6+j/7+vo/+/r6P/u6+b/7erl/+3p5f8AgQB+/wDVuaD/1rqi/9e8pP/Yvqf/2cCq/9rCrf/bxLH/3Me2/97Ku//hz8L/5tbK/+zd0//y5d3/+O3m//3z7f//9/L///j1//339P/59PL/9PDu//Ds6v/t6uj/6+nm/+vp5v/s6uf/7uzo/+/t6f/v7un/7+7p/+7t5//u7Ob/7ezm/wCBAH7/ANvEq//bxaz/3Mau/93Isf/eyrT/38y3/9/Ouv/g0L7/4tPC/+TXyP/o3ND/7ePY//Pq4f/58en//ffw///69f//+/b//Pr2//j38//z8+//7+/s/+zt6f/r7Oj/6+zo/+zt6P/u7+r/7/Hq//Dx6v/w8er/7/Dp/+7v5//t7ub/AIEAfv8A4dC3/+LRuP/i0rr/49S8/+TVv//k18H/5NjE/+Xax//l3Mv/59/Q/+vk1v/v6t7/9PDm//n27f/8+/P//v73//7++P/7/ff/9/n0//P18f/v8u3/7PDq/+vv6f/s7+n/7fHq/+/y6//w9Oz/8fTs//D06//v8+n/7vLo/+3x5/8AgQB+/wDn3ML/59zD/+jexf/p38j/6uHK/+rizP/q4s7/6ePR/+nl1P/r59j/7evd//Hw5P/19er/+frx//z+9v/+//n//f/6//r/+f/3/Pb/8vjy/+/07v/s8uz/7PLq/+zy6v/u9Ov/7/Xs//H27P/x9uz/8fbr/+/06f/u8+j/7fLn/wCBAH7/AOzlzf/s5s7/7efQ/+7p0v/v6tT/7+vW/+7r2P/t69n/7ezc/+7u3//w8eP/8/Xp//b57//6/vT//P/5//3/+//8//z/+v/6//b99//y+fP/7/bv/+307P/s8+v/7fTr/+/17P/w9+z/8ffs//L37P/x9ur/7/Xo/+7z5v/t8uX/AIEAfv8A7+zV//Dt1v/x7tj/8vDa//Lx3P/y8d7/8vLf//Hy4f/w8uL/8PPl//L16f/0+e3/9/zy//r/9//9//v//f/9//z//f/6//v/9v73//P68//v9+//7vXt/+306//u9ev/8Pbr//H37P/y9+v/8vfq//H16P/v8+b/7vLk/+3x4v8AgQB+/wDx8Nr/8vHc//Py3f/08+D/9fXi//X15P/09eX/8/Xm//P15//z9ur/9Pjt//b68f/4/vX/+//5//3//P/+//7//f/9//r/+//3/ff/8/rz//D27//v9O3/7vTr/+/06//x9ev/8vbq//P26v/y9ej/8fPl/+/w4v/t7uD/7O3f/wCBAH7/APHw3f/y8d//9PPh//X14//29uX/9vfn//b36P/19+n/9Pfr//T37P/1+e//9/vz//n+9//8//r//v/9//7//v/9//3/+//7//j89//0+PP/8vXv//Dz7P/w8ur/8fLp//Lz6f/z8+j/8/Pn//Lx5f/w7+L/7uze/+zq3P/r6Nr/AIEAfv8A8e/e//Lw4P/z8uL/9fTk//b15//29un/9vfq//b26//19u3/9ffu//b48f/4+vT/+v33//3/+//+//3////+//7//f/8/vr/+fr2//X38v/z8+7/8fHr//Hw6f/y8Oj/8/Dn//Tw5v/07+T/8u3h//Dq3v/t59r/6+XX/+rj1f8AgQB+/wDv7d7/8O7f//Lv4v/08uT/9fPn//b16f/29ev/9vXs//b17f/29u//9/fx//j59P/7+/j//f77/////f////7////9//38+v/6+Pb/9/Xx//Tx7f/z7+r/8u7o//Pt5//07eX/9O3k//Ts4v/y6d7/8Oba/+3j1v/q4NP/6N7R/wCBAH7/AO7q3f/v69//8e3h//Pv5P/18ef/9vPp//b06//29Oz/9vTt//b07//39vH/+fj0//v6+P/+/Pv///79///+/f///fz//fr5//r39f/38/H/9fDt//Tt6f/z7Of/9Ovl//Xr5P/16uL/9Ong//Lm3P/v49j/7N/T/+nc0P/o2s7/AYEAfv8A7end/+7q3v/w7OH/8u7k//Tw5v/18un/9vPr//bz7P/28+3/9vTv//f18f/59/T/+/n4//78+v///f3///79///8/P/++vn/+/b1//jy8P/27+z/9Ozp//Tr5//06uX/9erj//Xp4f/0597/8uTb/+/h1v/s3dL/6drO/+fYzP9vX4wls/X+/wAAAABJRU5ErkJggg==" data-src="/assets/image-20231219152824751.1_4dj3TH.png" loading="lazy" alt="" width="1518" height="714" style="aspect-ratio:1518 / 714;"><!--]--></p></li><li><p>前缀索引</p><p>当字段类型为字符串（varchar，text等）时，有时候需要索引很长的字符串，这会让索引变得很大，查询时，浪费大量的磁盘IO，影响查询。此时可以只将字符串的一部分前缀，建立索引，这样可以大大节约索引空间，从而提高索引效率。</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># 语法</span></span>
<span class="line"><span>create index idx_xxxx on table_name(column(n));</span></span>
<span class="line"><span># n为字符数</span></span></code></pre></div><p>前缀长度</p><p>可以根据索引的选择性来决定，而选择性是指不重复的索引值，索引选择性越高则查询效率越高，唯一索引的选择性是1，这是最好的索引选择性，性能也是最好的。</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>select count(distinct email)/count(*) from tb_user;</span></span>
<span class="line"><span>select count(distinct substring(email,1,5))/count(*) from tb_user;</span></span></code></pre></div><p><!--[--><img class="nolebase-enhanced-img absolute inset-0 z-1 bg-black/10" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAASCAYAAAA6yNxSAAAJcklEQVR4AQCBAH7/APPv9f/z7/X/8+/1//Pv9f/z7/X/8+/1//Pv9v/z7/b/8u72//Lu9v/y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vb/8+/2//Pv9f/z7/X/8+/0//Tw9P/08PP/9PDz//Xx8v/18fH/9fHx//Xx8P/28vD/9vLw//by7//28u//AIEAfv8A8+/1//Pv9f/z7/X/8+/1//Pv9f/z7/b/8+/2//Pu9v/y7vb/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9v/z7/b/8+/2//Pv9f/z7/T/9PD0//Tw8//08PP/9fHy//Xx8f/18fH/9fHw//by8P/28vD/9vLv//by7/8AgQB+/wDz7/X/8+/1//Pv9f/z7/X/8+/2//Pv9v/z7vb/8u72//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u72//Pu9v/z7/b/8+/1//Pv9P/08PT/9PDz//Tw8//18fL/9fHx//Xx8f/18fD/9vLw//by7//28u//9vLv/wCBAH7/APPv9f/z7/X/8+/2//Pv9v/z7/b/8u72//Lu9v/y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vb/8+72//Pv9v/z7/X/8+/0//Tw9P/08PP/9PDy//Xx8v/18fH/9fHx//bx8P/28vD/9vLv//by7//28u//AIEAfv8A8+/2//Pv9v/z7/b/8+72//Lu9v/y7vb/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9v/z7vb/8+/2//Pv9f/z7/T/9PD0//Tw8//08PL/9fHy//Xx8f/18fD/9vLw//by7//28u//9vLv//by7/8AgQB+/wDz7vb/8u72//Lu9v/y7vb/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u72//Pv9v/z7/X/8+/1//Tw9P/08PP/9PDz//Xx8v/18fH/9fHw//by8P/28u//9vLv//by7v/28u7/9/Pu/wCBAH7/APLu9v/y7vb/8u72//Lu9v/y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9v/z7/b/8+/1//Pv9f/z7/T/9PDz//Tw8//18fL/9fHx//Xx8P/28vD/9vLv//by7v/38+7/9/Pu//fz7f/38+3/AIEAfv8A8u72//Lu9v/y7vb/8u72//Lu9v/y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vb/8+/2//Pv9f/z7/X/9O/0//Tw8//08PP/9fHy//Xx8f/18fD/9vLv//by7//38+7/9/Pt//fz7f/38+z/9/Ps//jz7P8AgQB+/wDz7/b/8+/2//Pv9v/z7/b/8+72//Lu9v/y7vb/8u72//Lu9v/y7vb/8u72//Lu9v/z7vb/8+/2//Pv9f/z7/X/8+/0//Tw9P/08PP/9PDy//Xx8v/18fH/9vLw//by7//38u7/9/Pt//fz7f/49Oz/+PTr//j06//49Ov/+PTr/wCBAH7/APPv9f/z7/X/8+/1//Pv9f/z7/X/8+/1//Pv9v/z7/b/8+/2//Pv9v/z7/X/8+/1//Pv9f/z7/X/8+/0//Tw9P/08PP/9PDz//Xx8v/18fH/9vHw//by7//28u7/9/Pt//fz7f/49Oz/+PTr//j06v/59er/+fXp//n16f/59en/AIEAfv8A8+/0//Pv9P/z7/T/8+/0//Pv9P/z7/X/8+/1//Pv9f/z7/X/8+/0//Pv9P/z7/T/9PD0//Tw8//08PP/9PDy//Xx8v/18fH/9fHw//by7//28u7/9/Pt//fz7f/49Oz/+PTr//n16v/59en/+fXo//r26P/69uf/+vbn//r25/8AgQB+/wD08PP/9PDz//Tw8//08PP/9PDz//Tw8//08PP/9PDz//Tw8//08PP/9PDz//Tw8//08PL/9fHy//Xx8f/18fH/9fHw//by7//28u7/9/Pu//fz7f/49Oz/+PTr//n16v/59en/+vbo//r25//69ub/+/fm//v35f/79+X/+/fl/wCBAH7/APXx8v/18fL/9fHy//Xw8v/18PL/9fDy//Xw8v/18fL/9fHy//Xx8v/18fL/9fHx//Xx8f/18fD/9vLw//by7//28u7/9/Pu//fz7f/49Oz/+PTr//n16v/59en/+vbo//r25//79+b/+/fl//v35P/8+OT//Pjj//z44//8+OP/AIEAfv8A9fHx//Xx8f/18fH/9fHx//Xx8f/18fH/9fHx//Xx8f/18fH/9fHw//bx8P/28vD/9vLv//by7//28u7/9/Pu//fz7f/49Oz/+PTr//n16v/59en/+vbo//r25//79+b/+/fl//z45P/8+OP//Pji//354v/9+eH//fnh//354f8AgQB+/wD28vD/9vLw//by8P/28vD/9vLw//by8P/28u//9vLv//by7//28u//9vLv//by7v/38+7/9/Pt//fz7f/49Oz/+PTr//j06v/59en/+fXo//r25//79ub/+/fl//z45P/8+OP//fni//354f/9+eD//vrg//763//++t///vrf/wCBAH7/APby7//28u//9vLv//by7//28u//9vLv//by7v/28u7/9vLu//fz7v/38+7/9/Pt//fz7f/38+z/+PTs//j06//59er/+fXp//r26P/69uf/+/fm//v35f/8+OT//Pji//354f/9+eD//vrg//763//++t7///ve///73f//+93/AIEAfv8A9/Pu//fz7v/38+7/9/Pu//fz7v/38+7/9/Pu//fz7v/38+3/9/Pt//fz7f/38+z/+PTs//j06//49Ov/+fXq//n16f/69ej/+vbn//v35v/79+X//Pjk//z44//9+eH//fng//763//++t////ve///73f//+93///vc///73P8BgQB+/wD38+3/9/Pt//fz7f/38+3/9/Pt//fz7f/38+3/9/Pt//fz7f/38+3/9/Ps//j07P/49Ov/+PTr//j06v/59en/+fXp//r26P/69uf/+/fl//v35P/8+OP//fji//354f/++uD//vrf///73v//+93///vd///73P///Nz///zc//3xohuEKjoGAAAAAElFTkSuQmCC" width="1576" height="800" style="aspect-ratio:1576 / 800;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAASCAYAAAA6yNxSAAAJcklEQVR4AQCBAH7/APPv9f/z7/X/8+/1//Pv9f/z7/X/8+/1//Pv9v/z7/b/8u72//Lu9v/y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vb/8+/2//Pv9f/z7/X/8+/0//Tw9P/08PP/9PDz//Xx8v/18fH/9fHx//Xx8P/28vD/9vLw//by7//28u//AIEAfv8A8+/1//Pv9f/z7/X/8+/1//Pv9f/z7/b/8+/2//Pu9v/y7vb/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9v/z7/b/8+/2//Pv9f/z7/T/9PD0//Tw8//08PP/9fHy//Xx8f/18fH/9fHw//by8P/28vD/9vLv//by7/8AgQB+/wDz7/X/8+/1//Pv9f/z7/X/8+/2//Pv9v/z7vb/8u72//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u72//Pu9v/z7/b/8+/1//Pv9P/08PT/9PDz//Tw8//18fL/9fHx//Xx8f/18fD/9vLw//by7//28u//9vLv/wCBAH7/APPv9f/z7/X/8+/2//Pv9v/z7/b/8u72//Lu9v/y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vb/8+72//Pv9v/z7/X/8+/0//Tw9P/08PP/9PDy//Xx8v/18fH/9fHx//bx8P/28vD/9vLv//by7//28u//AIEAfv8A8+/2//Pv9v/z7/b/8+72//Lu9v/y7vb/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9v/z7vb/8+/2//Pv9f/z7/T/9PD0//Tw8//08PL/9fHy//Xx8f/18fD/9vLw//by7//28u//9vLv//by7/8AgQB+/wDz7vb/8u72//Lu9v/y7vb/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u72//Pv9v/z7/X/8+/1//Tw9P/08PP/9PDz//Xx8v/18fH/9fHw//by8P/28u//9vLv//by7v/28u7/9/Pu/wCBAH7/APLu9v/y7vb/8u72//Lu9v/y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9v/z7/b/8+/1//Pv9f/z7/T/9PDz//Tw8//18fL/9fHx//Xx8P/28vD/9vLv//by7v/38+7/9/Pu//fz7f/38+3/AIEAfv8A8u72//Lu9v/y7vb/8u72//Lu9v/y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vf/8u73//Lu9//y7vb/8+/2//Pv9f/z7/X/9O/0//Tw8//08PP/9fHy//Xx8f/18fD/9vLv//by7//38+7/9/Pt//fz7f/38+z/9/Ps//jz7P8AgQB+/wDz7/b/8+/2//Pv9v/z7/b/8+72//Lu9v/y7vb/8u72//Lu9v/y7vb/8u72//Lu9v/z7vb/8+/2//Pv9f/z7/X/8+/0//Tw9P/08PP/9PDy//Xx8v/18fH/9vLw//by7//38u7/9/Pt//fz7f/49Oz/+PTr//j06//49Ov/+PTr/wCBAH7/APPv9f/z7/X/8+/1//Pv9f/z7/X/8+/1//Pv9v/z7/b/8+/2//Pv9v/z7/X/8+/1//Pv9f/z7/X/8+/0//Tw9P/08PP/9PDz//Xx8v/18fH/9vHw//by7//28u7/9/Pt//fz7f/49Oz/+PTr//j06v/59er/+fXp//n16f/59en/AIEAfv8A8+/0//Pv9P/z7/T/8+/0//Pv9P/z7/X/8+/1//Pv9f/z7/X/8+/0//Pv9P/z7/T/9PD0//Tw8//08PP/9PDy//Xx8v/18fH/9fHw//by7//28u7/9/Pt//fz7f/49Oz/+PTr//n16v/59en/+fXo//r26P/69uf/+vbn//r25/8AgQB+/wD08PP/9PDz//Tw8//08PP/9PDz//Tw8//08PP/9PDz//Tw8//08PP/9PDz//Tw8//08PL/9fHy//Xx8f/18fH/9fHw//by7//28u7/9/Pu//fz7f/49Oz/+PTr//n16v/59en/+vbo//r25//69ub/+/fm//v35f/79+X/+/fl/wCBAH7/APXx8v/18fL/9fHy//Xw8v/18PL/9fDy//Xw8v/18fL/9fHy//Xx8v/18fL/9fHx//Xx8f/18fD/9vLw//by7//28u7/9/Pu//fz7f/49Oz/+PTr//n16v/59en/+vbo//r25//79+b/+/fl//v35P/8+OT//Pjj//z44//8+OP/AIEAfv8A9fHx//Xx8f/18fH/9fHx//Xx8f/18fH/9fHx//Xx8f/18fH/9fHw//bx8P/28vD/9vLv//by7//28u7/9/Pu//fz7f/49Oz/+PTr//n16v/59en/+vbo//r25//79+b/+/fl//z45P/8+OP//Pji//354v/9+eH//fnh//354f8AgQB+/wD28vD/9vLw//by8P/28vD/9vLw//by8P/28u//9vLv//by7//28u//9vLv//by7v/38+7/9/Pt//fz7f/49Oz/+PTr//j06v/59en/+fXo//r25//79ub/+/fl//z45P/8+OP//fni//354f/9+eD//vrg//763//++t///vrf/wCBAH7/APby7//28u//9vLv//by7//28u//9vLv//by7v/28u7/9vLu//fz7v/38+7/9/Pt//fz7f/38+z/+PTs//j06//59er/+fXp//r26P/69uf/+/fm//v35f/8+OT//Pji//354f/9+eD//vrg//763//++t7///ve///73f//+93/AIEAfv8A9/Pu//fz7v/38+7/9/Pu//fz7v/38+7/9/Pu//fz7v/38+3/9/Pt//fz7f/38+z/+PTs//j06//49Ov/+fXq//n16f/69ej/+vbn//v35v/79+X//Pjk//z44//9+eH//fng//763//++t////ve///73f//+93///vc///73P8BgQB+/wD38+3/9/Pt//fz7f/38+3/9/Pt//fz7f/38+3/9/Pt//fz7f/38+3/9/Ps//j07P/49Ov/+PTr//j06v/59en/+fXp//r26P/69uf/+/fl//v35P/8+OP//fji//354f/++uD//vrf///73v//+93///vd///73P///Nz///zc//3xohuEKjoGAAAAAElFTkSuQmCC" data-src="/assets/image-20231220153518806.CzBV4t9D.png" loading="lazy" alt="" width="1576" height="800" style="aspect-ratio:1576 / 800;"><!--]--></p></li><li><p>单列索引与联合索引</p><p>单列索引：即一个索引只包含单个列。</p><p>联合索引：即一个索引包含了多个列。</p><p>在业务场景中，如果存在多个查询条件，考虑针对于查询字段建立索引时，建议建立联合索引，而非单例索引。</p><p><strong>多条件联合查询时，MySQL优化器会评估哪个字段的索引效率更高，会选择该索引完成本次查询。</strong></p></li></ul><h3 id="索引设计原则" tabindex="-1">索引设计原则 <a class="header-anchor" href="#索引设计原则" aria-label="Permalink to &#x22;索引设计原则&#x22;">​</a></h3><ol><li>针对数据量较大，且查询比较频繁的表建立索引。</li><li>针对于常作为查询条件（where）、排序（order by）、分组（group by）操作的字段建立索引。</li><li>尽量选择区分度高的列作为索引，尽量建立唯一索引，区分度越高，使用索引的效率越高，使用索引的效率越高。</li><li>如果是字符串类型的字段，字段的长度较长，可以针对于字段的特点，建立前缀索引。</li><li>尽量使用联合索引，减少单列索引，查询时，联合索引很多时候可以覆盖索引，节省存储空间，避免回表，提高查询效率。</li><li>要控制索引的数量，索引并不是多多益善，索引越多，维护索引结构的代价就越大，会影响增删改的效率。</li><li>如果索引列不能存储NULL值，请在创建表时使用NOT NULL约束它。当优化器知道每列是否包含NULL值时，它可以更好地确定哪个索引最有效地用于查询。</li></ol><h2 id="sql优化" tabindex="-1">SQL优化 <a class="header-anchor" href="#sql优化" aria-label="Permalink to &#x22;SQL优化&#x22;">​</a></h2><ul><li><p>insert优化</p><p>批量插入</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>insert into tb_test values(1,'Tom'),(2,'Cat'),(3,'Jerry');</span></span></code></pre></div><p>手动提交事务</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>start transaction;</span></span>
<span class="line"><span>insert into tb_test values(1,'Tom'),(2,'Cat'),(3,'Jerry');</span></span>
<span class="line"><span>insert into tb_test values(4,'Tom'),(5,'Cat'),(6,'Jerry');</span></span>
<span class="line"><span>insert into tb_test values(7,'Tom'),(8,'Cat'),(9,'Jerry');</span></span>
<span class="line"><span>commit;</span></span></code></pre></div><p>主键顺序插入</p><div class="language-tex vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">主键乱序插入：8 1 9 21 88 2 4 15 89 5 7 3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">主键顺序插入：1 2 3 4 5 7 8 9 15 21 88 89</span></span></code></pre></div></li><li><p>大批量插入数据</p><p>如果一次性需要插入大批量数据，使用insert语句性能较低，此时可以使用MySQL数据库提供的load指令进行插入。操作如下：</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#客户端连接服务端时，加上参数 --local-infile</span></span>
<span class="line"><span>mysql --local-infile -u root -p</span></span>
<span class="line"><span>#设置全局参数local_infile为1，开启从本地加载文件导入数据的开关</span></span>
<span class="line"><span>set global local_infile=1;</span></span>
<span class="line"><span>#执行load指令将准备好的数据，加载到表结构中</span></span>
<span class="line"><span>load data local infile '/root/sql1.log' into 'tb_user' fields terminated by ',' lines terminated by '\n';</span></span></code></pre></div><p>主键顺序插入性能高于乱序插入</p></li><li><p>主键优化</p><ul><li><p>数据组织方式</p><p>在InnoDB存储引擎中，表数据都是根据主键顺序组织存放的，这种存储方式的表称为<strong>索引组织表</strong>（index organization table <strong>IOT</strong>）。</p></li><li><p>页分裂</p><p>页可以为空，也可以填充一半，也可以填充100%。每个页包含了2-N行数据（如果一行数据多大，会行溢出），根据主键排序。</p></li><li><p>页合并</p><p>当删除一行记录时，实际上记录并没有被物理删除，只是记录被标记（flaged）为删除并且它的空间变得允许被其他记录声明使用。</p><p>当页中删除的记录达到MERGE_THRESHOLD（默认为页的50%），InnoDB会开始寻找最靠近的页（前或后）看看是否将两个页合并以优化使用。</p><p>MERGRE_THRESHOLD：合并页的阈值，可以自己设置，在创建表或者创建索引时指定。</p></li><li><p>主键设计原则</p><p>满足业务需求的情况下，尽量降低主键的长度。</p><p>插入数据时，尽量选择顺序插入，选择使用AUTO_INCREMENT自增主键。.</p><p>尽量不要使用UUID做主键或者是其他自然主键，如身份证号。</p><p>业务操作时，避免对主键的修改。</p></li></ul></li><li><p>order by优化</p><ol><li>Using filesort：通常表的索引或全表扫描，满足条件的数据行，然后在排序缓冲区sort buffer中完成排序操作，所有不是通过索引直接返回排序结果的排序都叫FileSort排序。</li><li>Using index：通常有序索引顺序扫描直接返回有序数据，这种情况即为using index，不需要额外排序，操作效率高。</li></ol><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#没有创建索引时，根据age，phone进行排序</span></span>
<span class="line"><span>explain select id,age,phone from tb_user order by age,phone;</span></span>
<span class="line"><span>#创建索引</span></span>
<span class="line"><span>create index idx_user_age_phone_aa on tb_user(age,phone);</span></span>
<span class="line"><span>#创建索引后，根据age,phone进行升序排序</span></span>
<span class="line"><span>explain select id,age,phone from tb_user order by age,phone;</span></span>
<span class="line"><span>#创建索引后，根据age，phone进行降序排序</span></span>
<span class="line"><span>explain select id,age,phone from tb_user order by age desc,phone desc;</span></span></code></pre></div><p>根据排序字段建立合适的索引，多字段排序时，也遵循最左前缀法则。</p><p>尽量使用覆盖索引。</p><p>多字段排序，一个升序一个降序，此时需要注意联合索引在创建时的规则（ASC/DESC）。</p><p>如果不可避免的出现filesort，大数据量排序时，可以适当增大排序缓冲区大小sort_buffer_size（默认256k）。</p></li><li><p>group by优化</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#删除掉目前的联合索引 idx_user_pro_sta</span></span>
<span class="line"><span>drop index idx_user_pro_sta on tb_user;</span></span>
<span class="line"><span>#执行分组操作，根据profession字段分组</span></span>
<span class="line"><span>explain select profession,count(*) from tb_user group by profession;</span></span>
<span class="line"><span>#创建索引</span></span>
<span class="line"><span>Create index idx_user_pro_age_sta on tb_user(profession,age,status);</span></span>
<span class="line"><span>#执行分组操作，根据profession字段分组</span></span>
<span class="line"><span>explain select profession,count(*) from tb_user group by profession;</span></span>
<span class="line"><span>#执行分组操作，根据profession字段分组</span></span>
<span class="line"><span>explain select profession,count(*) from tb_user group by profession,age;</span></span></code></pre></div><p>在分组操作时，可以通过索引来提高效率。</p><p>分组操作时，索引的使用也是满足最左前缀法则的。</p></li><li><p>limit优化</p><p>一个常见有非常头疼的问题就是limit 20000000,10，此时需要MySQL排序前2000010记录，仅仅返回2000000-2000010的记录，其他记录丢弃，查询排序的代价非常大。</p><p>优化思路：一般分页查询时，通过创建 覆盖索引 能够此较好地提高性能，可以通过覆盖索引加子查询形式进行优化。</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>explain select * from tb_sku t,(select id from tb_sku order by id limit 2000000,10) a where t.id = a.id;</span></span></code></pre></div></li><li><p>count优化</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>explain select count(*) from tb_user;</span></span></code></pre></div><p>MyISAM引擎把一个表的总行数存在了磁盘上，因为执行count(*)的时候会直接返回这个数，效率很高；</p><p>InnoDB引擎就麻烦了，它执行count(*)的时候，需要把数据一行一行地从索引里面读出来，然后累积计数。</p><p>优化思路：自己计数。</p><ul><li><p>count的几种方法</p><p>count()是一个聚合函数，对于返回的结果集，一行一行地判断，如果count函数的参数不是NULL，累计值就加1，否则不加，最后返回累加值。</p><p>用法：count(*) 、count(主键)、count(字段)、count(1)</p><p>count(主键)</p><p>InnoDB引擎会遍历整张表，把每一行的主键id值取出来，返回给服务层。服务层拿到主键后，直接按行累加(主键不可能为null)。</p><p>count(字段)</p><p>没有not null约束：InnoDB引擎会遍历整张表把每一行的字段值都取出来，返回给服务层，服务层判断是否为null，不为null，计数累加。</p><p>有not null约束：InnoDB引擎会遍历整张表把每一行的字段值都取出来，返回给服务层，直接按行进行累加。</p><p>count(1)</p><p>InnoDB引擎便利整张表，但不取值。服务层对于返回的每一行，放一个数字“1”进去，直接按行进行累加。</p><p>count(*)</p><p>InnoDB引擎并不会把全部字段取出来，而是专门做优化，不取值，服务层直接按行进行累加。</p></li></ul><p>按照效率排序的话，count(字段)&#x3C;count(主键id)&#x3C;count(1)=count(<em>),所以尽量使用count(</em>)。</p></li><li><p>update优化</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>update table_name set column1=value1 where column2=value2;</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>update table_name set column1=value1 where column3=value3;</span></span></code></pre></div><p>InnoDB的行锁是针对索引加的锁，不是针对记录加的锁，并且该索引不能失效，否则会从行锁升级为表锁。</p></li></ul><h2 id="视图-存储过程-触发器" tabindex="-1">视图/存储过程/触发器 <a class="header-anchor" href="#视图-存储过程-触发器" aria-label="Permalink to &#x22;视图/存储过程/触发器&#x22;">​</a></h2><h3 id="视图" tabindex="-1">视图 <a class="header-anchor" href="#视图" aria-label="Permalink to &#x22;视图&#x22;">​</a></h3><ul><li><p>介绍</p><p>视图（View）是一种虚拟存在的表。视图中的数据并不在数据库中实际存在，行和列数据来自定义视图的查询使用的表，并且是在使用视图动态生成的。</p><p>通俗的讲，视图只保存了查询的SQL逻辑，不保存查询的结果。所以我们创建视图的时候，主要的工作就落在创建这条SQL查询语句上。</p></li><li><p>创建</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>CREATE [OR REPLACE] VIEW 视图名称[(列名列表)] AS SELECT语句 [WITH[CASCADED|LOCAL] CHECK OPTION]</span></span></code></pre></div></li><li><p>查询</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#查看创建视图语句：</span></span>
<span class="line"><span>SHOW CREATE VIEW 视图名称;</span></span>
<span class="line"><span>#查看视图数据：</span></span>
<span class="line"><span>SELECT * from 视图名称......;</span></span></code></pre></div></li><li><p>修改</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>CREATE [OR REPLACE] VIEW 视图名称[(列名列表)] AS SELECT语句 [WITH(CASCADED|LOCAL) CHECK OPTION]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ATER VIEW 视图名称[(列名列表)] AS SELECT语句 [WITH[CASCADED|LOCAL] CHECK OPTION]</span></span></code></pre></div></li><li><p>删除</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>DROP VIEW [IF EXISTS] [视图名称]...</span></span></code></pre></div></li><li><p>视图的检查选项</p><p>当使用WITH CHECK OPTION子句创建视图时，MySQL会通过视图检查正在更改的每个行，例如插入，更新，删除，以使其符合视图的定义。MySQL允许基于另一个视图创建视图，它还会检查依赖视图中的规则以保持一致性。为了确定检查的范围，mysql提供了两个选项：CASCADED和LOCAL，默认值为CASCADED。</p><p>CASCADED：</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>create view v1 as select id,name from student where id&#x3C;=20 &#x3C;with cascaded check option>;</span></span></code></pre></div><p>​ ⬆️</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>create view v2 as select id,name from v1 where id>=10 with cascaded check option;</span></span></code></pre></div><p>​ ⬆️</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>create view v3 as select id,name from v2 where id&#x3C;=15;</span></span></code></pre></div><p>LOCAL：</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>create view v1 as select id,name from student where id &#x3C;= 15;</span></span></code></pre></div><p>​ ⬆️</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>create view v2 as select id,name from v1 where id >= 10 [with local check option];</span></span></code></pre></div><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>create view v3 as select id,name from v2 where id &#x3C; 20</span></span></code></pre></div></li><li><p>视图的更新</p><p>要使视图可更新，视图中的行与基础表中的行之间必须存在一对一的关系。如果视图包含以下任何一项，则该视图不可更新：</p><ol><li>聚合函数或窗口函数(SUM()、MIN()、MAX()、COUNT()等)</li><li>DISTINCT</li><li>GROUP BY</li><li>HAVING</li><li>UNION或者UNION ALL</li></ol></li><li><p>作用</p><p>简单</p><p>视图不仅可以简化用户对数据的理解，也可以简化他们的操作。那些被经常使用的查询可以被定义为视图，从而使得用户不必为以后的操作每次指定全部的条件。</p><p>安全</p><p>数据库可以授权，但不能授权到数据库特定行和特定的列上。通过视图用户只能 查询和修改他们所能见到的数据。</p><p>数据独立</p><p>视图可帮助用户屏蔽真实表结构变化带来的影响。</p></li></ul><h3 id="存储过程" tabindex="-1">存储过程 <a class="header-anchor" href="#存储过程" aria-label="Permalink to &#x22;存储过程&#x22;">​</a></h3><ul><li><p>介绍</p><p>存储过程是事先经过编译并存储在数据库中的一段SQL语句的集合，调用存储过程可以简化应用开发人员的很多工作，减少数据在数据库和应用服务器之间的传输对于提高数据处理的效率是有好处的。</p><p>存储过程思想上很简单/就是数据库SQL语言层面的代码封装与重用。</p></li><li><p>特点</p><p>封装，复用</p><p>可以接受参数，也可以返回数据</p><p>减少网络交互，效率提升</p></li><li><p>创建</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>CTREATE PROCEDUER 存储过程名称([参数列表])</span></span>
<span class="line"><span>BEGIN</span></span>
<span class="line"><span>	--SQL语句</span></span>
<span class="line"><span>END;</span></span></code></pre></div></li><li><p>调用</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>CALL 名称([参数]);</span></span></code></pre></div></li><li><p>查看</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>SELECT * FROM INFOMATION_SCHEMA.ROUTINES WHERE ROUTINES_SCHEMA='xxx' --查询指定数据库的存储过程及状态</span></span>
<span class="line"><span>SHOW CREATE PROCEDUER 存储过程名称; --查询某个存储过程的定义</span></span></code></pre></div></li><li><p>删除</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>DROP PROUTINES [IF EXISTS] 存储过程名称;</span></span></code></pre></div></li></ul><p><strong>注意：在命令行中，执行创建存储过程的SQL时，需要通过关键字delimiter指定SQL语句的结束符。</strong></p><ul><li><p>变量</p><p><strong>系统变量</strong> 是MySQL服务提供，不是用户定义的，属于服务器层面。分为全局变量(GLOBAL)、会话变量(SESSION)。</p><p>查看系统变量</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>SHOW [SESSION | GLOBAL] VARIABLES;  -- 查看所有系统变量</span></span>
<span class="line"><span>SHOW [SESSION | GLOBAL] VARIABLES LIKE '......'; -- 可以通过LIKE模糊匹配方式查找变量</span></span>
<span class="line"><span>SELECT @@[SESSION | GLOBAL] 系统变量名; -- 查看指定变量的值</span></span></code></pre></div><p>设定系统变量</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>SET [ SESSION | GLOBAL ] 系统变量名=值;</span></span>
<span class="line"><span>SET @@[SESSION | GLOBAL] 系统变量名=值;</span></span></code></pre></div><p><strong>注意：</strong></p><p><strong>如果没有SESSION/GLOBAL，默认是SESSION，会话变量。</strong></p><p><strong>mysql服务器重新启动之后，所设置的全局参数会失效，要想不失效，可以在/etc/my.cnf中配置。</strong></p><p><strong>用户自定义变量</strong> 使用户根据需要自己定义的变量，用户变量不用提前声明，在用的时候直接用“@变量名”使用就可以。其作用域为当前连接。</p><p>赋值</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>SET @var_name = expr [, @var_name = expr]...;</span></span>
<span class="line"><span>SET @var_name := expr [, @var_name := expr]...;</span></span></code></pre></div><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>SELECT @var_name := expr [,@var_name := expr]...;</span></span>
<span class="line"><span>SELECT 字段名 INTO @var_name FROM 表名;</span></span></code></pre></div><p>使用</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>SELECT @var_name;</span></span></code></pre></div><p><strong>注意</strong></p><p><strong>用户定义的变量无需对其进行声明或初始化，只不过获取到的值为NULL。</strong></p><p><strong>局部变量</strong> 是根据需要定义的在局部生效的变量，访问之前，需要DECLARE声明。可用作存储过程内的局部变量和输入参数，局部变量的范围是在其内部声明的BEGIN..END块</p><p>声明</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>DECLARE 变量名 变量类型[DEFAULT...];</span></span></code></pre></div><p>变量类型就是数据库字段类型：INT、BIGINT、CHAR、VARCHAR、DATE、TIME等。</p><p>赋值</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>SET 变量名 = 值;</span></span>
<span class="line"><span>SET 变量值 := 值;</span></span>
<span class="line"><span>SELECT 字段名 INTO 变量名 FROM 表名...;</span></span></code></pre></div></li><li><p>if</p><p>语法</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>IF 条件1 THEN</span></span>
<span class="line"><span>	...</span></span>
<span class="line"><span>ELSEIF 条件2 THEN        --可选</span></span>
<span class="line"><span>	...</span></span>
<span class="line"><span>ELSE					--可选</span></span>
<span class="line"><span>	...</span></span>
<span class="line"><span>END IF;</span></span></code></pre></div></li><li><p>参数</p><table><thead><tr><th style="text-align:center;">类型</th><th style="text-align:center;">含义</th><th style="text-align:center;">备注</th></tr></thead><tbody><tr><td style="text-align:center;">IN</td><td style="text-align:center;">该类参数作为输入，也就是需要调用时传入值</td><td style="text-align:center;">默认</td></tr><tr><td style="text-align:center;">OUT</td><td style="text-align:center;">该类参数作为输出，也就是该参数可以作为返回值</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">INOUT</td><td style="text-align:center;">即可以作为输入参数，也可以作为输出参数</td><td style="text-align:center;"></td></tr></tbody></table><p>用法</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>CREATE PROCEDUER 存储过程名称([IN/OUT/INOUT] 参数名 参数类型)</span></span>
<span class="line"><span>BEGIN</span></span>
<span class="line"><span>	-- SQL语句</span></span>
<span class="line"><span>END;</span></span></code></pre></div></li><li><p>case</p><p>语法一</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>CASE case_value</span></span>
<span class="line"><span>	WHEN when_value1 THEN statement_list1</span></span>
<span class="line"><span>	[ WHEN when_value2 THEN statement_list 2]...</span></span>
<span class="line"><span>	[ELSE statement_list]</span></span>
<span class="line"><span>END CASE;</span></span></code></pre></div><p>语法二</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>CASE</span></span>
<span class="line"><span>	WHEN search_condition1 THEN statement_list</span></span>
<span class="line"><span>	[WHEN search_condition2 THEN statement_list]...</span></span>
<span class="line"><span>	[ELSE statement_list]</span></span>
<span class="line"><span>END CASE;</span></span></code></pre></div></li><li><p>while</p><p>while循环是有条件的循环控制语句。满足条件后，再执行循环体中的SQL语句。具体语法为：</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#先判定条件，如果条件为true，则执行逻辑，否则，不执行逻辑</span></span>
<span class="line"><span>WHILE 条件 DO</span></span>
<span class="line"><span>	SQ逻辑...</span></span>
<span class="line"><span>END WHILE;</span></span></code></pre></div></li><li><p>repeat</p><p>repeat是有条件的循环控制语句，当满足条件的时候退出循环。具体语法为：</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#先执行一次逻辑，然后判定逻辑是否满足，如果满足，则退出。如果不满足，则继续下一次循环</span></span>
<span class="line"><span>REPEAT</span></span>
<span class="line"><span>	SQL逻辑...</span></span>
<span class="line"><span>	UNTIL条件</span></span>
<span class="line"><span>END REPEAT;</span></span></code></pre></div></li><li><p>loop</p><p>LOOP实现简单的循环，如果不在SQL逻辑中增加退出循环的条件，可以用其来实现简单的死循环。LOOP可以配合一下两个语句使用：</p><ul><li>LEAVE：配合循环使用，退出循环。</li><li>ITERATE：必须用在循环中，作用是跳过当前循环剩下的语句，直接进入下一次循环。</li></ul><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[begin_label:] LOOP</span></span>
<span class="line"><span>	SQL逻辑...</span></span>
<span class="line"><span>END LOOP [end_label];</span></span></code></pre></div><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>LEAVE label; -- 退出指定标记的循环体</span></span>
<span class="line"><span>ITERATE label; -- 直接进入下一次循环</span></span></code></pre></div></li><li><p>游标</p><p>**游标(CURSOR) **是用来存储查询结果集的数据类型，在存储过程和函数中可以使用游标对结果集进行循环的处理。游标的使用包括游标的声明、OPEN、FETCH和CLOSE，其语法分别如下。</p><p>声名游标</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>DECLARE 游标名称 CURSOR FOR 查询语句;</span></span></code></pre></div><p>打开游标</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>OPEN 游标名称;</span></span></code></pre></div><p>获取游标记录</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>FETCH 游标名称 INTO 变量[,变量];</span></span></code></pre></div><p>关闭游标</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>CLOSE 游标名称;</span></span></code></pre></div></li><li><p>条件处理程序</p><p><strong>条件处理程序(Handler)</strong> 可以用来定义在流程控制结构执行过程中遇到问题时相应的处理步骤。具体语法为：</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>DECLARE handler_action HANDLER FOR condition_value [,condition_value]... statement;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>handler_action</span></span>
<span class="line"><span>	CONTINUE:继续执行当前程序</span></span>
<span class="line"><span>	EXIT:终止执行当前程序</span></span>
<span class="line"><span>condition_value</span></span>
<span class="line"><span>	SQLSTATE sqlstate_value:状态码，如02000</span></span>
<span class="line"><span>	SQLWARNING:所有以01开头的SQLSTATE代码的简写</span></span>
<span class="line"><span>	NOT FOUND:所有以02开头的SQLSTATE代码的简写</span></span>
<span class="line"><span>	SQLEXCEPTION:所有没有被SQLWARNING或者NOT FOUND捕获的SQLSTATE代码的简写</span></span></code></pre></div><p><a class="VPNolebaseInlinePreviewLink" relative="" href="https://dev.mysql.com/doc/mysql-errors/8.0/en/server-error-reference.html" target="_blank" rel="noreferrer" data-v-0925c8fc=""><!--[-->服务器错误消息参考<!--]--><!----><!----></a></p></li></ul><h3 id="存储函数" tabindex="-1">存储函数 <a class="header-anchor" href="#存储函数" aria-label="Permalink to &#x22;存储函数&#x22;">​</a></h3><p>存储函数有返回值的存储过程，存储函数的参数只能是IN类型的。具体语法如下:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>CREATE FUNCTION 存储函数名称([参数列表])</span></span>
<span class="line"><span>RETURNS type [characteristic...]</span></span>
<span class="line"><span>BEGIN</span></span>
<span class="line"><span>	--SQL语句</span></span>
<span class="line"><span>	RETURN...;</span></span>
<span class="line"><span>END;</span></span></code></pre></div><p>characteristic说明:</p><ul><li>DETERMINISTIC：相同的输入参数总是产生相同的结果</li><li>NO SQL：不包含SQL语句。</li><li>READS SQL DATE：包含读取数据语句，但不包含写入数据的语句。</li></ul><h3 id="触发器" tabindex="-1">触发器 <a class="header-anchor" href="#触发器" aria-label="Permalink to &#x22;触发器&#x22;">​</a></h3><ul><li><p>介绍</p><p>触发器是与表有关的数据库对象，指在insert/update/delete之前或之后，触发并执行触发器中定义的SQL语句集合。触发器的这种特性可以协助应用在数据库端确保数据的完整性，日志记录，数据校验等操作。</p><p>使用别名OLD和NEW来引用触发器中发生变化的记录内容，这与其他的数据库是相似的。现在触发器还只支持行级触发，不支持语句级触发。</p><table><thead><tr><th style="text-align:center;">触发器类型</th><th style="text-align:center;">NEW和OLD</th></tr></thead><tbody><tr><td style="text-align:center;">INSERT型触发器</td><td style="text-align:center;">NEW表示将要或者已经新增的数据</td></tr><tr><td style="text-align:center;">UPDATE型触发器</td><td style="text-align:center;">OLD表示修改之前的数据，NEW表示将要或已经修改后的数据</td></tr><tr><td style="text-align:center;">DELETE型触发器</td><td style="text-align:center;">OLD表示将要或者已经删除的数据</td></tr></tbody></table></li><li><p>语法</p><p>创建</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>CREATE TRIGGER trigger_name</span></span>
<span class="line"><span>BEFORE/AFTER INSERT/UPDATE/DELETE</span></span>
<span class="line"><span>ON tbl_name FOR EACH ROW --行级触发器</span></span>
<span class="line"><span>BEGIN</span></span>
<span class="line"><span>	trigger_stmt;</span></span>
<span class="line"><span>END;</span></span></code></pre></div><p>查看</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>SHOW TRIGGERS;</span></span></code></pre></div><p>删除</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>DROP TRIGGER [schema_name.]trigger_name; --如果没有指定schema_name，默认为当前数据库。</span></span></code></pre></div></li></ul><h2 id="锁" tabindex="-1">锁 <a class="header-anchor" href="#锁" aria-label="Permalink to &#x22;锁&#x22;">​</a></h2><h3 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to &#x22;概述&#x22;">​</a></h3><ul><li><p><strong>介绍</strong></p><p>锁是计算机协调多个进程或线程并发访问某一资源的机制。在数据库中，除传统的计算资源(CPU、RAM、I/O)的争用以外，数据也是一种供许多用户共享的资源。如何保证数据并发访问的一致性、有效性是所有数据库必须解决的一个问题，锁冲突也是影响数据库并发访问性能的一个重要因素。从这个角度来说，锁对数据库而言显得尤其重要，也更加复杂。</p></li><li><p>分类</p><p>MySQL中的锁，按照锁的粒度分，分为以下三类：</p><ol><li>全局锁：锁定数据库中的所有表。</li><li>表级锁：每次操作锁住整张表。</li><li>行级锁：每次操作锁住对应的行数据。</li></ol></li></ul><h3 id="全局锁" tabindex="-1">全局锁 <a class="header-anchor" href="#全局锁" aria-label="Permalink to &#x22;全局锁&#x22;">​</a></h3><ul><li><p><strong>介绍</strong></p><p>全局锁就是对整个数据库例加锁，加锁后整个实例就处于只读状态，后续的DML的写语句，DDL语句，已经更新操作的事务提交语句都将被阻塞。</p><p>其典型的使用场景是做全库的逻辑备份，对所有的表进行锁定，从而获取一致性视图，保证数据的完整性。</p></li><li><p>演示</p><p><!--[--><img class="nolebase-enhanced-img absolute inset-0 z-1 bg-black/10" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAOCAYAAABO3B6yAAAHWklEQVR4AQCBAH7/AP/////////////+///8+v/++vj///v5/////f/////////////////////////////////9+ff/8e3r/+nl4v/l4N7/5uLg/+zo5v/18e////v5/////////////////////////////////////v////7/////////////////AIEAfv8A//////////////3//vr4//z49v/9+ff///37//////////////////////////////////n18//t6ef/5eHf/+Hd2v/i3tz/6eTi//Lu7P/8+Pb////////////////////////////////////9/////f////7///////////8AgQB+/wD////////////8+v/8+Pb/+fXz//r18//9+ff////9///////////////////////++vj/8u7s/+bi4P/d2df/2dXT/9vX1f/i3tz/7Ojm//by8P//+/n////////////////////////+/P///fv///37///+/P////7//////wCBAH7/AP///////vz//vr3//n18v/18e//9fHv//j08v/++vj////9//////////////z6//by8P/p5eP/3dnX/9TQzv/QzMr/0s7M/9rW1P/k4N7/7+vp//n18////Pr////9/////f///fv///v5//76+P//+/n///z6///+/P////3/AIEAfv8A///9///8+v/79/X/9fHv//Lu7P/x7ev/9PDu//j08v/9+ff///v5//76+P/49PL/7enn/+Dc2v/U0M7/y8fF/8fDwf/KxsT/0c3L/9zY1v/o5OL/8+7s//r29P/++vj//vr4//759//8+Pb//Pj2//359///+/n///37///+/P8AgQB+/wD//fv//vn3//j08v/z7+3/7+vp/+7q6P/w7Or/9PDu//j08v/69vT/+PTy//Ht6//m4uD/2dXT/83Ixv/Ev73/wLy6/8O+vP/KxsT/1tLQ/+Le3P/t6ef/9fHv//r29P/79/X/+/f1//r29P/69vT/+/f1//359///+/n///z6/wCBAH7/AP/7+f/8+Pb/9/Px//Ht6//t6ef/7Ojm/+3p5//x7ev/9fHv//by8P/08O7/7enn/+Le3P/U0M7/yMTC/7+7uf+8t7X/vrq4/8fCwP/Szsz/39vZ/+vn5f/z7+3/+PTy//n18//59fP/+fXz//n18//69vT//Pj2//76+P///Pr/AIEAfv8A//v5//z49v/38vD/8e3r/+3p5//r5+X/7enn//Ht6//08O7/9vLw//Pv7f/s6Ob/4d3b/9TQzv/Hw8H/vrq4/7u3tf++urj/xsLA/9LOzP/f29n/6+fl//Pv7f/49PL/+vb0//r29P/59fP/+fXz//r29P/8+Pb//vr4///7+f8AgQB+/wD//Pr//fn3//j08f/y7uz/7uro/+3p5//v6+n/8+/t//fz8f/49PL/9vLw/+/r6f/k4N7/19LQ/8rGxP/Bvbv/vrq4/8G9u//JxcP/1dHP/+Le3P/u6uj/9vLw//v39f/8+Pb//Pj2//v39f/69vT/+/f1//359///+/n///z6/wCBAH7/AP/+/P//+/n/+vbz//Tw7v/x7ev/8Ozq//Lu7P/38/H/+/f1//359//79/X/9PDu/+nl4//c2Nb/0MzK/8fDwf/EwL7/x8PB/8/Lyf/b19X/6OTi//Pv7f/79/X///v5///8+v//+/n//fn3//z49v/9+ff//vr4///8+v///fv/AIEAfv8A///+///9+//8+Pb/9/Px//Tw7v/08O7/9/Px//z49v///fv////9///+/P/79/X/8e3r/+Tg3v/Y1NL/z8vJ/8zIxv/Py8n/19PR/+Pf3f/v6+n/+vb0///9+////////////////f///fv///v5///7+f///Pr///37///+/P8AgQB+/wD////////9///7+f/69vT/+PPx//j08v/79/X///37///////////////////+/P/49PL/7Ojm/+Dc2v/X09H/1NDO/9fT0f/f29n/6ubk//by8P///fr//////////////////////////v///vz///37///+/P///vz////9/wCBAH7/AP////////////37//359//69vT/+/f1///7+f////////////////////////////76+P/y7uz/5uLg/97a2P/b19X/3tnX/+Xh3//w7Or//Pj2/////////////////////////////////////v////3////9/////v////7/AYEAfv8A/////////////vz//vr4//z49v/9+ff///37//////////////////////////////78//by8P/q5uT/4t7c/97a2P/h3dv/6eXj//Tw7v//+/n//////////////////////////////////////////v////7////+///////ai66uLgGkDwAAAABJRU5ErkJggg==" width="1484" height="562" style="aspect-ratio:1484 / 562;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAOCAYAAABO3B6yAAAHWklEQVR4AQCBAH7/AP/////////////+///8+v/++vj///v5/////f/////////////////////////////////9+ff/8e3r/+nl4v/l4N7/5uLg/+zo5v/18e////v5/////////////////////////////////////v////7/////////////////AIEAfv8A//////////////3//vr4//z49v/9+ff///37//////////////////////////////////n18//t6ef/5eHf/+Hd2v/i3tz/6eTi//Lu7P/8+Pb////////////////////////////////////9/////f////7///////////8AgQB+/wD////////////8+v/8+Pb/+fXz//r18//9+ff////9///////////////////////++vj/8u7s/+bi4P/d2df/2dXT/9vX1f/i3tz/7Ojm//by8P//+/n////////////////////////+/P///fv///37///+/P////7//////wCBAH7/AP///////vz//vr3//n18v/18e//9fHv//j08v/++vj////9//////////////z6//by8P/p5eP/3dnX/9TQzv/QzMr/0s7M/9rW1P/k4N7/7+vp//n18////Pr////9/////f///fv///v5//76+P//+/n///z6///+/P////3/AIEAfv8A///9///8+v/79/X/9fHv//Lu7P/x7ev/9PDu//j08v/9+ff///v5//76+P/49PL/7enn/+Dc2v/U0M7/y8fF/8fDwf/KxsT/0c3L/9zY1v/o5OL/8+7s//r29P/++vj//vr4//759//8+Pb//Pj2//359///+/n///37///+/P8AgQB+/wD//fv//vn3//j08v/z7+3/7+vp/+7q6P/w7Or/9PDu//j08v/69vT/+PTy//Ht6//m4uD/2dXT/83Ixv/Ev73/wLy6/8O+vP/KxsT/1tLQ/+Le3P/t6ef/9fHv//r29P/79/X/+/f1//r29P/69vT/+/f1//359///+/n///z6/wCBAH7/AP/7+f/8+Pb/9/Px//Ht6//t6ef/7Ojm/+3p5//x7ev/9fHv//by8P/08O7/7enn/+Le3P/U0M7/yMTC/7+7uf+8t7X/vrq4/8fCwP/Szsz/39vZ/+vn5f/z7+3/+PTy//n18//59fP/+fXz//n18//69vT//Pj2//76+P///Pr/AIEAfv8A//v5//z49v/38vD/8e3r/+3p5//r5+X/7enn//Ht6//08O7/9vLw//Pv7f/s6Ob/4d3b/9TQzv/Hw8H/vrq4/7u3tf++urj/xsLA/9LOzP/f29n/6+fl//Pv7f/49PL/+vb0//r29P/59fP/+fXz//r29P/8+Pb//vr4///7+f8AgQB+/wD//Pr//fn3//j08f/y7uz/7uro/+3p5//v6+n/8+/t//fz8f/49PL/9vLw/+/r6f/k4N7/19LQ/8rGxP/Bvbv/vrq4/8G9u//JxcP/1dHP/+Le3P/u6uj/9vLw//v39f/8+Pb//Pj2//v39f/69vT/+/f1//359///+/n///z6/wCBAH7/AP/+/P//+/n/+vbz//Tw7v/x7ev/8Ozq//Lu7P/38/H/+/f1//359//79/X/9PDu/+nl4//c2Nb/0MzK/8fDwf/EwL7/x8PB/8/Lyf/b19X/6OTi//Pv7f/79/X///v5///8+v//+/n//fn3//z49v/9+ff//vr4///8+v///fv/AIEAfv8A///+///9+//8+Pb/9/Px//Tw7v/08O7/9/Px//z49v///fv////9///+/P/79/X/8e3r/+Tg3v/Y1NL/z8vJ/8zIxv/Py8n/19PR/+Pf3f/v6+n/+vb0///9+////////////////f///fv///v5///7+f///Pr///37///+/P8AgQB+/wD////////9///7+f/69vT/+PPx//j08v/79/X///37///////////////////+/P/49PL/7Ojm/+Dc2v/X09H/1NDO/9fT0f/f29n/6ubk//by8P///fr//////////////////////////v///vz///37///+/P///vz////9/wCBAH7/AP////////////37//359//69vT/+/f1///7+f////////////////////////////76+P/y7uz/5uLg/97a2P/b19X/3tnX/+Xh3//w7Or//Pj2/////////////////////////////////////v////3////9/////v////7/AYEAfv8A/////////////vz//vr4//z49v/9+ff///37//////////////////////////////78//by8P/q5uT/4t7c/97a2P/h3dv/6eXj//Tw7v//+/n//////////////////////////////////////////v////7////+///////ai66uLgGkDwAAAABJRU5ErkJggg==" data-src="/assets/image-20231222205100688.BDyY16vp.png" loading="lazy" alt="" width="1484" height="562" style="aspect-ratio:1484 / 562;"><!--]--></p></li><li><p>特点</p><p>数据库加全局锁，是一个比较重的操作，存在以下问题：</p><ol><li>如果在主库上备份，那么在备份期间都不能执行更新，业务基本上就得停摆。</li><li>如果在从库上备份，那么份期间从库不能执行主库同步过来的二进制日志(binlog)，会导致主从延迟。</li></ol><p>在InnoDB引擎中，我们可以在备份时加上参数 --single-transaction 参数完成不加锁的一致性数据备份。</p></li></ul><h3 id="表级锁" tabindex="-1">表级锁 <a class="header-anchor" href="#表级锁" aria-label="Permalink to &#x22;表级锁&#x22;">​</a></h3><ul><li><p><strong>介绍</strong></p><p>表级锁，每次操作锁住整张表。锁定粒度大，发生锁冲突的概率最高，并发度最低。应用在MylSAM、lnnoDB、BDB等存储引擎中。</p><p>对于表级锁，主要分为以下三类：</p><ol><li>表锁</li><li>元数据锁（meta data lock，MDL）</li><li>意向锁</li></ol></li><li><p>表锁</p><p>对于表锁，分为两类：</p><ol><li>表共享读锁（read lock）</li><li>表独占写锁（write lock）</li></ol><p>语法：</p><ol><li>加锁：lock tables 表名... read/write。</li><li>释放锁：unlock tables/客户端断开连接。</li></ol><p><strong>读锁不会阻塞其他客户端的读，但是会阻塞写。写锁既会阻塞其他客户端的读，又会阻塞其他客户端的写。</strong></p></li><li><p>元数据项（meta data lock，MDL）</p><p>MDL加锁过程是系统自动控制，无需显式使用，在访问一张表的时候会自动加上。MDL锁主要作用是维护表元数据的数据一致性，在表上有活动事务的时候，不可以对元数据进行写入操作。<strong>为了避免DML与DDL冲突，保证读写的正确性。</strong></p><p>在MySQL5.5中引入了MDL，当对一张表进行增删改查的时候，加MDL读锁(共享)；当对表结构进行变更操作的时候，加MDL写锁（排他）。</p><table><thead><tr><th style="text-align:center;">对应SQL</th><th style="text-align:center;">锁类型</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">lock tables xxx read/write</td><td style="text-align:center;">SHARED_READ_ONLY/SHARE_NO_READ_WRITE</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">selet、select...lock in share mode</td><td style="text-align:center;">SHARED_READ</td><td style="text-align:center;">与SHARED_READ、SHARED_WRITE兼容，与EXCLUSIVE互斥</td></tr><tr><td style="text-align:center;">insert、update、delete、select...for update</td><td style="text-align:center;">SHARED_WRITE</td><td style="text-align:center;">与SHARED_READ，SHARED_WRITE兼容，与EXCLUSIVE互斥</td></tr><tr><td style="text-align:center;">alter table ...</td><td style="text-align:center;">EXCLUSIVE</td><td style="text-align:center;">与其他的MDL都互斥</td></tr></tbody></table><p>查看元数据锁：</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>select object_type,object_schema,object_name,lock_type,lock_duration from performance_schema.metadata_locks;</span></span></code></pre></div></li><li><p>意向锁</p><p>为了避免DML在执行时，加的行锁与表锁的冲突，在InnoDB中引入了意向锁，使得表锁不用检查每行数据是否加锁，使用意向锁来减少表锁的检查。</p><ol><li><p>意向共享锁（IS）：由语句select....lock in share mode添加。</p></li><li><p>意向排他锁（IX）：由insert、update、delete、select... for update添加。</p></li><li><p>意向共享锁（IS）：与表锁共享锁（read）兼容，与表锁排它锁（write）互斥。</p></li><li><p>意向排他锁（IX）：与表锁共享锁（read）及排他锁（write）都互斥。意向锁之间不会互斥。</p></li></ol><p>可以通过以下SQL，查看意向锁及行锁的加锁情况：</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>select object_schema,object_name,index_name,lock_type,lock_mode,lock_data from performance_schema.data_locks;</span></span></code></pre></div></li></ul><h3 id="行级锁" tabindex="-1">行级锁 <a class="header-anchor" href="#行级锁" aria-label="Permalink to &#x22;行级锁&#x22;">​</a></h3><ul><li><p><strong>介绍</strong></p><p>行级锁，每次操作锁住对应的行数据。锁定粒度最小，发生锁冲突的概率最低，并发度最高。应用在InnoDB存储引擎中。</p><p>InnoDB的数据是基于索引组织的，行锁是通过对索引上的索引项加锁来实现的，而不是对记录加的锁。对于行级锁，主要分为以下三类：</p><ol><li>行锁（Record Lock）：锁定单个行记录的锁，防止其他事务对此行进行update和delete。在RC、RR隔离级别下都支持。</li><li>间隙锁（Gap Lock）：锁定索引记录间隙（不含该记录），确保索引记录间隙不变，防止其他事务在这个间隙进行insert，产生幻读。在RR隔离级别下都支持。</li><li>临键锁（Next-Key Lock）：行锁和间隙锁组合，同时锁住数据，并锁住数据前面的间隙Gap。在RR隔离级别下支持。</li></ol></li><li><p>行锁</p><p>InnoDB实现了以下两种类型的行锁：</p><ol><li>共享锁（S）：允许一个事务去读一行，阻止其他事务获得相同数据集的排它锁。</li><li>排他锁（X）：允许获取排他锁的事务更新数据，阻止其他事务获得相同数据集的共享锁和排他锁。</li></ol><table><thead><tr><th style="text-align:center;">当前锁类型\请求锁类型</th><th style="text-align:center;">S（共享锁）</th><th style="text-align:center;">X（排他锁）</th></tr></thead><tbody><tr><td style="text-align:center;">S（共享锁）</td><td style="text-align:center;">兼容</td><td style="text-align:center;">冲突</td></tr><tr><td style="text-align:center;">X（排他锁）</td><td style="text-align:center;">冲突</td><td style="text-align:center;">冲突</td></tr></tbody></table><table><thead><tr><th style="text-align:center;">SQL</th><th style="text-align:center;">行锁类型</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">INSERT...</td><td style="text-align:center;">排他锁</td><td style="text-align:center;">自动加锁</td></tr><tr><td style="text-align:center;">UPDATE...</td><td style="text-align:center;">排他锁</td><td style="text-align:center;">自动加锁</td></tr><tr><td style="text-align:center;">DELETE...</td><td style="text-align:center;">排他锁</td><td style="text-align:center;">自动加锁</td></tr><tr><td style="text-align:center;">SELECT（正常）</td><td style="text-align:center;"><strong>不加任何锁</strong></td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">SELECT...LOCK IN SHARE MODE</td><td style="text-align:center;">共享锁</td><td style="text-align:center;">需要手动在SELECT之后加LOCK IN SHARE MODE</td></tr><tr><td style="text-align:center;">SELECT...FOR UPDATE</td><td style="text-align:center;">排他锁</td><td style="text-align:center;">需要手动在SELECT之后加FOR UPDATE</td></tr></tbody></table></li><li><p>行锁-演示</p><p>默认情况下，lnnoDB在REPEATABLE READ事务隔离级别运行，lnnoDB使用next-key锁进行搜索和索引扫描以防止幻读。</p><ol><li>针对唯一索引进行检索时，对已存在的记录进行等值匹配时，将会自动优化为行锁。</li><li>InnoDB的行锁是针对于索引加的锁，不通过索引条件检索数据，那么InnoDB将对表中的所有记录加锁，此时<strong>就会升级为表锁</strong>。</li></ol><p>可以通过以下SLQ，查看意向锁及行锁的加锁情况：</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>select object_schema,object_name,index_name,lock_type,lock_mode,lock_data from performance_schema.data_locks;</span></span></code></pre></div></li><li><p>间隙锁/临键锁-演示</p><p>默认情况下，InnoDB在REPEATABLE READ事务隔离级别运行，InnoDB使用next-key锁进行搜索和索引扫描/以防止幻读。</p><ol><li>索引上的等值查询（唯一索引)，给不存在的记录加锁时优化为间隙锁。</li><li>索引上的等值查询（普通索弓l)，向右遍历时最后一个值不满足查询需求时，next-key lock退化为间隙锁。</li><li>索引上的范围查询（唯一索弓l)--会访问到不满足条件的第一个值为止。</li></ol><p><strong>注意：间隙锁唯一目的是防止其他事务插入间隙。间隙锁可以共存，一个事务采用的间隙锁不会阻止另一个事务在同一个间隙上采用间隙锁。</strong></p></li></ul><h2 id="innodb引擎" tabindex="-1">InnoDB引擎 <a class="header-anchor" href="#innodb引擎" aria-label="Permalink to &#x22;InnoDB引擎&#x22;">​</a></h2><h3 id="逻辑存储结构" tabindex="-1">逻辑存储结构 <a class="header-anchor" href="#逻辑存储结构" aria-label="Permalink to &#x22;逻辑存储结构&#x22;">​</a></h3><p><!--[--><img class="nolebase-enhanced-img absolute inset-0 z-1 bg-black/10" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAOCAYAAABO3B6yAAAHWklEQVR4AQCBAH7/AOLguf/l4rz/6ebB/+3ryP/x8M//9PPV//X02f/09N3/8vLf/+/w4P/t7uL/6+3l/+vu6f/r7+7/7PDy/+3y9v/s8vj/6/H5/+nv+f/n7ff/5ez2/+Tr9f/k6/X/5u33/+nw+f/s9Pz/8Pj///P7///2/f//9/////j////5////AIEAfv8A4d62/+Pguf/n5L7/7OnF//DuzP/z8dL/9PLX//Py2v/x8Nz/7u7d/+vs3//q6+L/6evm/+rt6//r7u//7O/z/+vv9f/q7/b/6O32/+br9P/k6fP/4+jy/+Pp8v/l6/T/6O72/+zx+f/v9fz/8/n+//X7///3/f//+P7///j+//8AgQB+/wDf2rH/4dy0/+Xguf/p5cD/7urH//Dtzf/x7tH/8O7U/+7s1v/r6tj/6eja/+fn3f/n5+H/6Ojl/+nq6f/p6+3/6evw/+jq8P/m6PD/5Obu/+Lk7f/h5Oz/4eTs/+Pm7v/m6fD/6u3z/+7x9v/y9Pn/9Pf7//b5/P/3+vz/+Pr9/wCBAH7/ANvVqv/d2K3/4dyz/+Xhuf/q5cD/7OjG/+3pyv/s6c3/6ufP/+fl0f/l49P/5OLW/+Ti2v/k497/5uTi/+bl5v/m5uj/5eXp/+Pj6f/h4ef/39/m/97e5f/f3uX/4eDn/+Tj6f/o5+z/7evv//Dv8v/z8vT/9fP1//b19v/39fb/AIEAfv8A1tGj/9jTpv/c16z/4Nyy/+Tguf/n47//6OTD/+fjxv/l4sj/49/K/+DdzP/f3M//393T/+De1//i39v/4uDf/+Pg4f/i3+L/4N3h/97b4P/c2d7/29jd/9zY3v/e2t//4t3i/+bh5f/q5uj/7unr//Hs7f/07u//9e/v//Xw8P8AgQB+/wDPzJ3/0c+g/9XSpv/a16z/3tuz/+Heuf/i373/4d/A/9/dwv/d28T/29nG/9rYyf/a2M3/29nR/93a1f/e29n/3tvb/93a3P/b2Nv/2dba/9jT2P/X0tf/2NPX/9vV2f/e2Nv/49zf/+jh4v/s5OX/7+fo//Lq6f/z6+r/9Ozr/wCBAH7/AMfJmf/Jy5z/zc+h/9LUqP/W2K7/2du0/9rcuf/a3Lz/2Nq+/9bYwP/U1sL/1NXF/9TVyf/W1s3/19jS/9nY1f/Z2Nj/2dfY/9fV1//V0tb/09DU/9PP0//Uz9P/19HV/9vV1//f2dv/5N3f/+nh4v/t5OT/7+fm//Ho5//y6ef/AIEAfv8AvsiX/8HKmv/Ezp//ydKm/83XrP/R2bL/0tu3/9Lauv/Q2Lz/z9a+/83VwP/N1MT/ztTI/9DWzP/S19H/09jV/9TY1//U1tf/0tTW/9DR1f/Pz9P/zs3S/9DO0v/S0NP/19PW/9zX2v/h3N3/5uDh/+rj5P/s5uX/7ufm/+/o5/8AgQB+/wC1yJf/t8qa/7vOn//A0qb/xdet/8jas//J27f/ytu7/8jZvf/H17//xtbC/8bVxf/I1sr/ytfO/8zZ0//O2df/z9nZ/8/Y2f/N1dj/zNLW/8rQ1f/KztP/y8/T/87R1f/T1Nj/2Njb/93d3//i4eP/5uXm/+nn6P/r6en/7Onp/wCBAH7/AKzJmf+uy5z/ss+h/7fUqP+82K//v9y1/8Hduv/C3b3/wdvA/8Daw//A2cX/wNjJ/8LZzv/E2tP/x9zX/8nd2//K3d3/ytve/8nZ3f/H1tv/xtPZ/8bR1//H0df/ytPZ/8/X3P/U29//2uDj/9/k5//j5+r/5urs/+js7f/p7O7/AIEAfv8Ao8yd/6bOoP+q0qX/r9es/7Tbs/+33rn/uuC+/7rgwv+638X/ud3H/7ncyv+63M7/vd3T/7/f2P/D4N3/xeHh/8bh4//G4OT/xd3j/8Ta4f/C197/wtXd/8TV3f/H197/y9rh/9Hf5f/X4+n/3Ojs/+Dr7//k7vL/5vDz/+fw8/8AgQB+/wCczqD/n9Gj/6PVqf+o2bD/rd63/7Hhvf+z48L/tOPG/7Tiyf+04cz/tODP/7bg1P+44tn/u+Pe/7/l4//B5uf/w+bp/8Pk6v/C4un/wN7n/7/b5P+/2uP/wdnj/8Tb5P/J3uf/zuPq/9Tn7v/Z7PL/3u/1/+Hy9//j9Pn/5PX5/wCBAH7/AJfRpP+Z06f/ntes/6Pcs/+o4Lr/rOTA/6/mxv+w5sr/sOXN/7Dk0P+x5NT/suTY/7Xl3f+55+P/vOno/7/q7P/B6u7/wejv/8Dl7v++4uv/vd/p/73d6P+/3ef/wt/p/8fi6//M5u//0uvz/9jv9//c8/r/4PX8/+L3/f/j+P7/AYEAfv8AlNKl/5fUqP+b2K7/oN21/6bivP+q5cL/rOfI/67ozP+u58//rubS/6/l1v+x5tv/tOfg/7fp5f+76+v/vuzv/7/s8f/A6vH/v+fw/73k7v+84ez/vN/q/77f6v/B4Ov/xuTu/8vo8v/R7Pb/1/H5/9v1/P/f9///4fn//+L6//+0lzdWrPECTAAAAABJRU5ErkJggg==" width="1506" height="644" style="aspect-ratio:1506 / 644;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAOCAYAAABO3B6yAAAHWklEQVR4AQCBAH7/AOLguf/l4rz/6ebB/+3ryP/x8M//9PPV//X02f/09N3/8vLf/+/w4P/t7uL/6+3l/+vu6f/r7+7/7PDy/+3y9v/s8vj/6/H5/+nv+f/n7ff/5ez2/+Tr9f/k6/X/5u33/+nw+f/s9Pz/8Pj///P7///2/f//9/////j////5////AIEAfv8A4d62/+Pguf/n5L7/7OnF//DuzP/z8dL/9PLX//Py2v/x8Nz/7u7d/+vs3//q6+L/6evm/+rt6//r7u//7O/z/+vv9f/q7/b/6O32/+br9P/k6fP/4+jy/+Pp8v/l6/T/6O72/+zx+f/v9fz/8/n+//X7///3/f//+P7///j+//8AgQB+/wDf2rH/4dy0/+Xguf/p5cD/7urH//Dtzf/x7tH/8O7U/+7s1v/r6tj/6eja/+fn3f/n5+H/6Ojl/+nq6f/p6+3/6evw/+jq8P/m6PD/5Obu/+Lk7f/h5Oz/4eTs/+Pm7v/m6fD/6u3z/+7x9v/y9Pn/9Pf7//b5/P/3+vz/+Pr9/wCBAH7/ANvVqv/d2K3/4dyz/+Xhuf/q5cD/7OjG/+3pyv/s6c3/6ufP/+fl0f/l49P/5OLW/+Ti2v/k497/5uTi/+bl5v/m5uj/5eXp/+Pj6f/h4ef/39/m/97e5f/f3uX/4eDn/+Tj6f/o5+z/7evv//Dv8v/z8vT/9fP1//b19v/39fb/AIEAfv8A1tGj/9jTpv/c16z/4Nyy/+Tguf/n47//6OTD/+fjxv/l4sj/49/K/+DdzP/f3M//393T/+De1//i39v/4uDf/+Pg4f/i3+L/4N3h/97b4P/c2d7/29jd/9zY3v/e2t//4t3i/+bh5f/q5uj/7unr//Hs7f/07u//9e/v//Xw8P8AgQB+/wDPzJ3/0c+g/9XSpv/a16z/3tuz/+Heuf/i373/4d/A/9/dwv/d28T/29nG/9rYyf/a2M3/29nR/93a1f/e29n/3tvb/93a3P/b2Nv/2dba/9jT2P/X0tf/2NPX/9vV2f/e2Nv/49zf/+jh4v/s5OX/7+fo//Lq6f/z6+r/9Ozr/wCBAH7/AMfJmf/Jy5z/zc+h/9LUqP/W2K7/2du0/9rcuf/a3Lz/2Nq+/9bYwP/U1sL/1NXF/9TVyf/W1s3/19jS/9nY1f/Z2Nj/2dfY/9fV1//V0tb/09DU/9PP0//Uz9P/19HV/9vV1//f2dv/5N3f/+nh4v/t5OT/7+fm//Ho5//y6ef/AIEAfv8AvsiX/8HKmv/Ezp//ydKm/83XrP/R2bL/0tu3/9Lauv/Q2Lz/z9a+/83VwP/N1MT/ztTI/9DWzP/S19H/09jV/9TY1//U1tf/0tTW/9DR1f/Pz9P/zs3S/9DO0v/S0NP/19PW/9zX2v/h3N3/5uDh/+rj5P/s5uX/7ufm/+/o5/8AgQB+/wC1yJf/t8qa/7vOn//A0qb/xdet/8jas//J27f/ytu7/8jZvf/H17//xtbC/8bVxf/I1sr/ytfO/8zZ0//O2df/z9nZ/8/Y2f/N1dj/zNLW/8rQ1f/KztP/y8/T/87R1f/T1Nj/2Njb/93d3//i4eP/5uXm/+nn6P/r6en/7Onp/wCBAH7/AKzJmf+uy5z/ss+h/7fUqP+82K//v9y1/8Hduv/C3b3/wdvA/8Daw//A2cX/wNjJ/8LZzv/E2tP/x9zX/8nd2//K3d3/ytve/8nZ3f/H1tv/xtPZ/8bR1//H0df/ytPZ/8/X3P/U29//2uDj/9/k5//j5+r/5urs/+js7f/p7O7/AIEAfv8Ao8yd/6bOoP+q0qX/r9es/7Tbs/+33rn/uuC+/7rgwv+638X/ud3H/7ncyv+63M7/vd3T/7/f2P/D4N3/xeHh/8bh4//G4OT/xd3j/8Ta4f/C197/wtXd/8TV3f/H197/y9rh/9Hf5f/X4+n/3Ojs/+Dr7//k7vL/5vDz/+fw8/8AgQB+/wCczqD/n9Gj/6PVqf+o2bD/rd63/7Hhvf+z48L/tOPG/7Tiyf+04cz/tODP/7bg1P+44tn/u+Pe/7/l4//B5uf/w+bp/8Pk6v/C4un/wN7n/7/b5P+/2uP/wdnj/8Tb5P/J3uf/zuPq/9Tn7v/Z7PL/3u/1/+Hy9//j9Pn/5PX5/wCBAH7/AJfRpP+Z06f/ntes/6Pcs/+o4Lr/rOTA/6/mxv+w5sr/sOXN/7Dk0P+x5NT/suTY/7Xl3f+55+P/vOno/7/q7P/B6u7/wejv/8Dl7v++4uv/vd/p/73d6P+/3ef/wt/p/8fi6//M5u//0uvz/9jv9//c8/r/4PX8/+L3/f/j+P7/AYEAfv8AlNKl/5fUqP+b2K7/oN21/6bivP+q5cL/rOfI/67ozP+u58//rubS/6/l1v+x5tv/tOfg/7fp5f+76+v/vuzv/7/s8f/A6vH/v+fw/73k7v+84ez/vN/q/77f6v/B4Ov/xuTu/8vo8v/R7Pb/1/H5/9v1/P/f9///4fn//+L6//+0lzdWrPECTAAAAABJRU5ErkJggg==" data-src="/assets/Logical_storage_structure.B6ySlM50.jpg" loading="lazy" alt="" width="1506" height="644" style="aspect-ratio:1506 / 644;"><!--]--></p><p>表空间（ibd文件），一个mysql实例可以对应多个表空间，用于存储记录、索引等数据。</p><p>段，分为数据段（Leaf node segment）、索引段（Non-leaf node segment）、回滚段（Rollback segment），InnoDB是索引组织表，数据段就是B+树的叶子节点，索引段即为B+树的非叶子节点。段用来管理多个Extent（区）。</p><p>区，表空间的单元结构，每个 区的大小为1M。默认情况下，InnoDB存储引擎页大小为16K，即一个区中一共有64个连续的页。</p><p>页，是InnoDB存储引擎磁盘管理的最小单元，每个页的大小默认为16KB。为了保证页的连续性，InnoDB存储引擎每次从磁盘申请4-5个区。</p><p>行，InnoDB存储引擎数据是按行进行存放的。（Trx_id：每次对某条记录进行改动时，都会把对应的事务id赋值给trx_id隐藏列。 Roll_pointer：每次对某条引记录进行改动时，都会把旧的版本写入到undo日志中，然后这个隐藏列就相当于一个指针，可以通过它来找到该记录修改前的信息。）</p><h3 id="架构" tabindex="-1">架构 <a class="header-anchor" href="#架构" aria-label="Permalink to &#x22;架构&#x22;">​</a></h3><p>MySQL5.5版本开始，默认使用InnoDB存储引擎，它擅长事务处理，具有崩溃恢复特性，在日常开发中使用非常广泛。下面是InnoDB架构图，左侧为内存结构，右侧为磁盘结构。</p><p><!--[--><img class="nolebase-enhanced-img absolute inset-0 z-1 bg-black/10" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAXCAYAAABqBU3hAAAMEElEQVR4AQCBAH7/AOfr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/AIEAfv8A5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f8AgQB+/wDn6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/wCBAH7/AOfr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/AIEAfv8A5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f8AgQB+/wDn6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/wCBAH7/AOfr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/AIEAfv8A5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f8AgQB+/wDn6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/wCBAH7/AOfr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/AIEAfv8A5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f8AgQB+/wDn6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/wCBAH7/AOfr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/AIEAfv8A5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f8AgQB+/wDn6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/wCBAH7/AOfr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/AIEAfv8A5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f8AgQB+/wDn6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/wCBAH7/AOfr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/AIEAfv8A5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f8AgQB+/wDn6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/wCBAH7/AOfr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/AYEAfv8A5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/ybMLXpS4j0wAAAABJRU5ErkJggg==" width="971" height="689" style="aspect-ratio:971 / 689;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAXCAYAAABqBU3hAAAMEElEQVR4AQCBAH7/AOfr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/AIEAfv8A5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f8AgQB+/wDn6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/wCBAH7/AOfr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/AIEAfv8A5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f8AgQB+/wDn6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/wCBAH7/AOfr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/AIEAfv8A5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f8AgQB+/wDn6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/wCBAH7/AOfr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/AIEAfv8A5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f8AgQB+/wDn6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/wCBAH7/AOfr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/AIEAfv8A5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f8AgQB+/wDn6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/wCBAH7/AOfr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/AIEAfv8A5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f8AgQB+/wDn6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/wCBAH7/AOfr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/AIEAfv8A5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f8AgQB+/wDn6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/wCBAH7/AOfr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/AYEAfv8A5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/n6+3/5+vt/+fr7f/ybMLXpS4j0wAAAABJRU5ErkJggg==" data-src="/assets/image-20231223130347131.DHahC9M1.png" loading="lazy" alt="" width="971" height="689" style="aspect-ratio:971 / 689;"><!--]--></p><p>Buffer Pool：缓冲池是主内存中的一个区域，里面可以缓存磁盘上经常操作的真实数据，在执行增删改查操作时，先操作缓冲池的数据（若缓冲池没有数据，则从磁盘加载并缓存），然后再以一定频率刷新到磁盘，从而减少磁盘IO，加快处理速度。</p><p>缓冲池以Page页为单位，底层采用链表数据结构管理Page。根据状态，将Page分为三种类型：</p><ul><li>free page：空闲page，未被使用。</li><li>clean page：被使用page，数据没有被修改过。</li><li>dirty page：脏页，被使用page，数据被修改过，页中数据与磁盘的数据产生了不一致。</li></ul><h3 id="内存结构" tabindex="-1">内存结构 <a class="header-anchor" href="#内存结构" aria-label="Permalink to &#x22;内存结构&#x22;">​</a></h3><p>Change Buffer：更改缓冲区（针对于非唯一二级索引页），在执行DML语句时，如果这些数据Page没有在Buffer Pool中，不会直接操作磁盘，而会将数据变更存在更改缓冲区Change Buffer中，在未来数据被读取时，再将数据合并恢复到Buffer Pool中，再将合并后的数据刷新到磁盘中。</p><p><strong>Change Buffer的意义是什么？</strong></p><p>与聚集索引不同，二级索引通常是非唯一的，并且以相对随机的顺序插入二级索引。同样，删除和更新可能会影响索引树中不相邻的二级索引页，如果每一次都操作磁盘，会造成大量的磁盘IO。有了Change Buffer之后，我们可以在缓冲池中进行合并处理，减少磁盘IO。</p><p>Adaptive Hash Index；自适应hash索引，用于优化对Buffer Pool数据的查询。InnoDB存储引擎会监控对表上各索引页的查询，如果观察到hash索引可以提升速度，则建立hash索引，称之为自适应hash索引。</p><p><strong>自适应哈希索引，无人工干预，是系统根据情况自动完成。</strong></p><p>参数：adaptive_hash_index</p><p>Log Buffer：日志缓冲区，用来保存要写入到磁盘中的log日志数（redolog、undolog），默认大小为16MB，日志缓冲区的日志会定期刷新到磁盘中。如果需要更新、插入或删除许多行的事务，增加日志缓冲区的大小可以节省磁盘I/0。</p><p>参数：</p><p>innodb_log_buffersize：缓冲区大小innodb_flush_log_at_trx_commit：日志刷新到磁盘时机（1：日志在每次事务提交时写入并刷新到磁盘</p><p>0：每秒将日志写入并刷新到磁盘一次。</p><p>2：日志在每次事务提交写入，并每秒刷新到磁盘一次。）</p><h3 id="磁盘结构" tabindex="-1">磁盘结构 <a class="header-anchor" href="#磁盘结构" aria-label="Permalink to &#x22;磁盘结构&#x22;">​</a></h3><p>System Tablespace：系统表空间是更改缓冲区的存储区域。如果表是在系统表空间而不是每个表文件或通用表空间中创建的，它也可能包含表和索引数据。（在MySQL5.x版本中还包含InnoDB数据字典、undolog等）</p><p>参数：innodb_data_file_path</p><p>File-Per-Table Tablespaces：每个表的文件表空间包含单个InnoDB表的数据和索引，并存储在文件系统上的单个数据文件中。</p><p>参数：innodb_file_per_table</p><p>General Tablespaces：通用表空间，需要通过CREATE TABLESPACE语法创建通用表空间，在创建表时，可以指定该表空间。</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>-- General Tablespace</span></span>
<span class="line"><span>CREATE TABLESPACE xxxx ADD DATAFILE 'file_name' ENGINE = engine_name;</span></span>
<span class="line"><span>-- 创建表</span></span>
<span class="line"><span>CREATE TABLE xxx ... TABLESPACE ts_name;</span></span></code></pre></div><p>Undo Tablespaces：撤销表空间，MySQL实例在初始化时会自动创建两个默认的undo表空间（初始大小16M），用于存储undo log日志。</p><p>Temporary Tablespaces：InnoDB使用会话临时表空间和全局临时表空间。存储用户创建的临时表等数据。</p><p>Doublewrite Buffer Files：双写缓冲区，InnoDB引擎将数据页从Buffer Pool刷新到磁盘前，先将数据页写入双写缓冲区文件中，便于系统异常时恢复数据。</p><p>Redo Log：重做日志，是用来实现事务的持久性。该日志文件由两部分组成：重做日志缓冲（redo log buffer）以及重做日志文件（redo log），前者是在内存中，后者在磁盘中。当事务提交之后会把所有修改信息都会存到该日志中，用于在刷新脏页到磁盘时，发生错误时，进行数据恢复使用。</p><p>以循环方式写入重做日志文件，涉及两个文件：ib_logfile0、ib_logfile1</p><h3 id="后台线程" tabindex="-1">后台线程 <a class="header-anchor" href="#后台线程" aria-label="Permalink to &#x22;后台线程&#x22;">​</a></h3><ol><li><p><strong>Master Thread</strong></p><p>核心后台线程，负责调度其他线程，还负责将缓冲池中的数据异步刷新到磁盘中，保持数据的一致性，还包括脏页的刷新、合并插入缓存、undo页的回收。</p></li><li><p><strong>IO Thread</strong></p><p>在InnoDB存储引擎中大量使用了AIO来处理IO请求，这样可以极大地提高数据库的性能，而IO Thread主要负责这些IO请求的回调。</p><table><thead><tr><th style="text-align:center;">线程类型</th><th style="text-align:center;">默认个数</th><th style="text-align:center;">职责</th></tr></thead><tbody><tr><td style="text-align:center;">Read thread</td><td style="text-align:center;">4</td><td style="text-align:center;">负责读操作</td></tr><tr><td style="text-align:center;">Write thread</td><td style="text-align:center;">4</td><td style="text-align:center;">负责写操作</td></tr><tr><td style="text-align:center;">Log thread</td><td style="text-align:center;">1</td><td style="text-align:center;">负责将日志缓冲刷新到磁盘</td></tr><tr><td style="text-align:center;">Insert buffer thread</td><td style="text-align:center;">1</td><td style="text-align:center;">负责将写缓冲区内容刷新到磁盘</td></tr></tbody></table></li><li><p><strong>Purge Thread</strong></p><p>主要用于回收事务已经提交了的undo log，在事务提交之后，undo log可能不用了，就用它来回收。</p></li><li><p><strong>Page Cleaner Thread</strong></p><p>协助Master Thread刷新脏页到磁盘的线程，它可以减轻Master Thread的工作压力，减少阻塞。</p></li></ol><h3 id="事务原理" tabindex="-1">事务原理 <a class="header-anchor" href="#事务原理" aria-label="Permalink to &#x22;事务原理&#x22;">​</a></h3><ul><li><p>事务</p><p>事务是一组操作的集合，它是一个不可分割的工作单位，事务会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功/要么同时失败。</p></li><li><p>特性</p><ul><li>原子性（Atomicity）：事务是不可分割的最小单元，要么全部成功，要么全部失败。</li><li>一致性（Consistency）：事务完成时，必须使所有的数据都保持一致状态。</li><li>隔离性（Isolation）：数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行。</li><li>持久性（Durabillity）：事务一旦提交或回滚，它对数据库中的数据的改变就是永久的。</li></ul></li><li><p>redo log</p><p>重做日志，记录的是事务提交时数据页的物理修改，是用来实现事务的持久性。</p><p>该日志文件由两部分组成：重做日志缓冲（redo log buffer)以及重做日志文件(redo log file），前者是在内存中，后者在磁盘中。当事务提交之后会把所有修改信息都存到该日志文件中，用于在刷新脏页到磁盘/发生错误时，进行数据恢复使用。</p></li></ul><p><!--[--><img class="nolebase-enhanced-img absolute inset-0 z-1 bg-black/10" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAJCAYAAABT2S4KAAAEvElEQVR4AQCBAH7/APj0///59f//+/f///35////+/////3////+/////v////z9//359//49PD/8u7o/+zo4f/n49n/4t7T/97az//c18z/2tbL/9rWy//a1sz/29fO/9zY0P/e2tP/4NzX/+Pf2//n4+H/7Ojo//Ht7//38/b//Pj8///8////////AIEAfv8A+fX+//r2///8+P///vr////8/////v///////////f///fn//fnz//j07P/z7+T/7end/+fj1v/i3tD/39vL/9zYyP/b18f/29fH/9vXyP/c2Mr/3dnM/9/az//h3NP/49/X/+fj3f/s6OP/8u7q//fz8f/9+fj///38//////8AgQB+/wD8+Pr//fn7//76+////Pz///78/////P////r////4///98//++u3/+fXm//Pv3//u6df/6OTQ/+Pfyv/g3Mb/3trD/93Zwv/d2cL/3dnD/97axf/f28f/4NzK/+Lezf/l4NL/6OTX/+3p3f/y7uT/+PTr//358f///fb////4/wCBAH7/AP/7+P//+/j///35///++f////n////4////9v////P///7u//766P/69uH/9PDa/+/r0//q5cz/5eHG/+Lewv/g3MD/39u//9/bv//g3MD/4NzC/+HdxP/i3sb/5ODJ/+bizf/q5tL/7urY//Pv3//59eX//vrr///+8P////L/AIEAfv8A//35///9+f///vn////5////+f////f////1////8v///u3///vn//r24P/18dn/8OzS/+vnzP/o5Mf/5eHD/+Pfwf/j38D/49/A/+Pfwf/k4MP/5eHE/+Xhx//n48n/6eXN/+zo0f/w7Nf/9fDd//r25P//++n///7u////8P8AgQB+/wD//v3///79/////f////3////8////+/////j////1///+8P//++v/+/fk//by3f/y7tf/7urR/+rmzP/o5Mn/5+PH/+fjx//n48f/6OTI/+jkyf/o5Mr/6eXM/+rmzv/r59H/7urW//Ht2//28uD/+/fn///77P////D////z/wCBAH7/AP/+/////v////////////////////////////////v///73///78f/89+v/9/Pl//Pv3//w7Nn/7enV/+zo0v/r59H/6+fR/+vn0f/s6NL/7OjT/+zo1P/s6NX/7enX/+7q2v/w7N3/8+/i//fz5//8+O3///zy////9v////n/AIEAfv8A//3////+/////v///////////////////////////////v7///v4//z48//49O3/9fHn//Lu4v/w697/7urc/+7q2//u6tv/7+vb/+/r3P/v693/7+ve/+/r3//v6+D/8Ozi//Ht5v/08Or/+PTv//z49P///fn////9//////8BgQB+/wD//f////3////+///////////////////////////////+////+/3//Pj3//n18v/18ez/8+/o//Ht5P/w7OL/8Ozh//Ds4f/w7OL/8e3i//Ht4//x7eT/8Ozl//Ds5v/x7ej/8u7r//Xx7//59fT//fn5///9/v///////////5jVQNEW4pAgAAAAAElFTkSuQmCC" width="1430" height="444" style="aspect-ratio:1430 / 444;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAJCAYAAABT2S4KAAAEvElEQVR4AQCBAH7/APj0///59f//+/f///35////+/////3////+/////v////z9//359//49PD/8u7o/+zo4f/n49n/4t7T/97az//c18z/2tbL/9rWy//a1sz/29fO/9zY0P/e2tP/4NzX/+Pf2//n4+H/7Ojo//Ht7//38/b//Pj8///8////////AIEAfv8A+fX+//r2///8+P///vr////8/////v///////////f///fn//fnz//j07P/z7+T/7end/+fj1v/i3tD/39vL/9zYyP/b18f/29fH/9vXyP/c2Mr/3dnM/9/az//h3NP/49/X/+fj3f/s6OP/8u7q//fz8f/9+fj///38//////8AgQB+/wD8+Pr//fn7//76+////Pz///78/////P////r////4///98//++u3/+fXm//Pv3//u6df/6OTQ/+Pfyv/g3Mb/3trD/93Zwv/d2cL/3dnD/97axf/f28f/4NzK/+Lezf/l4NL/6OTX/+3p3f/y7uT/+PTr//358f///fb////4/wCBAH7/AP/7+P//+/j///35///++f////n////4////9v////P///7u//766P/69uH/9PDa/+/r0//q5cz/5eHG/+Lewv/g3MD/39u//9/bv//g3MD/4NzC/+HdxP/i3sb/5ODJ/+bizf/q5tL/7urY//Pv3//59eX//vrr///+8P////L/AIEAfv8A//35///9+f///vn////5////+f////f////1////8v///u3///vn//r24P/18dn/8OzS/+vnzP/o5Mf/5eHD/+Pfwf/j38D/49/A/+Pfwf/k4MP/5eHE/+Xhx//n48n/6eXN/+zo0f/w7Nf/9fDd//r25P//++n///7u////8P8AgQB+/wD//v3///79/////f////3////8////+/////j////1///+8P//++v/+/fk//by3f/y7tf/7urR/+rmzP/o5Mn/5+PH/+fjx//n48f/6OTI/+jkyf/o5Mr/6eXM/+rmzv/r59H/7urW//Ht2//28uD/+/fn///77P////D////z/wCBAH7/AP/+/////v////////////////////////////////v///73///78f/89+v/9/Pl//Pv3//w7Nn/7enV/+zo0v/r59H/6+fR/+vn0f/s6NL/7OjT/+zo1P/s6NX/7enX/+7q2v/w7N3/8+/i//fz5//8+O3///zy////9v////n/AIEAfv8A//3////+/////v///////////////////////////////v7///v4//z48//49O3/9fHn//Lu4v/w697/7urc/+7q2//u6tv/7+vb/+/r3P/v693/7+ve/+/r3//v6+D/8Ozi//Ht5v/08Or/+PTv//z49P///fn////9//////8BgQB+/wD//f////3////+///////////////////////////////+////+/3//Pj3//n18v/18ez/8+/o//Ht5P/w7OL/8Ozh//Ds4f/w7OL/8e3i//Ht4//x7eT/8Ozl//Ds5v/x7ej/8u7r//Xx7//59fT//fn5///9/v///////////5jVQNEW4pAgAAAAAElFTkSuQmCC" data-src="/assets/image-20231223152402697.CfLUncDk.png" loading="lazy" alt="" width="1430" height="444" style="aspect-ratio:1430 / 444;"><!--]--></p><ul><li><p>undo log</p><p>回滚日志，用于记录数据被修改前的信息作用包含两个：提供回滚 和 MVCC（多版本并发控制）。</p><p>undo log和redo log记录物理日志不一样，它是逻辑日志。可以认为当de[ete一条记录时，undo log中会记录一条对应的insert记录，反之亦然，当update—条记录时，它记录一条对应相反的update记录。当执行rollback时，就可以从undo log中的逻辑记录读取到相应的内容并进行回滚。</p><p>Undo log销毁：undo log在事务执行时产生，事务提交时/并不会立即删除undo log因为这些日志可能还用于MVCC。</p><p>Undo log存储：undo log采用段的方式进行管理和记录，存放在前面介绍的rollback segment回滚段中，内部包含1024个undo log segment。</p></li></ul><h3 id="mvcc" tabindex="-1">MVCC <a class="header-anchor" href="#mvcc" aria-label="Permalink to &#x22;MVCC&#x22;">​</a></h3><ul><li><p>当前读</p><p>读取的是记录的最新版本，读取时还要保证其他并发事务不能修改当前记录，会对读取的记录进行加锁。对于我们日常的操作，如：select…lock in share mode(共享锁), select... for update、update、insert、delete(排他锁)都是一种当前读。</p></li><li><p>快照读</p><p>简单的select（不加锁）就是快照读，快照读，读取的是记录数据的可见版本，有可能是历史数据，不加锁，是非阻塞读。</p><ul><li>Read Committed：每次select，都生成一个快照读。</li><li>Repeatable Read：开启事务后第一个select语句才是快照读的地方。</li><li>SeriaIizable:快照读会退化为当前读。</li></ul></li><li><p>MVCC</p><p>全称Multi-Version Concurrency Control，多版本并发控制。指维护一个数据的多个版本，使得读写操作没有冲突，快照读为MySQL实现MVCC提供了一个非阻塞读功能。MVCC的具体实现，还需要依赖于数据库记录中的三个隐式字段、undo log日志、read View。</p></li><li><p>记录中的隐藏字段</p><table><thead><tr><th style="text-align:center;">隐藏的字段</th><th style="text-align:center;">含义</th></tr></thead><tbody><tr><td style="text-align:center;">DB_TRX_ID</td><td style="text-align:center;">最近修改事务ID，记录插入这条记录或最后一次修改记录的事务ID。</td></tr><tr><td style="text-align:center;">DB_ROLL_PTR</td><td style="text-align:center;">回滚指针，指向这条记录的上一个版本，用于配合undo log，指向上一个版本。</td></tr><tr><td style="text-align:center;">DB_ROW_ID</td><td style="text-align:center;">隐藏主键，如果表结构没有指定主键，将会会生成该隐藏字段。</td></tr></tbody></table></li><li><p>undo log版本链</p><p><!--[--><img class="nolebase-enhanced-img absolute inset-0 z-1 bg-black/10" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAXCAYAAABqBU3hAAAMEElEQVR4AQCBAH7/AP//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AIEAfv8A/////////////////////////////////////////////////////////////////////////P////r////6////+v////v////9//////////////////////////////////////////////////////////////////////8AgQB+/wD///////////////////////////////////////////7////9/////P/8//v/+f/6/vb/+f30//j88v/4/PH/+f3x//r+8//7//T//P/2//z/9//7//f/+f34//j8+P/3+/n/+Pz8//v//////////////////////////////wCBAH7/AP//////////////////////////+/////n9///3+/v/9vr4//X59f/0+PL/8/fv//L27P/w9On/8PTn/+/z5//w9Of/8fXo//L26v/z9+v/8vbs//H17P/w9Oz/7vLt/+7y7v/v8/H/8vb2//f7/P/9////////////////////AIEAfv8A/////////////////v////n9///1+fv/8vb2/+/z8v/u8u7/7fHr/+zw6P/r7+X/6e3i/+js3//n693/5+vc/+js3f/p7d7/6u7f/+ru4P/q7uH/6e3i/+fr4v/m6uL/5enj/+bq5v/q7uv/7/Py//X5+f/7//////////////8AgQB+/wD////////////////6/v//9fn7//D09P/t8e//6u7q/+js5v/n6+P/5urf/+Xp3P/k6Nn/4ubX/+Hm1f/h5dT/4ubU/+Pn1f/k6Nf/5OjY/+To2f/i59n/4eXZ/9/j2f/f49v/4OTe/+To4//p7en/7/Px//b6+P/7//7//v///wCBAH7/AP////////////////n9/v/0+Pf/7vLw/+ru6v/o7OX/5urh/+To3f/j59r/4ubX/+Hl1P/g5NL/3+PQ/9/jz//f48//4OTQ/+Hl0f/h5dP/4eXT/+Dk1P/e4tT/3eHU/9zg1f/e4tj/4eXd/+bq5P/t8ez/8/fz//j9+f/7//3/AIEAfv8A////////////////+//9//X59v/v8+7/6+/o/+js4//m6t7/5Ojb/+Pn2P/i5tX/4eXS/+Dk0P/g5M7/3+TN/+Dkzf/h5c7/4ubQ/+Lm0f/i5tL/4OTS/9/j0v/d4dL/3eHT/97i1//i5tz/5+vj/+7y6v/0+PL/+v74//3/+/8AgQB+/wD////////////////+//7/+Pz2//L27//t8ej/6u7i/+js3v/m6tv/5enY/+Xp1f/k6NL/4+fQ/+Lmzv/i587/4+fO/+Toz//l6dD/5enS/+Xp0v/k6NL/4ubS/+Hl0//g5NT/4ubX/+Xp3f/r7+P/8fXr//j88//9//n////8/wCBAH7/AP/////////////////////7//f/9fnv//D06P/s8OP/6u7e/+nt2//o7Nj/6OzW/+fr0//m6tH/5urQ/+bqz//n69D/6OzR/+nt0v/p7dP/6e3U/+fr1P/m6tT/5OjU/+To1v/m6tn/6e3e/+/z5f/1+e3//P/1////+/////7/AIEAfv8A//////////////////////z/9//2+u//8fXo/+7y4v/s8N7/6+/b/+ru2P/q7tb/6e3U/+nt0v/p7dH/6e3Q/+ru0f/r79L/6+/T/+zw1P/r79X/6u7V/+nt1f/n69X/5+vX/+js2v/s8N//8fXm//j87v/+//X////7//////8AgQB+/wD///////////////////7//P/1//b67f/w9eb/7fHg/+vv3P/q7tn/6u7W/+nt1P/p7dL/6e3R/+nt0P/p7c//6u7Q/+vv0f/s8NL/7PDT/+zw1P/q79T/6e3U/+js1P/n69b/6e3Z/+zw3v/y9uX/+Pzt////9P////r////9/wCBAH7/AP//////////////////+v/5/fH/8vbp/+3x4v/q7tz/6OzY/+fr1f/n69P/5+vR/+frz//n683/5+vM/+frzP/o7Mz/6e3N/+ntzv/q7tD/6e3Q/+js0P/m6tD/5enR/+Xp0v/m6tX/6u7a/+/z4f/1+en//P/w////9v////n/AIEAfv8A//////////////z/+//0//P36//t8eP/6Ozc/+Xp1//j59P/4ubQ/+Lmzf/i5sz/4ubK/+LmyP/i5sf/4ubH/+Pnx//k6Mj/5enJ/+Xpyv/k6Mv/4+fL/+Hmy//g5Mv/4OTN/+Hl0P/l6dX/6u7b//D04//2+ur/+//w//7/8/8AgQB+/wD////////9//z/9v/1+e7/7vLm/+fr3f/i5tb/3+PR/93hzf/d4cr/3eHI/93hxv/d4cT/3eHD/93hwv/d4cH/3uLC/97iwv/f48P/3+PE/97jxf/d4cX/3ODF/9rexf/a3sf/29/K/9/jzv/k6NX/6u7c//D05P/1+en/+Pzs/wCBAH7/AP///P/8//j/9/vy//D06v/p7eH/4+fZ/97i0v/b383/2d3J/9jcxv/Y3MT/2d3C/9jdwP/Y3L//2Ny+/9jcvf/Z3b3/2d2+/9rev//a3r//2d3A/9jcwP/X28D/1dnA/9XZwv/W2sX/2t7K/97j0P/l6df/6+/e//D05P/y9uf/AIEAfv8A/f/6//r+9//1+fH/7vLp/+fr4P/h5dj/3ODR/9ndzP/X28j/19vF/9fbw//X28H/19u//9bavf/W2rz/1tq7/9bau//X27z/19u9/9fbvf/X277/1tq+/9TYvv/T17//09fA/9TYw//X28j/3ODO/+Lm1f/o7Nz/7fHi//D05f8AgQB+/wD///z//P/5//b68//w9Ov/6O3i/+Lm2v/e4tP/2t/O/9ndyv/Z3cj/2d3G/9ndxP/Y3ML/2NzA/9fbvv/X273/19u9/9jcvf/Y3L7/2Ny//9jcwP/X28D/1trA/9TZwf/U2ML/1trF/9ndyv/e4tD/5OjY/+nt3//u8uT/8fXn/wCBAH7/AP//////////+//5//X58f/u8uj/5+vg/+Pn2v/g5NT/3uLR/97izv/e4sz/3uLK/93hyP/d4cb/3ODE/9zgw//c4MP/3ODD/93hxP/d4cX/3eHF/9zgxv/b38b/2t7H/9reyP/b38z/3uLQ/+Pn1//p7d7/7/Pl//P46v/2+u3/AIEAfv8A/////////////////P/5//X58f/v8+n/6u/i/+js3f/m6tn/5urX/+bq1P/l6dL/5enQ/+Tozv/k6Mz/4+fL/+Pny//k6Mv/5OjM/+Tozf/k6M7/4+fO/+Lmz//i5s//4ubR/+Pn1P/m6tn/6+/g//H15//3++7//P/z//7/9v8AgQB+/wD//////////////////////v/6//f88v/z9+v/8PTm/+/z4//u8uD/7vLe/+7y3P/t8dn/7fHX/+zw1f/r79T/6+/T/+zw1P/s8NX/7fHW/+zx1//s8Nf/6+/Y/+ru2f/r79v/7PDe/+/04//0+On/+v7x////9/////3//////wCBAH7/AP/////////////////////////////6//r+8//3++7/9vrq//X56P/1+eX/9fnj//X54f/0+N//8/fd//L22//y9tv/8/fb//P33P/0+N3/9Pje//P33//y9uD/8vbh//L24//0+Ob/9/vr//z/8v////n/////////////////AYEAfv8A//////////////////////////////7//v/4//v/8v/6/u//+v7s//n96v/5/ej/+f3l//j84//3++H/9vrg//b63//3++D/9/vg//j84v/4/OP/9/vk//f75P/2+ub/9/vo//j86//8//D////2/////v/////////////////MS81TxzUDYgAAAABJRU5ErkJggg==" width="809" height="528" style="aspect-ratio:809 / 528;"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAXCAYAAABqBU3hAAAMEElEQVR4AQCBAH7/AP//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AIEAfv8A/////////////////////////////////////////////////////////////////////////P////r////6////+v////v////9//////////////////////////////////////////////////////////////////////8AgQB+/wD///////////////////////////////////////////7////9/////P/8//v/+f/6/vb/+f30//j88v/4/PH/+f3x//r+8//7//T//P/2//z/9//7//f/+f34//j8+P/3+/n/+Pz8//v//////////////////////////////wCBAH7/AP//////////////////////////+/////n9///3+/v/9vr4//X59f/0+PL/8/fv//L27P/w9On/8PTn/+/z5//w9Of/8fXo//L26v/z9+v/8vbs//H17P/w9Oz/7vLt/+7y7v/v8/H/8vb2//f7/P/9////////////////////AIEAfv8A/////////////////v////n9///1+fv/8vb2/+/z8v/u8u7/7fHr/+zw6P/r7+X/6e3i/+js3//n693/5+vc/+js3f/p7d7/6u7f/+ru4P/q7uH/6e3i/+fr4v/m6uL/5enj/+bq5v/q7uv/7/Py//X5+f/7//////////////8AgQB+/wD////////////////6/v//9fn7//D09P/t8e//6u7q/+js5v/n6+P/5urf/+Xp3P/k6Nn/4ubX/+Hm1f/h5dT/4ubU/+Pn1f/k6Nf/5OjY/+To2f/i59n/4eXZ/9/j2f/f49v/4OTe/+To4//p7en/7/Px//b6+P/7//7//v///wCBAH7/AP////////////////n9/v/0+Pf/7vLw/+ru6v/o7OX/5urh/+To3f/j59r/4ubX/+Hl1P/g5NL/3+PQ/9/jz//f48//4OTQ/+Hl0f/h5dP/4eXT/+Dk1P/e4tT/3eHU/9zg1f/e4tj/4eXd/+bq5P/t8ez/8/fz//j9+f/7//3/AIEAfv8A////////////////+//9//X59v/v8+7/6+/o/+js4//m6t7/5Ojb/+Pn2P/i5tX/4eXS/+Dk0P/g5M7/3+TN/+Dkzf/h5c7/4ubQ/+Lm0f/i5tL/4OTS/9/j0v/d4dL/3eHT/97i1//i5tz/5+vj/+7y6v/0+PL/+v74//3/+/8AgQB+/wD////////////////+//7/+Pz2//L27//t8ej/6u7i/+js3v/m6tv/5enY/+Xp1f/k6NL/4+fQ/+Lmzv/i587/4+fO/+Toz//l6dD/5enS/+Xp0v/k6NL/4ubS/+Hl0//g5NT/4ubX/+Xp3f/r7+P/8fXr//j88//9//n////8/wCBAH7/AP/////////////////////7//f/9fnv//D06P/s8OP/6u7e/+nt2//o7Nj/6OzW/+fr0//m6tH/5urQ/+bqz//n69D/6OzR/+nt0v/p7dP/6e3U/+fr1P/m6tT/5OjU/+To1v/m6tn/6e3e/+/z5f/1+e3//P/1////+/////7/AIEAfv8A//////////////////////z/9//2+u//8fXo/+7y4v/s8N7/6+/b/+ru2P/q7tb/6e3U/+nt0v/p7dH/6e3Q/+ru0f/r79L/6+/T/+zw1P/r79X/6u7V/+nt1f/n69X/5+vX/+js2v/s8N//8fXm//j87v/+//X////7//////8AgQB+/wD///////////////////7//P/1//b67f/w9eb/7fHg/+vv3P/q7tn/6u7W/+nt1P/p7dL/6e3R/+nt0P/p7c//6u7Q/+vv0f/s8NL/7PDT/+zw1P/q79T/6e3U/+js1P/n69b/6e3Z/+zw3v/y9uX/+Pzt////9P////r////9/wCBAH7/AP//////////////////+v/5/fH/8vbp/+3x4v/q7tz/6OzY/+fr1f/n69P/5+vR/+frz//n683/5+vM/+frzP/o7Mz/6e3N/+ntzv/q7tD/6e3Q/+js0P/m6tD/5enR/+Xp0v/m6tX/6u7a/+/z4f/1+en//P/w////9v////n/AIEAfv8A//////////////z/+//0//P36//t8eP/6Ozc/+Xp1//j59P/4ubQ/+Lmzf/i5sz/4ubK/+LmyP/i5sf/4ubH/+Pnx//k6Mj/5enJ/+Xpyv/k6Mv/4+fL/+Hmy//g5Mv/4OTN/+Hl0P/l6dX/6u7b//D04//2+ur/+//w//7/8/8AgQB+/wD////////9//z/9v/1+e7/7vLm/+fr3f/i5tb/3+PR/93hzf/d4cr/3eHI/93hxv/d4cT/3eHD/93hwv/d4cH/3uLC/97iwv/f48P/3+PE/97jxf/d4cX/3ODF/9rexf/a3sf/29/K/9/jzv/k6NX/6u7c//D05P/1+en/+Pzs/wCBAH7/AP///P/8//j/9/vy//D06v/p7eH/4+fZ/97i0v/b383/2d3J/9jcxv/Y3MT/2d3C/9jdwP/Y3L//2Ny+/9jcvf/Z3b3/2d2+/9rev//a3r//2d3A/9jcwP/X28D/1dnA/9XZwv/W2sX/2t7K/97j0P/l6df/6+/e//D05P/y9uf/AIEAfv8A/f/6//r+9//1+fH/7vLp/+fr4P/h5dj/3ODR/9ndzP/X28j/19vF/9fbw//X28H/19u//9bavf/W2rz/1tq7/9bau//X27z/19u9/9fbvf/X277/1tq+/9TYvv/T17//09fA/9TYw//X28j/3ODO/+Lm1f/o7Nz/7fHi//D05f8AgQB+/wD///z//P/5//b68//w9Ov/6O3i/+Lm2v/e4tP/2t/O/9ndyv/Z3cj/2d3G/9ndxP/Y3ML/2NzA/9fbvv/X273/19u9/9jcvf/Y3L7/2Ny//9jcwP/X28D/1trA/9TZwf/U2ML/1trF/9ndyv/e4tD/5OjY/+nt3//u8uT/8fXn/wCBAH7/AP//////////+//5//X58f/u8uj/5+vg/+Pn2v/g5NT/3uLR/97izv/e4sz/3uLK/93hyP/d4cb/3ODE/9zgw//c4MP/3ODD/93hxP/d4cX/3eHF/9zgxv/b38b/2t7H/9reyP/b38z/3uLQ/+Pn1//p7d7/7/Pl//P46v/2+u3/AIEAfv8A/////////////////P/5//X58f/v8+n/6u/i/+js3f/m6tn/5urX/+bq1P/l6dL/5enQ/+Tozv/k6Mz/4+fL/+Pny//k6Mv/5OjM/+Tozf/k6M7/4+fO/+Lmz//i5s//4ubR/+Pn1P/m6tn/6+/g//H15//3++7//P/z//7/9v8AgQB+/wD//////////////////////v/6//f88v/z9+v/8PTm/+/z4//u8uD/7vLe/+7y3P/t8dn/7fHX/+zw1f/r79T/6+/T/+zw1P/s8NX/7fHW/+zx1//s8Nf/6+/Y/+ru2f/r79v/7PDe/+/04//0+On/+v7x////9/////3//////wCBAH7/AP/////////////////////////////6//r+8//3++7/9vrq//X56P/1+eX/9fnj//X54f/0+N//8/fd//L22//y9tv/8/fb//P33P/0+N3/9Pje//P33//y9uD/8vbh//L24//0+Ob/9/vr//z/8v////n/////////////////AYEAfv8A//////////////////////////////7//v/4//v/8v/6/u//+v7s//n96v/5/ej/+f3l//j84//3++H/9vrg//b63//3++D/9/vg//j84v/4/OP/9/vk//f75P/2+ub/9/vo//j86//8//D////2/////v/////////////////MS81TxzUDYgAAAABJRU5ErkJggg==" data-src="/assets/image-20231223172028267.Bg-603xP.png" loading="lazy" alt="" width="809" height="528" style="aspect-ratio:809 / 528;"><!--]--></p><p>不同事务或相同事务对同一条记录进行修改，会导致该记录的undolog生成一条记录版本链表，链表的头部是最新的旧记录，链表尾部是最早的旧记录。</p></li><li><p>readview</p><p>ReadView（读视图）是<strong>快照读</strong>SQL执行时MVCC提取数据的依据，记录并维护系统当前活跃的事务（未提交的）id。</p><p>ReadView中包了四个核心字段：</p><table><thead><tr><th style="text-align:center;">字段</th><th style="text-align:center;">含义</th></tr></thead><tbody><tr><td style="text-align:center;">m_ids</td><td style="text-align:center;">当前活跃的事务ID集合</td></tr><tr><td style="text-align:center;">min_trx_id</td><td style="text-align:center;">最小活跃事务ID</td></tr><tr><td style="text-align:center;">max_trx_id</td><td style="text-align:center;">预分配事务ID，当前最大事务ID+1（因为事务ID是自增的）</td></tr><tr><td style="text-align:center;">creator_trx_id</td><td style="text-align:center;">ReadView创建者的事务ID</td></tr></tbody></table><p>trx_id：代表是当前事务ID。</p><p>版本链数据访问规则</p><ol><li>trx_id == creator_trx_id ? <strong>可以访问该版本</strong> --> 成立，说明数据是当前这个事务更改的。</li><li>trx_id &#x3C; min_trx_id ? <strong>可以访问该版本</strong> --> 成立，说明数据已经提交了。</li><li>trx_id > max_trx_id ? <strong>不可以访问该版本</strong> --> 成立，说明事务是在ReadView生成后才开启。</li><li>min_trx_id &#x3C;= trx_id &#x3C;= max_trx_id ? 如果trx_id不在m_ids中是<strong>可以</strong>访问该版本的 --> 成立，说明数据已经提交。</li></ol><p>不同的隔离级别，生成ReadView的时机不同：</p><p>READ COMMITTED：在事务中每一次执行快照读时生成ReadView。</p><p>REPEATABLE READ：仅在事务中第一次执行快照读时生成ReadView，后续复用ReadView。</p></li></ul><h2 id="mysql管理" tabindex="-1">MySQL管理 <a class="header-anchor" href="#mysql管理" aria-label="Permalink to &#x22;MySQL管理&#x22;">​</a></h2><h3 id="系统数据库" tabindex="-1">系统数据库 <a class="header-anchor" href="#系统数据库" aria-label="Permalink to &#x22;系统数据库&#x22;">​</a></h3><p>MySQL数据库安装之后，自带了以下四个数据库，具体作用如下：</p><table><thead><tr><th style="text-align:center;">数据库</th><th style="text-align:center;">含义</th></tr></thead><tbody><tr><td style="text-align:center;">mysql</td><td style="text-align:center;">存储MySQL服务器正常运行所需的各种信息（时区、主从、用户、权限等）</td></tr><tr><td style="text-align:center;">information_schema</td><td style="text-align:center;">提供了访问数据库元数据的各种表和视图，包含数据库、表、字段类型及访问权限等</td></tr><tr><td style="text-align:center;">performance_schema</td><td style="text-align:center;">为MySQL服务器运行时状态提供了一个底层监控功能，主要用于收集数据库服务器性能参数</td></tr><tr><td style="text-align:center;">sys</td><td style="text-align:center;">包含了一系列方便DBA和开发人员利用performance_schema性能数据库进行性能调优和诊断的视图</td></tr></tbody></table><h3 id="常用工具" tabindex="-1">常用工具 <a class="header-anchor" href="#常用工具" aria-label="Permalink to &#x22;常用工具&#x22;">​</a></h3><ul><li><p>mysql</p><p>该mysql不是指mysql服务，而是指mysql的客户端。</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>语法：</span></span>
<span class="line"><span>	mysql [options] [database]</span></span>
<span class="line"><span>选项：</span></span>
<span class="line"><span>	-u,--user=name            #指定用户名</span></span>
<span class="line"><span>	-p,--password[=name]      #指定密码</span></span>
<span class="line"><span>	-h,--host=name            #指定服务器IP或域名</span></span>
<span class="line"><span>	-P,--port=port            #指定连接端口</span></span>
<span class="line"><span>	-e,--execute=name         #执行SQL语句并退出</span></span></code></pre></div><p>-e选项可以在MySQL客户端执行SQL语句，而不是连接到MySQL数据库再执行，对于一些批处理脚本，这种方式尤其 方便。</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>示例：</span></span>
<span class="line"><span>	mysql -u&#x3C;用户名> -p&#x3C;密码> &#x3C;数据库名> -e "select * from &#x3C;表名>";</span></span></code></pre></div></li><li><p>mysqladmin</p><p>msyqladmin是一个执行管理操作的客户端程序。可以用它来检查服务器的配置和当前状态、创建并删除数据库等。</p><p>通过帮助文档查看选项：</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>mysqladmin --help</span></span></code></pre></div><p>示例：</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>mysqladmin -u&#x3C;用户名> -p&#x3C;密码> drop 'text01';</span></span>
<span class="line"><span>mysqladmin -u&#x3C;用户名> -p&#x3C;密码> version;</span></span></code></pre></div></li><li><p>mysqlbinlog</p><p>由于服务器生成的二进制日志文件以二进制格式保存，所以如果想要检查这些文本的文本格式，就会使用到mysqlbinlog日志关系工具。</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>语法：</span></span>
<span class="line"><span>	mysqlbinlog [options] log-files1 log-files2...</span></span>
<span class="line"><span>选项：</span></span>
<span class="line"><span>	-d,--database=name           指定数据库名称，只列出指定的数据库相关操作。</span></span>
<span class="line"><span>	-o,--offset=#				 忽略掉的日志中qiann行命令。</span></span>
<span class="line"><span>	-r,--result-file=name		 将输出的文本格式输出到指定文件。</span></span>
<span class="line"><span>	-s,--short-from				 显示简单格式，省略掉一些信息。</span></span>
<span class="line"><span>	--start-datatime=date1 --stop-datetime=date2       指定日期间隔内的所有日志。</span></span>
<span class="line"><span>	--start-position=pos1 --stop-position=pos2 		   指定位置间隔内的所有日志。</span></span></code></pre></div></li><li><p>mysqlshow</p><p>mysqlshow客户端对象查找工具，用来很快地查找存在哪些数据库、数据库中的表、表中的列或者索引。</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>语法：</span></span>
<span class="line"><span>	mysqlshow [options][db_name[table_name[col_name]]]</span></span>
<span class="line"><span>选项：</span></span>
<span class="line"><span>	--count      显示数据库及表的统计信息(数据，表均不指定)</span></span>
<span class="line"><span>	-i           显示指定数据库或者指定表的状态信息</span></span>
<span class="line"><span>示例：</span></span>
<span class="line"><span>	#查询每个数据库的表的数量及表中记录的数量</span></span>
<span class="line"><span>	mysqlshow -u&#x3C;用户名> -p&#x3C;密码> --count</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	#查询test库中每个表中的字段数，及行数</span></span>
<span class="line"><span>	mysqlshow -u&#x3C;用户名> -p&#x3C;密码> --count</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	#查询test库中book表的详细情况</span></span>
<span class="line"><span>	mysqlshow -u&#x3C;用户名> -p&#x3C;密码> test book --count</span></span></code></pre></div></li><li><p>mysqldump</p><p>mysqldump客户端工具来备份数据库或者在不同数据库之间进行数据迁移。备份内容包含创建表，及插入表的SQL语句</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>语法：</span></span>
<span class="line"><span>	mysqldump [options] db_name [tables]</span></span>
<span class="line"><span>	mysqldump [options] --database/-B db1 [db2 db3...]</span></span>
<span class="line"><span>	mysqldump [options] --adll-databases/-A</span></span>
<span class="line"><span>连接选项：</span></span>
<span class="line"><span>	-u,--user=name				指定用户名</span></span>
<span class="line"><span>	-p,--password[=name]		指定密码</span></span>
<span class="line"><span>	-h,--host=name				指定服务器ip或域名</span></span>
<span class="line"><span>	-P,--port=#					指定连接端口</span></span>
<span class="line"><span>输出选项：</span></span>
<span class="line"><span>	--add-drop-database			在每个数据库创建语句前加上drop database语句</span></span>
<span class="line"><span>	--add-drop-table			在每个表创建语句前加上drop table语句，默认开启;不开启(--skip-add-drop-table)</span></span>
<span class="line"><span>	-n,--no-create-db			不包含数据库的创建语句</span></span>
<span class="line"><span>	-t,--no-create-info			不包含数据库的创建语句</span></span>
<span class="line"><span>	-d,--no-data				不包含数据</span></span>
<span class="line"><span>	-T,--tab=name				自动生成两个文件：一个.sql文件，创建表结构的语句；一个.txt文件，数据文件</span></span></code></pre></div></li><li><p>mysqlimport/source</p><p>mysqlimport是客户端数据导入工具，用来导入mysqldump加-T参数后导出的文件文本。</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>语法：</span></span>
<span class="line"><span>	mysqlimport [options] db_name textfile1 [textfile2...]</span></span>
<span class="line"><span>示例：</span></span>
<span class="line"><span>	mysqlimport -u&#x3C;用户名> -p&#x3C;密码> text /tmp/city.txt</span></span></code></pre></div><p>如果需要导入sql文件，可以使用mysql中的source指令：</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>语法：</span></span>
<span class="line"><span>	source /root/xxxxx.sql</span></span></code></pre></div></li></ul><h2 id="贡献者" tabindex="-1">贡献者 <a class="header-anchor" href="#贡献者" aria-label="Permalink to &#x22;贡献者&#x22;">​</a></h2><div class="flex flex-wrap gap-4 pt-2"><!--[--><!--[--><div class="flex items-center gap-2"><img src="https://gravatar.com/avatar/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855?d=retro" alt="The avatar of contributor named as undefined" class="h-8 w-8 rounded-full"> </div><!--]--><!--]--></div><h2 id="文件历史" tabindex="-1">文件历史 <a class="header-anchor" href="#文件历史" aria-label="Permalink to &#x22;文件历史&#x22;">​</a></h2><div class="bg-$vp-custom-block-details-bg" rounded-lg="" p-4="" data-v-1fe22f50=""><label cursor-pointer="" data-v-1fe22f50=""><div class="vp-nolebase-git-changelog-title flex select-none items-center justify-between" transition="color ease-in-out" text="<sm:xs" duration-200="" data-v-1fe22f50=""><span class="vp-nolebase-git-changelog-last-edited-title inline-flex items-center gap-3" data-v-1fe22f50=""><span class="i-octicon:history-16" data-v-1fe22f50=""></span><span data-v-1fe22f50="">最后编辑于 Invalid Date</span></span><input type="checkbox" invisible="" appearance-none="" data-v-1fe22f50=""><span class="vp-nolebase-git-changelog-view-full-history-title inline-flex cursor-pointer items-center gap-3" data-v-1fe22f50=""><span class="<sm:hidden" data-v-1fe22f50="">查看完整历史</span><svg class="rotate-0 i-octicon:chevron-down-16" transition="transform ease-in-out" duration-200="" data-v-1fe22f50=""></svg></span></div></label><div style="display:none;" class="grid grid-cols-[30px_auto] mt-3 gap-1.5 children:my-auto -ml-1.5" text="<sm:xs" data-v-1fe22f50=""><!--[--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform opacity-30"></div><div flex="" items-center="" gap-1=""><a href="https://github.com/M946i/commit/" target="_blank"><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200=""></code></a><span>-</span><span><span class="text-sm <sm:text-xs"></span><!----></span></div><!--]--><!--]--><!--]--></div></div></div></div></main><footer class="VPDocFooter" data-v-4e5e6fe5="" data-v-485ff4d0=""><!--[--><!--[--><!--[--><!--[--><div class="doc-before-footer-cc-block mt-10 text-sm font-medium" data-v-ee3fc599=""> 使用 <a class="footer-cc-link" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/" data-v-ee3fc599="">CC BY-SA 4.0</a> 许可协议进行共享 </div><!--]--><!--]--><!--]--><!--]--><div class="edit-info" data-v-485ff4d0=""><div class="edit-link" data-v-485ff4d0=""><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/M946i/tree/main/笔记/mysql/mysql.md" target="_blank" rel="noreferrer" data-v-485ff4d0=""><!--[--><span class="vpi-square-pen edit-link-icon" data-v-485ff4d0=""></span> 编辑本页面<!--]--></a></div><!----></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-485ff4d0=""><span class="visually-hidden" id="doc-footer-aria-label" data-v-485ff4d0="">Pager</span><div class="pager" data-v-485ff4d0=""><a class="VPLink link pager-link prev" href="/%E7%AC%94%E8%AE%B0/JUC/JUC.html" data-v-485ff4d0=""><!--[--><span class="desc" data-v-485ff4d0="">Previous page</span><span class="title" data-v-485ff4d0="">JUC</span><!--]--></a></div><div class="pager" data-v-485ff4d0=""><!----></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-387679bd="" data-v-c8e7a356=""><div class="container" data-v-c8e7a356=""><!----><p class="copyright" data-v-c8e7a356=""><a class="footer-cc-link" target="_blank" href="https://M946i.github.io">M946i</a> © 2022 - 至今</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"index.md\":\"BKpySlRE\",\"toc.md\":\"BnQ6gVBB\",\"笔记_index.md\":\"Bpf97jdA\",\"🔌 知识库插件列表.md\":\"Brx0V3kS\",\"笔记_mysql_mysql.md\":\"MiKbH4rO\",\"笔记_juc_juc.md\":\"tXXgY-jE\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"M946i\",\"description\":\"A VitePress site\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"outline\":{\"label\":\"页面大纲\",\"level\":\"deep\"},\"darkModeSwitchLabel\":\"切换主题\",\"editLink\":{\"pattern\":\"https://github.com/M946i/tree/main/:path\",\"text\":\"编辑本页面\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/M946i\"},{\"icon\":\"discord\",\"link\":\"https://discord.com/invite/fSHxNEgh\"}],\"footer\":{\"message\":\"\",\"copyright\":\"<a class=\\\"footer-cc-link\\\" target=\\\"_blank\\\" href=\\\"https://M946i.github.io\\\">M946i</a> © 2022 - 至今\"},\"search\":{\"provider\":\"local\",\"options\":{\"locales\":{\"root\":{\"translations\":{\"button\":{\"buttonText\":\"搜索文档\",\"buttonAriaLabel\":\"搜索文档\"},\"modal\":{\"noResultsText\":\"无法找到相关结果\",\"resetButtonTitle\":\"清除查询条件\",\"footer\":{\"selectText\":\"选择\",\"navigateText\":\"切换\"}}}}}}},\"nav\":[{\"text\":\"主页\",\"link\":\"/\"},{\"text\":\"笔记\",\"link\":\"/笔记/\"},{\"text\":\"最近更新\",\"link\":\"/toc\"}],\"sidebar\":[{\"index\":\"JUC\",\"text\":\"JUC\",\"collapsed\":true,\"items\":[{\"index\":\"JUC\",\"text\":\"JUC\",\"link\":\"/笔记/JUC/JUC\",\"lastUpdated\":0}]},{\"index\":\"mysql\",\"text\":\"mysql\",\"collapsed\":true,\"items\":[{\"index\":\"mysql\",\"text\":\"mysql\",\"link\":\"/笔记/mysql/mysql\",\"lastUpdated\":0}]}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  
</body></html>